<!DOCTYPE html>
<html>
<head>
    <title>Riyadh Taxi Trip - Street Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; }
        #map { width: 100%; height: 100vh; }
        
        .info-panel {
            position: absolute;
            top: 15px;
            left: 15px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            z-index: 1000;
            width: 320px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .info-panel h2 {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .subtitle {
            font-size: 11px;
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        
        .trip-selector {
            margin-bottom: 15px;
        }
        
        .trip-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #3498db;
            border-radius: 8px;
            font-size: 13px;
            background: white;
            cursor: pointer;
        }
        
        .trip-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .trip-info h3 {
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #7f8c8d;
        }
        
        .info-value {
            color: #2c3e50;
            font-weight: 600;
        }
        
        .legend {
            margin-top: 15px;
        }
        
        .legend-title {
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
            font-size: 11px;
        }
        
        .legend-line {
            width: 30px;
            height: 4px;
            margin-right: 10px;
            border-radius: 2px;
        }
        
        .legend-marker {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        .controls {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .controls label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
            font-size: 12px;
            cursor: pointer;
        }
        
        .map-style {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .map-style select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="info-panel">
        <h2>ðŸš• Taxi Trip Viewer</h2>
        <div class="subtitle">View trips on street map with labels</div>
        
        <div class="trip-selector">
            <select id="tripSelect" onchange="loadTrip()">
                <option value="0">Trip 7027987 - 2016-4-12</option><option value="1">Trip 6224292 - 2016-1-19</option><option value="2">Trip 6335313 - 2016-3-3</option><option value="3">Trip 3056923 - 2016-0-18</option><option value="4">Trip 4675972 - 2016-4-27</option>
            </select>
        </div>
        
        <div class="trip-info" id="tripInfo">
            <h3>Trip Details</h3>
            <div class="info-row"><span class="info-label">Trip ID</span><span class="info-value" id="infoId">-</span></div>
            <div class="info-row"><span class="info-label">Pickup Time</span><span class="info-value" id="infoTime">-</span></div>
            <div class="info-row"><span class="info-label">Duration</span><span class="info-value" id="infoDuration">-</span></div>
            <div class="info-row"><span class="info-label">GPS Points</span><span class="info-value" id="infoGps">-</span></div>
            <div class="info-row"><span class="info-label">Route Points</span><span class="info-value" id="infoRoute">-</span></div>
        </div>
        
        <div class="legend">
            <div class="legend-title">Legend</div>
            <div class="legend-item"><div class="legend-line" style="background:#e74c3c;"></div> Raw GPS Track</div>
            <div class="legend-item"><div class="legend-line" style="background:#3498db;"></div> Map-Matched Route</div>
            <div class="legend-item"><div class="legend-marker" style="background:#27ae60;"></div> Start Point</div>
            <div class="legend-item"><div class="legend-marker" style="background:#9b59b6;"></div> End Point</div>
        </div>
        
        <div class="controls">
            <label><input type="checkbox" id="showGps" checked onchange="updateView()"> Show GPS Track</label>
            <label><input type="checkbox" id="showMatched" checked onchange="updateView()"> Show Matched Route</label>
            <label><input type="checkbox" id="showPoints" onchange="updateView()"> Show All GPS Points</label>
        </div>
        
        <div class="map-style">
            <div class="legend-title">Map Style</div>
            <select id="mapStyle" onchange="changeMapStyle()">
                <option value="osm">OpenStreetMap (Street Names)</option>
                <option value="carto">CartoDB Positron</option>
                <option value="cartodk">CartoDB Dark</option>
                <option value="esri">ESRI World Street</option>
            </select>
        </div>
    </div>

    <script>
        var trips = [{"id": "7027987", "pickup": "2016-4-12T21:45:6+00:00", "duration": 670.0, "gps": [[46.71332026995709, 24.732350786316697, 77.86625336568318, 10.0], [46.715432622725146, 24.732671376459397, 79.03625474401346, 20.0], [46.71747991682141, 24.733335167175603, 82.09960314056922, 30.0], [46.719675452920306, 24.73381457761924, 63.74005522385282, 40.0], [46.72140456827602, 24.734077237842925, 73.37053952556366, 50.0], [46.723394387065, 24.734382572065066, 91.19330571537076, 60.0], [46.72577502608065, 24.73509991512096, 77.08250746396126, 70.0], [46.727856737677484, 24.735464836219762, 88.08132476006175, 80.0], [46.73020874356067, 24.73599235694427, 64.4739681415963, 90.0], [46.731935651035, 24.73635854794188, 84.86820618061121, 100.0], [46.73421771566957, 24.736804539235074, 77.93909473644732, 110.0], [46.73620497605559, 24.737534722162252, 68.48383990693085, 120.0], [46.73793525873431, 24.738210925053654, 86.80953379345245, 130.0], [46.74006248446087, 24.739195916713616, 87.75125537926961, 140.0], [46.74224060769233, 24.740140427633573, 67.29529905376371, 150.0], [46.74387979471262, 24.740921342947498, 84.90311242307894, 160.0], [46.74591005356175, 24.74196948759736, 82.44348297344698, 170.0], [46.74770770901145, 24.743224960153537, 55.196184080475234, 180.0], [46.74904277082178, 24.74388156875662, 18.183216997917814, 190.0], [46.749259773320254, 24.744290826544695, 76.82913409707804, 200.0], [46.747461961492604, 24.74328198647857, 69.19713302751966, 210.0], [46.745825209465416, 24.74239966721031, 66.85812371630904, 220.0], [46.74442045004761, 24.741321769330014, 85.33753167832688, 230.0], [46.74234177857255, 24.74033149442441, 75.20881006563786, 240.0], [46.74055636553566, 24.739382548103404, 75.08670110580493, 250.0], [46.73863208853815, 24.73870130910731, 72.93044582495841, 260.0], [46.73677588425915, 24.738010543375925, 67.44298586522258, 270.0], [46.73513112429531, 24.737231411370505, 79.06815807841899, 280.0], [46.73309374347297, 24.73654048158494, 72.96308339233656, 290.0], [46.73111595985064, 24.736231413827557, 70.40018943545722, 300.0], [46.729214330614376, 24.735899874733438, 80.46230896767112, 310.0], [46.72705264542668, 24.735469130780295, 60.530851987214476, 320.0], [46.72544207920537, 24.73508603642604, 92.7815274686451, 330.0], [46.722940982545396, 24.734625771115237, 76.78275018398274, 340.0], [46.720881499043436, 24.734201188836106, 73.89280986632728, 350.0], [46.71892214965563, 24.733710805955003, 81.6574318548466, 360.0], [46.71668898408278, 24.733493613350763, 77.71461315976983, 370.0], [46.7146789927901, 24.73283316192159, 62.82138939258104, 380.0], [46.71296078005463, 24.73266765974641, 62.896714938926536, 390.0], [46.71156267939981, 24.73359300207016, 61.914641237248496, 400.0], [46.71030886790801, 24.73463963741952, 73.48783163284861, 410.0], [46.71003856839505, 24.73645895928451, 86.43061981300623, 420.0], [46.709610565400695, 24.738582814955134, 74.60282546216871, 430.0], [46.708666446147966, 24.74023750352571, 67.78503822998019, 440.0], [46.707752120900054, 24.741713263591432, 86.19666590028231, 450.0], [46.706922876991385, 24.743730559734402, 69.9421197236055, 460.0], [46.705960681018595, 24.745243575088775, 65.04605264364348, 470.0], [46.70545557361485, 24.746802406357638, 86.5759221830036, 480.0], [46.70419670580401, 24.748638307093145, 63.56055080850766, 490.0], [46.70360471943771, 24.750132339916973, 72.2909243346001, 500.0], [46.70265614835379, 24.75171955413474, 61.76286911093501, 510.0], [46.70231513534484, 24.753231063779296, 31.078707667069093, 520.0], [46.70304931893723, 24.75362886559588, 39.58092590851811, 530.0], [46.704081421931114, 24.75394383832781, 21.356498465657356, 540.0], [46.70460375006096, 24.754188053283084, 31.621299989719674, 550.0], [46.70538123646147, 24.754542315188193, 40.29637024381209, 560.0], [46.70641610531387, 24.75490310603679, 26.418170041995683, 570.0], [46.706884928513475, 24.7543988385798, 34.58589895914219, 580.0], [46.70717559252635, 24.753576150418542, 26.617845470024484, 590.0], [46.70766040417854, 24.753077836701575, 15.429988096659596, 600.0], [46.707899746921655, 24.75339617108327, 21.381927181406443, 610.0], [46.7083941382164, 24.753685552011497, 26.707232431382018, 620.0], [46.70884094701407, 24.754215165066526, 22.66837503853655, 630.0], [46.70937764165098, 24.754503501260746, 20.048969992282334, 640.0], [46.70982257110892, 24.75479946608741, 32.7160345422217, 650.0], [46.71032173905926, 24.75547952148635, 19.699705916314297, 660.0], [46.71081070730831, 24.755691695928252, 28.864735393060574, 670.0], [46.71133697718751, 24.756231654003717, 10.581266569694314, 670.0], [46.71142123010069, 24.756484671393224, 10.581266569694314, 680.0]], "matched": [[46.710059024284035, 24.725519554653065], [46.71006418877337, 24.725492409239745], [46.75600900925259, 24.56044776107507], [46.69472901520872, 24.76108637792903], [46.694704212194075, 24.761307865125538], [46.69472901520872, 24.76108637792903], [46.69503224395465, 24.760979112663716], [46.80973002956358, 24.80886610153199]]}, {"id": "6224292", "pickup": "2016-1-19T5:1:50+00:00", "duration": 530.0, "gps": [[46.75159018247987, 24.740527347524154, 38.58303378285062, 10.0], [46.752043373855216, 24.73965580083052, 47.599323657757324, 20.0], [46.75265614752695, 24.738604994134228, 47.59251525339347, 30.0], [46.75333936530534, 24.7375908553126, 79.76300312447786, 40.0], [46.75404008886001, 24.7357026536409, 81.82590183787775, 50.0], [46.75513151683612, 24.733915000450743, 66.07751598673516, 60.0], [46.75594498311502, 24.732438891963923, 84.47765145298635, 70.0], [46.75693394865058, 24.730529255741114, 82.68228856614516, 80.0], [46.7575674354943, 24.72854551903084, 84.77689126445664, 90.0], [46.75882253191495, 24.72676070700745, 67.75389914862188, 100.0], [46.75953735643414, 24.725197626668976, 79.50120093872044, 110.0], [46.760444761538885, 24.723390701864457, 68.63838710742144, 120.0], [46.76126833537101, 24.72184783272416, 64.37874243359984, 130.0], [46.7619810171047, 24.720375623214746, 71.99818908846105, 140.0], [46.76296639651287, 24.718815565961574, 62.71267739965446, 150.0], [46.76388322988058, 24.717488636703063, 85.75360203525595, 160.0], [46.765098565445406, 24.715652794050726, 72.47338131207026, 170.0], [46.76631486413556, 24.71421856011333, 82.96429086690883, 180.0], [46.76721693280857, 24.712314895051527, 75.97980424866918, 190.0], [46.76855670334818, 24.71085840527524, 75.90605151105055, 200.0], [46.76959066332904, 24.709211166194837, 69.10990428312185, 210.0], [46.770494971850844, 24.707692704843605, 80.18463755189521, 220.0], [46.771718636097056, 24.706026370966335, 84.4613982860101, 230.0], [46.77250747576392, 24.70404185832496, 77.21478130606806, 240.0], [46.77339516992076, 24.702289620237135, 72.5644121478067, 250.0], [46.77400733545285, 24.700564299168608, 88.49174076244545, 260.0], [46.77470429738455, 24.69844629840219, 65.4751315735645, 270.0], [46.7753089106323, 24.696905650697282, 78.784321820416, 280.0], [46.77606738784023, 24.695062109507713, 80.30603837918665, 290.0], [46.77652050305063, 24.693098666323465, 84.23596958624563, 300.0], [46.77728914958978, 24.69111361883933, 77.58453155719931, 310.0], [46.777640204415256, 24.68920189344976, 46.91398633412799, 320.0], [46.77784555448849, 24.6880448750642, 44.438273519075054, 330.0], [46.77789623475295, 24.686935711087667, 46.638212956749435, 340.0], [46.77790206957626, 24.68577064668948, 54.50127222250724, 350.0], [46.778042887303194, 24.684415167366513, 50.76850453980266, 360.0], [46.77682146803026, 24.68380133286337, 51.443671598724514, 370.0], [46.77553726057821, 24.68326285302393, 52.79367562942956, 380.0], [46.774148667209836, 24.682878899135684, 47.94597804190106, 390.0], [46.77546474598864, 24.682811231355995, 45.65383247832363, 400.0], [46.77657525743696, 24.683342770486334, 47.96708249096282, 410.0], [46.777829476005074, 24.683713078929355, 49.468990457547164, 420.0], [46.77869779487139, 24.68276192575579, 36.15870735345373, 430.0], [46.778410021526106, 24.68189731396006, 37.26351593931774, 440.0], [46.77751727619353, 24.68144066763935, 15.094794757868739, 450.0], [46.77719409426463, 24.681204111673917, 42.412291963434306, 460.0], [46.776048545067034, 24.68100640628567, 21.50072065590124, 470.0], [46.77550862580501, 24.68078776153999, 14.212944290747304, 480.0], [46.77526820212374, 24.680507869629704, 28.717415023964207, 490.0], [46.77523918168102, 24.67979096021355, 22.70293362488518, 500.0], [46.77491222976169, 24.679307852343598, 19.492628442337725, 510.0], [46.7751751646486, 24.678883545084503, 25.591897855209194, 520.0], [46.77533857370969, 24.678261711980028, 27.87541441694263, 530.0], [46.77497943447871, 24.677646553113043, 19.23509626413372, 530.0], [46.775227178314935, 24.677222034016182, 19.23509626413372, 540.0]], "matched": [[46.68775230259499, 24.774525644627726], [46.68774361543219, 24.774435454251112], [46.7567040150878, 24.61596649572446], [46.73559697073462, 24.633264925020026], [46.68064684518284, 24.57723013329689], [46.67425611876211, 24.573254070882427], [46.6759772006697, 24.57404076346692], [46.8069075732312, 24.883605986397964], [46.80407608990217, 24.88435313768117], [46.691575625468346, 24.71320178956477], [46.62291367558492, 24.56638082961987], [46.62386571814235, 24.565941673667382], [46.62476562569119, 24.56552564774096], [46.62489926427648, 24.565461000636898], [46.62577312033388, 24.565038929631985], [46.62685982850802, 24.56451703797144], [46.71540081129995, 24.647834763254618], [46.715374302087966, 24.64765900264291], [46.71520585896719, 24.64653908645862], [46.71610403917887, 24.650901065676084], [46.714474066792214, 24.650867768111816], [46.77905342410708, 24.696808308646297], [46.778029095197034, 24.699402648276394], [46.77905342410708, 24.696808308646297], [46.729076152436924, 24.64173243697969], [46.778515902540626, 24.69662508314936], [46.71010201067916, 24.61703884063725], [46.71225798798924, 24.618014252254685], [46.71010201067916, 24.61703884063725], [46.7103010833439, 24.61397576379759], [46.71034994690472, 24.613255600902836], [46.7104652221792, 24.611569939376697], [46.71010201067916, 24.61703884063725], [46.707658291181076, 24.726124780594613], [46.70766191127036, 24.726122030686064], [46.70766564253398, 24.726120182393316], [46.86296970043186, 24.489285956624865], [46.707669262622964, 24.726117432484603], [46.707672993886334, 24.726115584191692], [46.70767661397501, 24.726112834282816], [46.70768034523813, 24.726110985989738], [46.70768396532651, 24.726108236080705], [46.75883237891927, 24.5616761387565], [46.680895508613894, 24.91085393426155], [46.80312914486682, 24.632776614880854], [46.681092345436404, 24.91090633744022], [46.68135705382871, 24.9109846092282], [46.834269001224015, 24.74803174512144], [46.62815779092937, 24.717754998143313], [46.6094542171308, 24.83660347467141], [46.835986784541234, 24.749078299517265], [46.78804219092599, 24.65212026603629], [46.69284282968864, 24.617514098857345], [46.834269001224015, 24.74803174512144]]}, {"id": "6335313", "pickup": "2016-3-3T12:41:24+00:00", "duration": 1150.0, "gps": [[46.79395587336556, 24.773565609361974, 22.256417814411783, 10.0], [46.794300913613334, 24.773106286775942, 39.93554960065241, 20.0], [46.794835199365686, 24.772234543059366, 21.21129434642999, 30.0], [46.795230764625586, 24.771844959578136, 34.355171308333034, 40.0], [46.79567663763812, 24.771088215747753, 32.014656465660515, 50.0], [46.796201337247616, 24.770445843238743, 31.010005060909283, 60.0], [46.796840392971724, 24.76993261265426, 37.14745323243187, 70.0], [46.79715850821491, 24.76905072551101, 24.20064116967455, 80.0], [46.797725261777494, 24.76873344951035, 38.590968159942776, 90.0], [46.79812332857436, 24.767839726053563, 28.270664071012288, 100.0], [46.798626113842666, 24.76730089328861, 33.06612048852109, 110.0], [46.799207122558244, 24.76666528453283, 22.914001843016834, 120.0], [46.79908395943064, 24.76610389733772, 52.46960093129395, 130.0], [46.79779548255426, 24.765512937940848, 54.620485793059295, 140.0], [46.7966500763743, 24.76462971945911, 34.079632470841965, 150.0], [46.795960449156944, 24.764052954311456, 54.40802626051865, 160.0], [46.794682243814094, 24.763345696677465, 45.543226765078366, 170.0], [46.79359301035712, 24.762783432352673, 43.585564387228054, 180.0], [46.79257800497398, 24.762203747374897, 48.809669939330064, 190.0], [46.79153077363929, 24.76144056410399, 30.99226429822376, 200.0], [46.79207832716873, 24.76084709933755, 49.02856377250026, 210.0], [46.79251994023258, 24.75968981883034, 33.68207818846299, 220.0], [46.79315358160745, 24.759075892831095, 38.21876129169308, 230.0], [46.79351508925216, 24.75817935563744, 56.080820985597825, 240.0], [46.79455220543226, 24.757142182876095, 34.15032778224006, 250.0], [46.79511847564011, 24.756461465641355, 47.37353845301181, 260.0], [46.7956731842646, 24.755390578591, 43.699011063582915, 270.0], [46.79634322583399, 24.75448422958627, 49.97714899447659, 280.0], [46.79728403406862, 24.75357385211743, 46.24074009780958, 290.0], [46.79790085158134, 24.752563603280276, 45.17920741721293, 300.0], [46.798369242763506, 24.751518197858566, 56.80026955246884, 310.0], [46.79952080124947, 24.750559165552552, 49.30178862087735, 320.0], [46.80014737919231, 24.74946687867894, 50.79782496651514, 330.0], [46.80091268214086, 24.74840513870803, 39.79635237050732, 340.0], [46.80139475968555, 24.747512568971302, 37.34996793267904, 350.0], [46.802085746177646, 24.746822075634476, 45.9422042510425, 360.0], [46.802834579934014, 24.745897576779367, 42.027657307066, 370.0], [46.80350367552654, 24.74504139797718, 29.062104685678325, 380.0], [46.8029632239531, 24.744506448411563, 59.30999141841302, 390.0], [46.80178461418428, 24.743482006314306, 45.428864971847254, 400.0], [46.80079610954966, 24.742787773788756, 48.71159776213904, 410.0], [46.79961778674565, 24.742208502157155, 63.06565088141842, 420.0], [46.79816037490137, 24.741354063428172, 57.38114656377011, 430.0], [46.797012845282964, 24.740369891148653, 78.27267213381816, 440.0], [46.79513035457578, 24.73942107444159, 71.85179453166856, 450.0], [46.793627272610955, 24.738255649237455, 73.41643057728847, 460.0], [46.79189614388315, 24.737311386650823, 95.57004591578445, 470.0], [46.78975094650872, 24.735931594156742, 61.25352141251267, 480.0], [46.78845271142071, 24.734956332597406, 72.51998744714109, 490.0], [46.78676196116392, 24.733995166892242, 88.1375285088853, 500.0], [46.78473925450662, 24.73278162109503, 70.25621301797835, 510.0], [46.783088968373335, 24.731868613936317, 89.97817160720025, 520.0], [46.78104976732342, 24.730595075517208, 78.38212143813338, 530.0], [46.77939872216326, 24.729336036037264, 61.02704910883528, 540.0], [46.77797477096137, 24.728528959540625, 76.18160342934824, 550.0], [46.77613074108598, 24.727625417602106, 75.9868363298511, 560.0], [46.77457260676395, 24.72636038020609, 68.73821677022202, 570.0], [46.77293667478697, 24.72549980064234, 88.96242825131345, 580.0], [46.770911034592686, 24.72425336507569, 86.85541013253761, 590.0], [46.76896625036021, 24.722993513585088, 71.85865537451025, 600.0], [46.76728284318027, 24.72205317170407, 82.94696240415117, 610.0], [46.76544712299019, 24.720823067853964, 72.85026448682882, 620.0], [46.76383063897959, 24.719747927764715, 72.0900566190586, 630.0], [46.762180313905134, 24.718749975680474, 86.1157096496874, 640.0], [46.76005499633635, 24.717800868787304, 65.76723008261413, 650.0], [46.75877718406227, 24.716638141976514, 78.06486477924446, 660.0], [46.75706856397614, 24.715457427205838, 83.3282239294062, 670.0], [46.755060681100595, 24.714454242543372, 70.68474952759799, 680.0], [46.7535988081674, 24.713290419674323, 73.6019402671907, 690.0], [46.75182946316661, 24.712397521378445, 86.03417937400957, 700.0], [46.75002702671028, 24.71100532579482, 69.16870691645774, 710.0], [46.748380314131936, 24.71014051570676, 62.80211168293908, 720.0], [46.74700687455973, 24.709189392695816, 82.22063876142447, 730.0], [46.745113136371664, 24.708067274615587, 68.61240869855487, 740.0], [46.743564781356625, 24.707087830786374, 81.80726070464563, 750.0], [46.7416500006791, 24.706015172634377, 89.76798490066443, 760.0], [46.739847970013905, 24.70448260076875, 83.19324964694303, 770.0], [46.737975505386885, 24.703288678470454, 79.1030520242219, 780.0], [46.735984962882, 24.702492017673382, 64.67385929417198, 790.0], [46.734331276985834, 24.701897740471527, 65.33367275026868, 800.0], [46.73259432289109, 24.701481024792795, 68.73813891852713, 810.0], [46.73088305538316, 24.70075192827958, 63.70034765798261, 820.0], [46.729265396227085, 24.700141692935805, 77.68207161487524, 830.0], [46.72717730907688, 24.699732913055044, 97.17189044432847, 840.0], [46.724687977041384, 24.698850985454225, 72.05007941534915, 850.0], [46.72282029396158, 24.698250648934412, 72.03113465967199, 860.0], [46.720971487247226, 24.69760522061823, 87.75345385873112, 870.0], [46.71888356479807, 24.696506455084073, 55.58251136222275, 880.0], [46.7175470836905, 24.695832962034142, 71.88217419824589, 890.0], [46.71578081018976, 24.695027126802152, 46.10056077962382, 900.0], [46.714782181632884, 24.694317837192482, 56.908430100133224, 910.0], [46.71342603799346, 24.693608670103423, 55.508990528598275, 920.0], [46.712749358081275, 24.692365732390563, 49.268289911381444, 930.0], [46.7122247535711, 24.69123099369618, 45.686293774993004, 940.0], [46.712160740132035, 24.690091180201115, 51.09708418463316, 950.0], [46.711392152922585, 24.689022675971856, 47.97881477772839, 960.0], [46.71076825517418, 24.68796663568354, 51.37047357544363, 970.0], [46.70977403022739, 24.687055154425938, 44.77593363341625, 980.0], [46.70894724462643, 24.6862264024644, 57.241449056373035, 990.0], [46.70831230727305, 24.684917987206052, 47.31492945693027, 1000.0], [46.707559743288535, 24.68395387949773, 56.55260677215158, 1010.0], [46.70658266591781, 24.682854938889797, 34.14003156784233, 1020.0], [46.70619170261254, 24.68207958865026, 52.81068113702911, 1030.0], [46.70525169346594, 24.681074135367716, 47.90569440669142, 1040.0], [46.70447848152209, 24.68010533779297, 62.45896385182527, 1050.0], [46.70511217993586, 24.67865517793523, 48.192317508891676, 1060.0], [46.70571868983965, 24.67758482943632, 52.75413161944406, 1070.0], [46.70637477292672, 24.676409526124317, 48.17587016430084, 1080.0], [46.70682676394392, 24.675278289187066, 42.9682952406224, 1090.0], [46.707189563970644, 24.67425677171996, 48.34696302195209, 1100.0], [46.70764081390669, 24.673120748027394, 47.540040502088964, 1110.0], [46.70798742960538, 24.671975672356478, 45.54582730001281, 1120.0], [46.708438381225314, 24.670914241853712, 36.111204025022865, 1130.0], [46.708825949443664, 24.670083733372895, 36.43679444722799, 1140.0], [46.70862067686907, 24.66919281901009, 34.94361310612809, 1150.0], [46.707826812260045, 24.66870131674667, 39.199961563337496, 1150.0], [46.706932911894974, 24.66815443046504, 39.199961563337496, 1160.0]], "matched": [[46.74347976293917, 24.94306176627271], [46.85616755533508, 24.70450523130759], [46.58324117481873, 24.754377377831428], [46.67652111974945, 24.772934176381987], [46.57721353011235, 24.727938499179604], [46.90414618606365, 24.559676023213495], [46.93707607673333, 24.503339873551806], [46.805108865994, 24.814844633593644], [46.69494641433135, 24.58842873562737], [46.72353939439655, 24.773126759544112], [46.845784568834034, 24.837823990139054], [46.72008088541951, 24.79616769337708], [46.70935071913564, 24.755755637418837], [46.6744605613468, 24.606736146288682], [46.68438487575164, 24.76253264564109], [46.62057105020917, 24.666330111119297], [46.5753710037316, 24.751604923743994], [46.697940620058446, 24.63463241201187]]}, {"id": "3056923", "pickup": "2016-0-18T12:1:57+00:00", "duration": 1390.0, "gps": [[46.79056463637158, 24.69219611242706, 54.09337036113081, 10.0], [46.78955090106356, 24.693184917631484, 34.93720054783023, 20.0], [46.789063337982746, 24.693936915565814, 60.52452810061557, 30.0], [46.788277244577216, 24.695269572717248, 30.575727075761442, 40.0], [46.78783936359564, 24.695921604692597, 47.615340823770126, 50.0], [46.78711991946567, 24.69691540181015, 52.297080807826084, 60.0], [46.78635694967901, 24.69802278303943, 44.784617246419515, 70.0], [46.785447980716725, 24.698777552563566, 47.55003045066079, 80.0], [46.784685582591514, 24.699742558327337, 40.250973996517246, 90.0], [46.78407683102411, 24.700582315571026, 51.27403390722348, 100.0], [46.78327592603005, 24.701636465122, 39.72195767165476, 110.0], [46.78227304260222, 24.702029569022056, 48.21909128968062, 120.0], [46.78099620751318, 24.701704929461812, 48.4677231061224, 130.0], [46.77987071038984, 24.7010565030811, 64.75856175840566, 140.0], [46.778120709521055, 24.700757536511524, 50.40765051259545, 150.0], [46.776875543073324, 24.700204376552335, 43.50359013393281, 160.0], [46.77572461299654, 24.69990818553473, 33.8760651716435, 170.0], [46.77481123073917, 24.700074221848524, 66.16586287384251, 180.0], [46.77406429688568, 24.701581401912666, 39.184170877097095, 190.0], [46.7734874579303, 24.702408169875685, 51.106892425541176, 200.0], [46.772961899574334, 24.703592237432332, 65.28434862130382, 210.0], [46.77222419507781, 24.70507905069489, 92.89758566673632, 220.0], [46.77107717312236, 24.707152640828376, 62.349449737817565, 230.0], [46.77016219473331, 24.70846986587879, 87.88817778029875, 240.0], [46.76909462006101, 24.710439604015583, 61.72158897951138, 250.0], [46.768274028532126, 24.711789304511452, 73.27328751447939, 260.0], [46.76710018168427, 24.713277076938095, 80.5272410927506, 270.0], [46.76590949491281, 24.714973212394487, 82.41221233723377, 280.0], [46.76476690263284, 24.716751182743224, 73.88472129894902, 290.0], [46.76357664092819, 24.718247072859736, 79.86799992499964, 300.0], [46.7625942121229, 24.72003156490442, 78.73588159728672, 310.0], [46.76159984402546, 24.72177882153137, 70.88990510802019, 320.0], [46.76087317395532, 24.723422123542225, 87.46761227122434, 330.0], [46.759628493160015, 24.725291934831752, 69.73883742324206, 340.0], [46.75910391296619, 24.72696766507621, 69.05099881848828, 350.0], [46.75821183805945, 24.728490486761356, 85.07061145487911, 360.0], [46.75720763037991, 24.730409955548286, 79.84987288290395, 370.0], [46.75641406817438, 24.73226992266061, 84.95637896033695, 380.0], [46.75530970432581, 24.734140236061208, 71.90519845094208, 390.0], [46.754577969886284, 24.735809041213397, 61.40607111442166, 400.0], [46.75366908757754, 24.737101988893965, 78.35305904229719, 410.0], [46.75280429149034, 24.738894839019203, 71.27056027957181, 420.0], [46.75208419266183, 24.740550790040373, 66.47521676541149, 430.0], [46.751351798520325, 24.742072381218577, 49.011965283662825, 440.0], [46.75104294150557, 24.743264192260458, 51.29702784437918, 450.0], [46.75038477618585, 24.744397702978294, 54.93748159020546, 460.0], [46.74892868831492, 24.74403061895919, 93.0032694132633, 470.0], [46.74675080952479, 24.742811746713443, 78.74487320779127, 480.0], [46.74494034026576, 24.74173192450819, 85.44456846103093, 490.0], [46.74309874819543, 24.740405769904786, 74.2833943831723, 500.0], [46.7411734886925, 24.739784370025614, 102.8827739573337, 510.0], [46.73860415637719, 24.738707225868175, 72.53403828903824, 520.0], [46.736773068258486, 24.73798780649179, 67.60795073081236, 530.0], [46.73502104077659, 24.73742177390552, 83.854131016726, 540.0], [46.7328137861647, 24.736814148635084, 84.14885405362764, 550.0], [46.73065784711704, 24.736049452772825, 61.380313001518104, 560.0], [46.728992634490616, 24.73579697841863, 69.86996619042154, 570.0], [46.727092397572, 24.735536494965704, 64.41352135624929, 580.0], [46.72537208856967, 24.73515183288043, 97.01123861958222, 590.0], [46.72278192065246, 24.73456982988512, 79.2179082923075, 600.0], [46.72065206223686, 24.734152543172687, 73.4138116269906, 610.0], [46.71869070180252, 24.733716726038157, 73.3625299374789, 620.0], [46.71674973681986, 24.733215854381367, 79.0888788319252, 630.0], [46.71466528384923, 24.732650919333558, 69.33311121810173, 640.0], [46.71277144024525, 24.73285361534827, 38.79459196068341, 650.0], [46.711897125782315, 24.733409141058274, 63.514877861366664, 660.0], [46.71058336081021, 24.734454948833644, 50.223120860295815, 670.0], [46.71036940624641, 24.73569444000693, 64.19099043779624, 680.0], [46.70997977696699, 24.73725847060755, 72.71595880022434, 690.0], [46.709241898358066, 24.738946859571357, 86.5867291598756, 700.0], [46.70830484142389, 24.7409354369154, 73.74021735995834, 710.0], [46.7073094177256, 24.742540456932375, 77.70350353430953, 720.0], [46.70671841162363, 24.74440589605421, 62.14615651884522, 730.0], [46.70593716531982, 24.745786764018234, 55.28907574959964, 740.0], [46.705332254361075, 24.74705399481403, 37.30666654614586, 750.0], [46.70491823711024, 24.74790674584882, 54.996471701313936, 760.0], [46.70391063418784, 24.748931538538613, 47.77089885549333, 770.0], [46.70268006647904, 24.748512928149268, 52.111386719852966, 780.0], [46.70136281357441, 24.74799948308348, 59.35138447323882, 790.0], [46.69986682822163, 24.747405748005722, 54.699187776138935, 800.0], [46.69859974131828, 24.746668850780146, 46.87545681528144, 810.0], [46.69740080784683, 24.746237935406214, 48.230482947461624, 820.0], [46.69615744466989, 24.74581769023269, 48.90960967300821, 830.0], [46.69502169587587, 24.745162761970413, 81.545454814612, 840.0], [46.693014269294146, 24.744253888426048, 77.73647397327608, 850.0], [46.69098930254581, 24.74363014531557, 80.35754675031146, 860.0], [46.68915718723577, 24.74250714179237, 73.6764543508379, 870.0], [46.6872957406901, 24.74177946833621, 66.31686191734369, 880.0], [46.68567646475568, 24.7410167161131, 64.68345693449587, 890.0], [46.68395451064782, 24.740610199512464, 81.9020035317895, 900.0], [46.68195477303404, 24.73966807977398, 71.9285192028284, 910.0], [46.68020030768385, 24.73883763718703, 72.33862178868941, 920.0], [46.67836344095412, 24.738143073034, 63.93277480866015, 930.0], [46.67678051793387, 24.737447441372062, 76.9278399364297, 940.0], [46.67494478588564, 24.736491785127388, 71.04161096581238, 950.0], [46.6730838499467, 24.735950633545773, 84.23067308195411, 960.0], [46.67097825894452, 24.735072969454695, 82.90691892462598, 970.0], [46.66891840286796, 24.73418453031784, 75.01738267542265, 980.0], [46.66707728714997, 24.733338568620187, 66.52797037867846, 990.0], [46.66537981322375, 24.73271805281776, 75.28746739479453, 1000.0], [46.663505416522554, 24.731918735005852, 68.95637414375385, 1010.0], [46.661851536643525, 24.73107562740565, 83.9748024617899, 1020.0], [46.65977715875126, 24.73015324859856, 66.23015715130087, 1030.0], [46.658094861953195, 24.729518770463383, 74.6360459572325, 1040.0], [46.656200462479944, 24.728800703378596, 74.41388645445426, 1050.0], [46.65437330874745, 24.727963216049044, 73.79702497292087, 1060.0], [46.652489628475685, 24.727276747182078, 80.7086220400772, 1070.0], [46.650619344159374, 24.726190880388906, 39.29619537282451, 1080.0], [46.64954017381406, 24.726137814867545, 48.691650204070825, 1090.0], [46.64830054252767, 24.72567767123219, 40.763341663923626, 1100.0], [46.64747780206052, 24.72636940359987, 41.84977805037653, 1110.0], [46.64695737653224, 24.727301886379344, 51.8524095398977, 1120.0], [46.6460230977454, 24.728280532476347, 51.256965189390534, 1130.0], [46.64533996405749, 24.729400607008824, 53.388372862283, 1140.0], [46.64460563612649, 24.730555552462555, 36.56833915612732, 1150.0], [46.644154942665864, 24.73137221923168, 46.888554313314785, 1160.0], [46.64344500237163, 24.732350084179554, 50.96696034876285, 1170.0], [46.64255863361353, 24.733336466397052, 46.15839880655628, 1180.0], [46.6417704544115, 24.73424042595496, 45.883062259442944, 1190.0], [46.64073685894025, 24.734898084075468, 41.231953463143206, 1200.0], [46.639978326164055, 24.73566379260457, 45.35392459332302, 1210.0], [46.63920401842903, 24.73655210466864, 58.93878570104324, 1220.0], [46.63803164307203, 24.73756898791, 47.74105105768224, 1230.0], [46.63700146970846, 24.73830854464124, 57.605202900321444, 1240.0], [46.63598261514381, 24.739410623999586, 46.46690432467385, 1250.0], [46.63472114470258, 24.739597274234036, 51.556722580655865, 1260.0], [46.63573445791383, 24.73869625886254, 52.91907788479578, 1270.0], [46.636826534910206, 24.737822272482035, 56.80256738092977, 1280.0], [46.638078850145995, 24.7369738198781, 51.38212748476721, 1290.0], [46.639078769617775, 24.736066725488197, 40.012104846828905, 1300.0], [46.639924697213964, 24.7354273547306, 46.47878505135968, 1310.0], [46.64056981714802, 24.73442494659263, 41.21829658812659, 1320.0], [46.64129851160776, 24.73363614689632, 54.50033456508885, 1330.0], [46.64228835777809, 24.732613722701565, 44.37528675291557, 1340.0], [46.64298352887009, 24.73170256890628, 43.93059392099799, 1350.0], [46.6437451103986, 24.73085058377268, 49.29156951659219, 1360.0], [46.64454020441367, 24.72985323023454, 36.315738993645446, 1370.0], [46.6451724698142, 24.729150928023213, 36.703271653732116, 1380.0], [46.6457783582505, 24.72841756088471, 53.20334951039838, 1390.0], [46.646612887771916, 24.727325827464632, 9.999296752123652, 1390.0], [46.64682605954337, 24.7274836442483, 9.999296752123652, 1400.0]], "matched": [[46.606470591207234, 24.721867056711872], [46.60653934866457, 24.721925008955967], [46.60661348448799, 24.721978388932282], [46.80150536612291, 24.630749301364983], [46.606648369302206, 24.72200058774454], [46.80532754847053, 24.7554257193929], [46.60666643979148, 24.722006714388204], [46.606745204523484, 24.722035665996295], [46.60972110602895, 24.72215451352227], [46.6069094501575, 24.722070021309538], [46.68609695872376, 24.736826232899027], [46.724266480823005, 24.618951871855884], [46.6900610697192, 24.675613427265706], [46.60682641153864, 24.722054659323295], [46.85394405684754, 24.804295338977486], [46.8581010589667, 24.808742054188354], [46.86883405451772, 24.84298988970046], [46.8581010589667, 24.808742054188354], [46.654136362822236, 24.704429916885832], [46.584742482928945, 24.729597169327025], [46.805619541403324, 24.63020063504352], [46.649548863999385, 24.634381480036087], [46.65537099694224, 24.701982970806235], [46.65975106905942, 24.703076717549717], [46.659056536423556, 24.702689837000836], [46.65887998621994, 24.702606014935146], [46.722585308949185, 24.59601468143112], [46.65865074518955, 24.702506523344248], [46.65841782098542, 24.70241248952908], [46.65818251026016, 24.70232480203414], [46.69613594073946, 24.667915441420735], [46.65794362709351, 24.702243473963218], [46.657702369302015, 24.70216939495834], [46.70991161284339, 24.726356403171188], [46.65745873684645, 24.702102565010193], [46.58941141561891, 24.59270033692149], [46.65843345576802, 24.734846245871708], [46.67381822178524, 24.607359983132234], [46.63674823299449, 24.781787311987358], [46.60027338403633, 24.672572633545386], [46.73649612397853, 24.63970789828096], [46.61154716332838, 24.655955667028646], [46.632602854197685, 24.86519011251964], [46.60172573718897, 24.671972949501846]]}, {"id": "4675972", "pickup": "2016-4-27T4:28:47+00:00", "duration": 720.0, "gps": [[46.76866061821129, 24.733461722342735, 33.119764333078145, 10.0], [46.76935796785098, 24.733994052770456, 26.54994143037962, 20.0], [46.77000842949555, 24.73429549624673, 23.791268103949093, 30.0], [46.77056270995752, 24.734611394071916, 37.87856732816128, 40.0], [46.771381362209084, 24.73519665684981, 26.152747052661105, 50.0], [46.772030319336615, 24.73547847955461, 30.25750620546197, 60.0], [46.77273417084623, 24.735881800142394, 25.395359578604538, 70.0], [46.773333556503594, 24.73620754661305, 47.167245384218056, 80.0], [46.77436882468947, 24.736917658404927, 19.219463128101058, 90.0], [46.774879662845926, 24.737041181619507, 39.647467431935794, 100.0], [46.77573167773361, 24.737659370328515, 33.93461684706018, 110.0], [46.77638034389971, 24.73826892325821, 42.176064487960566, 120.0], [46.77733730480738, 24.738864479688733, 29.769781480329865, 130.0], [46.77805765736717, 24.739218081191797, 25.531771857204063, 140.0], [46.77865997258819, 24.73954604178738, 26.2703672652279, 150.0], [46.77921075861753, 24.739970834416777, 37.061636898893454, 160.0], [46.78010143702854, 24.74042119091832, 24.31493939674877, 170.0], [46.78064909248338, 24.74076984449183, 38.05655638317702, 180.0], [46.781443056009834, 24.741389410279105, 33.45259960502443, 190.0], [46.78223551096008, 24.741814127331335, 27.935938146156044, 200.0], [46.78247410400897, 24.742477505545054, 46.84768011831708, 210.0], [46.7816013647722, 24.74333854053946, 41.045840693689584, 220.0], [46.78111412536234, 24.744263515122693, 41.19788147025181, 230.0], [46.7803197397549, 24.74499748139922, 51.758492885562376, 240.0], [46.77966262318652, 24.74614450898884, 45.91236351086421, 250.0], [46.77899279889999, 24.747116844219036, 47.99670638088473, 260.0], [46.77830360069213, 24.748139526276287, 50.345934540360496, 270.0], [46.777425442323825, 24.74911204793157, 52.485340824102174, 280.0], [46.77668425542179, 24.750237227337106, 47.329679192371884, 290.0], [46.77595886612869, 24.751219060105324, 38.3588231519732, 300.0], [46.776278501315666, 24.752132286090283, 44.44024942072885, 310.0], [46.77734841233791, 24.752669353791116, 55.05749248640069, 320.0], [46.77859447384018, 24.753451187538886, 54.69200978264065, 330.0], [46.77971251278067, 24.754365432218812, 37.868978134488785, 340.0], [46.78061274891785, 24.754841466853396, 59.32988373271572, 350.0], [46.781938497490295, 24.7557059244826, 46.09022748775908, 360.0], [46.78313491383946, 24.756087086474928, 44.72139692489116, 370.0], [46.78414606961011, 24.756723465109015, 50.65655352627434, 380.0], [46.785228328740516, 24.757520654613714, 42.18497607913004, 390.0], [46.786073052261195, 24.758243249169816, 44.722056397456896, 400.0], [46.78716379949895, 24.758760057550504, 45.595290177934594, 410.0], [46.788028002014755, 24.75958560137, 36.22021277828081, 420.0], [46.78901504372262, 24.75970945828141, 52.50662869257435, 430.0], [46.79001144089316, 24.76065910916027, 41.69172287543102, 440.0], [46.791055138274174, 24.761090988298704, 40.04297983016321, 450.0], [46.79073384572537, 24.762047816616196, 47.5401815295462, 460.0], [46.79019693821079, 24.763130738411448, 43.804672587128515, 470.0], [46.789277566199324, 24.763838220620908, 56.42579740141228, 480.0], [46.78845618535939, 24.765034312593425, 46.235013977935964, 490.0], [46.78781220278443, 24.76603035260701, 44.08260832514073, 500.0], [46.787115868817864, 24.766931979199203, 46.34894995043638, 510.0], [46.7865102727634, 24.767950918647696, 42.801351488050365, 520.0], [46.78581433209627, 24.76881342873572, 22.454659566915076, 530.0], [46.78637123500059, 24.769056234815075, 57.96274304507669, 540.0], [46.78538126142007, 24.770191409619656, 50.26421718347276, 550.0], [46.78478496597179, 24.77132433940801, 40.12256590594115, 560.0], [46.78410871982626, 24.772116551333532, 42.15341566823305, 570.0], [46.78355318306114, 24.773040921774264, 46.076539214836046, 580.0], [46.78278850986978, 24.77395899075597, 43.93054420059383, 590.0], [46.782135395031574, 24.774882413795467, 29.25928153521498, 600.0], [46.78197950214012, 24.77559950852643, 36.03875064691907, 610.0], [46.782726987041606, 24.776191042504177, 29.667292647420112, 620.0], [46.783519321964185, 24.776369158804886, 32.95536822754796, 630.0], [46.78422460416152, 24.776886557537587, 31.269046404704504, 640.0], [46.784902220232105, 24.777367865191273, 30.503008597045778, 650.0], [46.78559111344627, 24.777803096131922, 38.55024391983742, 660.0], [46.786273072064255, 24.77854069200242, 33.88797968504056, 670.0], [46.78714082267641, 24.77885043765791, 32.869673843559625, 680.0], [46.787903438426646, 24.7792918232642, 27.856510402640787, 690.0], [46.78852905684226, 24.779693840012527, 37.26690486368547, 700.0], [46.789352835376235, 24.78024819458426, 14.89724748167855, 710.0], [46.78975962212951, 24.780293920766187, 42.37420750035195, 720.0], [46.79068080724976, 24.780942797669443, 4.3221323991994165, 720.0], [46.7907960313078, 24.780969515878805, 4.3221323991994165, 730.0]], "matched": [[46.67645050389673, 24.754109745106547], [46.67920239009213, 24.62669196602754], [46.700133752018644, 24.664386852534477], [46.941461659528734, 24.529769124967363], [46.77202451340107, 24.68601424595766], [46.58870411449865, 24.725297951020305], [46.71097221670304, 24.72556781676734], [46.68723257731337, 24.646331821579373], [46.55211474311589, 24.85215323145427], [46.56553773156946, 24.650661884047953], [46.7109753054495, 24.72556958726008], [46.69731928055647, 24.432911416197175], [46.90123525129024, 24.893612316558464], [46.71097840655383, 24.725572260493667], [46.71098218717847, 24.725574023085453], [46.710985251209536, 24.725573988096116], [46.71098904419218, 24.725576653428643], [46.71099213293908, 24.725578423920997], [46.71099523404399, 24.725581097154215], [46.711040082663324, 24.725607671461194]]}];
        
        var map = L.map('map').setView([24.7, 46.75], 12);
        var currentTile = null;
        
        var tiles = {
            osm: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap',
                maxZoom: 19
            }),
            carto: L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: 'Â© CartoDB',
                maxZoom: 19
            }),
            cartodk: L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: 'Â© CartoDB',
                maxZoom: 19
            }),
            esri: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Â© ESRI',
                maxZoom: 19
            })
        };
        
        currentTile = tiles.osm;
        currentTile.addTo(map);
        
        function changeMapStyle() {
            var style = document.getElementById('mapStyle').value;
            if (currentTile) map.removeLayer(currentTile);
            currentTile = tiles[style];
            currentTile.addTo(map);
        }
        
        var layers = [];
        var currentTrip = 0;
        
        function clearLayers() {
            layers.forEach(l => map.removeLayer(l));
            layers = [];
        }
        
        function updateView() {
            loadTrip();
        }
        
        function loadTrip() {
            clearLayers();
            currentTrip = parseInt(document.getElementById('tripSelect').value);
            var trip = trips[currentTrip];
            var bounds = [];
            
            // Update info
            document.getElementById('infoId').textContent = trip.id;
            document.getElementById('infoTime').textContent = trip.pickup;
            document.getElementById('infoDuration').textContent = Math.round(trip.duration) + ' seconds';
            document.getElementById('infoGps').textContent = trip.gps.length;
            document.getElementById('infoRoute').textContent = trip.matched.length;
            
            // GPS track
            if (document.getElementById('showGps').checked && trip.gps.length > 0) {
                var gpsLL = trip.gps.map(p => [p[1], p[0]]);
                var gpsLine = L.polyline(gpsLL, {
                    color: '#e74c3c',
                    weight: 4,
                    opacity: 0.8,
                    dashArray: '10,6'
                });
                layers.push(gpsLine);
                gpsLine.addTo(map);
                bounds = bounds.concat(gpsLL);
                
                // GPS points
                if (document.getElementById('showPoints').checked) {
                    trip.gps.forEach((p, i) => {
                        var m = L.circleMarker([p[1], p[0]], {
                            radius: 4,
                            color: '#c0392b',
                            fillColor: '#e74c3c',
                            fillOpacity: 0.7,
                            weight: 1
                        });
                        m.bindPopup('<b>GPS Point ' + i + '</b><br>Speed: ' + p[2].toFixed(1) + ' km/h<br>Time: ' + p[3] + 's');
                        layers.push(m);
                        m.addTo(map);
                    });
                }
            }
            
            // Matched route
            if (document.getElementById('showMatched').checked && trip.matched.length > 0) {
                var matchLL = trip.matched.map(p => [p[1], p[0]]);
                var matchLine = L.polyline(matchLL, {
                    color: '#3498db',
                    weight: 5,
                    opacity: 0.9
                });
                layers.push(matchLine);
                matchLine.addTo(map);
                bounds = bounds.concat(matchLL);
                
                // Start marker
                var start = L.marker(matchLL[0], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: '<div style="background:#27ae60;width:20px;height:20px;border-radius:50%;border:3px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;color:white;font-size:10px;font-weight:bold;">S</div>',
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    })
                });
                start.bindPopup('<b>START</b><br>' + trip.pickup);
                layers.push(start);
                start.addTo(map);
                
                // End marker
                var end = L.marker(matchLL[matchLL.length-1], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: '<div style="background:#9b59b6;width:20px;height:20px;border-radius:50%;border:3px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;color:white;font-size:10px;font-weight:bold;">E</div>',
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    })
                });
                end.bindPopup('<b>END</b>');
                layers.push(end);
                end.addTo(map);
            }
            
            if (bounds.length > 0) {
                map.fitBounds(bounds, {padding: [60, 60]});
            }
        }
        
        // Load first trip
        loadTrip();
    </script>
</body>
</html>