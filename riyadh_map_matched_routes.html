<!DOCTYPE html>
<html>
<head>
    <title>Riyadh Taxi - Map Matched Routes</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; }
        .container { display: flex; height: 100vh; }
        #map { flex: 1; }
        .panel { width: 400px; background: #0d1117; color: #c9d1d9; display: flex; flex-direction: column; }
        .header { background: linear-gradient(135deg, #238636, #1f6feb); padding: 15px; }
        .header h1 { font-size: 14px; color: #fff; }
        .header p { font-size: 10px; color: rgba(255,255,255,0.8); margin-top: 5px; }
        .controls { padding: 10px; display: flex; gap: 8px; background: #161b22; border-bottom: 1px solid #30363d; }
        .controls button { flex: 1; padding: 8px; background: #21262d; border: 1px solid #30363d; color: #c9d1d9; border-radius: 4px; cursor: pointer; font-size: 11px; }
        .controls button:hover { background: #30363d; }
        .controls button.active { background: #238636; border-color: #238636; }
        .status { padding: 8px 12px; background: #161b22; font-size: 11px; border-bottom: 1px solid #30363d; }
        .trip-list { flex: 1; overflow-y: auto; }
        .trip-item { padding: 12px; border-bottom: 1px solid #21262d; cursor: pointer; }
        .trip-item:hover { background: #161b22; }
        .trip-item.active { background: #238636; border-left: 4px solid #3fb950; }
        .trip-item h4 { color: #58a6ff; font-size: 12px; }
        .trip-item p { font-size: 10px; color: #8b949e; margin-top: 3px; }
        .legend { position: absolute; bottom: 20px; left: 10px; background: white; padding: 12px; border-radius: 8px; font-size: 11px; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .legend-item { display: flex; align-items: center; margin: 4px 0; }
        .legend-color { width: 30px; height: 4px; margin-right: 8px; border-radius: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="map"></div>
        <div class="panel">
            <div class="header">
                <h1>üöï Riyadh Taxi - Map Matched Routes</h1>
                <p>GPS trajectories matched to road network</p>
            </div>
            <div class="controls">
                <button id="btn-gps" onclick="toggleLayer('gps')" class="active">Show GPS</button>
                <button id="btn-matched" onclick="toggleLayer('matched')" class="active">Show Matched</button>
            </div>
            <div class="status" id="status">Click a trip to view</div>
            <div class="trip-list" id="trip-list"></div>
        </div>
    </div>
    
    <div class="legend">
        <b>Route Comparison</b>
        <div class="legend-item"><div class="legend-color" style="background:#e74c3c"></div> Raw GPS Track</div>
        <div class="legend-item"><div class="legend-color" style="background:#3498db"></div> Map Matched Route</div>
        <div class="legend-item"><span style="color:#27ae60;font-size:16px">‚óè</span>&nbsp; Start</div>
        <div class="legend-item"><span style="color:#9b59b6;font-size:16px">‚óè</span>&nbsp; End</div>
    </div>

    <script>
        var map = L.map('map').setView([24.7, 46.75], 11);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        var trips = [{"id": "3056923", "matched": [[46.67287757463928, 24.735723955147208], [46.67277746487916, 24.73568263723248], [46.671248205488006, 24.73503788720571], [46.67054356760913, 24.73474327816141], [46.6699115533718, 24.73447494285265], [46.668650792250844, 24.733945450620716], [46.66835562337379, 24.733822333227835], [46.665642106093586, 24.732678767304925]], "gps": [[46.79056463637158, 24.69219611242706], [46.78955090106356, 24.693184917631484], [46.789063337982746, 24.693936915565814], [46.788277244577216, 24.695269572717248], [46.78783936359564, 24.695921604692597], [46.78711991946567, 24.69691540181015], [46.78635694967901, 24.69802278303943], [46.785447980716725, 24.698777552563566], [46.784685582591514, 24.699742558327337], [46.78407683102411, 24.700582315571026], [46.78327592603005, 24.701636465122], [46.78227304260222, 24.702029569022056], [46.78099620751318, 24.701704929461812], [46.77987071038984, 24.7010565030811], [46.778120709521055, 24.700757536511524], [46.776875543073324, 24.700204376552335], [46.77572461299654, 24.69990818553473], [46.77481123073917, 24.700074221848524], [46.77406429688568, 24.701581401912666], [46.7734874579303, 24.702408169875685], [46.772961899574334, 24.703592237432332], [46.77222419507781, 24.70507905069489], [46.77107717312236, 24.707152640828376], [46.77016219473331, 24.70846986587879], [46.76909462006101, 24.710439604015583], [46.768274028532126, 24.711789304511452], [46.76710018168427, 24.713277076938095], [46.76590949491281, 24.714973212394487], [46.76476690263284, 24.716751182743224], [46.76357664092819, 24.718247072859736], [46.7625942121229, 24.72003156490442], [46.76159984402546, 24.72177882153137], [46.76087317395532, 24.723422123542225], [46.759628493160015, 24.725291934831752], [46.75910391296619, 24.72696766507621], [46.75821183805945, 24.728490486761356], [46.75720763037991, 24.730409955548286], [46.75641406817438, 24.73226992266061], [46.75530970432581, 24.734140236061208], [46.754577969886284, 24.735809041213397], [46.75366908757754, 24.737101988893965], [46.75280429149034, 24.738894839019203], [46.75208419266183, 24.740550790040373], [46.751351798520325, 24.742072381218577], [46.75104294150557, 24.743264192260458], [46.75038477618585, 24.744397702978294], [46.74892868831492, 24.74403061895919], [46.74675080952479, 24.742811746713443], [46.74494034026576, 24.74173192450819], [46.74309874819543, 24.740405769904786], [46.7411734886925, 24.739784370025614], [46.73860415637719, 24.738707225868175], [46.736773068258486, 24.73798780649179], [46.73502104077659, 24.73742177390552], [46.7328137861647, 24.736814148635084], [46.73065784711704, 24.736049452772825], [46.728992634490616, 24.73579697841863], [46.727092397572, 24.735536494965704], [46.72537208856967, 24.73515183288043], [46.72278192065246, 24.73456982988512], [46.72065206223686, 24.734152543172687], [46.71869070180252, 24.733716726038157], [46.71674973681986, 24.733215854381367], [46.71466528384923, 24.732650919333558], [46.71277144024525, 24.73285361534827], [46.711897125782315, 24.733409141058274], [46.71058336081021, 24.734454948833644], [46.71036940624641, 24.73569444000693], [46.70997977696699, 24.73725847060755], [46.709241898358066, 24.738946859571357], [46.70830484142389, 24.7409354369154], [46.7073094177256, 24.742540456932375], [46.70671841162363, 24.74440589605421], [46.70593716531982, 24.745786764018234], [46.705332254361075, 24.74705399481403], [46.70491823711024, 24.74790674584882], [46.70391063418784, 24.748931538538613], [46.70268006647904, 24.748512928149268], [46.70136281357441, 24.74799948308348], [46.69986682822163, 24.747405748005722], [46.69859974131828, 24.746668850780146], [46.69740080784683, 24.746237935406214], [46.69615744466989, 24.74581769023269], [46.69502169587587, 24.745162761970413], [46.693014269294146, 24.744253888426048], [46.69098930254581, 24.74363014531557], [46.68915718723577, 24.74250714179237], [46.6872957406901, 24.74177946833621], [46.68567646475568, 24.7410167161131], [46.68395451064782, 24.740610199512464], [46.68195477303404, 24.73966807977398], [46.68020030768385, 24.73883763718703], [46.67836344095412, 24.738143073034], [46.67678051793387, 24.737447441372062], [46.67494478588564, 24.736491785127388], [46.6730838499467, 24.735950633545773], [46.67097825894452, 24.735072969454695], [46.66891840286796, 24.73418453031784], [46.66707728714997, 24.733338568620187], [46.66537981322375, 24.73271805281776], [46.663505416522554, 24.731918735005852], [46.661851536643525, 24.73107562740565], [46.65977715875126, 24.73015324859856], [46.658094861953195, 24.729518770463383], [46.656200462479944, 24.728800703378596], [46.65437330874745, 24.727963216049044], [46.652489628475685, 24.727276747182078], [46.650619344159374, 24.726190880388906], [46.64954017381406, 24.726137814867545], [46.64830054252767, 24.72567767123219], [46.64747780206052, 24.72636940359987], [46.64695737653224, 24.727301886379344], [46.6460230977454, 24.728280532476347], [46.64533996405749, 24.729400607008824], [46.64460563612649, 24.730555552462555], [46.644154942665864, 24.73137221923168], [46.64344500237163, 24.732350084179554], [46.64255863361353, 24.733336466397052], [46.6417704544115, 24.73424042595496], [46.64073685894025, 24.734898084075468], [46.639978326164055, 24.73566379260457], [46.63920401842903, 24.73655210466864], [46.63803164307203, 24.73756898791], [46.63700146970846, 24.73830854464124], [46.63598261514381, 24.739410623999586], [46.63472114470258, 24.739597274234036], [46.63573445791383, 24.73869625886254], [46.636826534910206, 24.737822272482035], [46.638078850145995, 24.7369738198781], [46.639078769617775, 24.736066725488197], [46.639924697213964, 24.7354273547306], [46.64056981714802, 24.73442494659263], [46.64129851160776, 24.73363614689632], [46.64228835777809, 24.732613722701565], [46.64298352887009, 24.73170256890628], [46.6437451103986, 24.73085058377268], [46.64454020441367, 24.72985323023454], [46.6451724698142, 24.729150928023213], [46.6457783582505, 24.72841756088471], [46.646612887771916, 24.727325827464632], [46.64682605954337, 24.7274836442483]], "pickup_time": "2016-0-18T12:1:57+00:00", "num_edges": 162}, {"id": "6335313", "matched": [], "gps": [[46.79395587336556, 24.773565609361974], [46.794300913613334, 24.773106286775942], [46.794835199365686, 24.772234543059366], [46.795230764625586, 24.771844959578136], [46.79567663763812, 24.771088215747753], [46.796201337247616, 24.770445843238743], [46.796840392971724, 24.76993261265426], [46.79715850821491, 24.76905072551101], [46.797725261777494, 24.76873344951035], [46.79812332857436, 24.767839726053563], [46.798626113842666, 24.76730089328861], [46.799207122558244, 24.76666528453283], [46.79908395943064, 24.76610389733772], [46.79779548255426, 24.765512937940848], [46.7966500763743, 24.76462971945911], [46.795960449156944, 24.764052954311456], [46.794682243814094, 24.763345696677465], [46.79359301035712, 24.762783432352673], [46.79257800497398, 24.762203747374897], [46.79153077363929, 24.76144056410399], [46.79207832716873, 24.76084709933755], [46.79251994023258, 24.75968981883034], [46.79315358160745, 24.759075892831095], [46.79351508925216, 24.75817935563744], [46.79455220543226, 24.757142182876095], [46.79511847564011, 24.756461465641355], [46.7956731842646, 24.755390578591], [46.79634322583399, 24.75448422958627], [46.79728403406862, 24.75357385211743], [46.79790085158134, 24.752563603280276], [46.798369242763506, 24.751518197858566], [46.79952080124947, 24.750559165552552], [46.80014737919231, 24.74946687867894], [46.80091268214086, 24.74840513870803], [46.80139475968555, 24.747512568971302], [46.802085746177646, 24.746822075634476], [46.802834579934014, 24.745897576779367], [46.80350367552654, 24.74504139797718], [46.8029632239531, 24.744506448411563], [46.80178461418428, 24.743482006314306], [46.80079610954966, 24.742787773788756], [46.79961778674565, 24.742208502157155], [46.79816037490137, 24.741354063428172], [46.797012845282964, 24.740369891148653], [46.79513035457578, 24.73942107444159], [46.793627272610955, 24.738255649237455], [46.79189614388315, 24.737311386650823], [46.78975094650872, 24.735931594156742], [46.78845271142071, 24.734956332597406], [46.78676196116392, 24.733995166892242], [46.78473925450662, 24.73278162109503], [46.783088968373335, 24.731868613936317], [46.78104976732342, 24.730595075517208], [46.77939872216326, 24.729336036037264], [46.77797477096137, 24.728528959540625], [46.77613074108598, 24.727625417602106], [46.77457260676395, 24.72636038020609], [46.77293667478697, 24.72549980064234], [46.770911034592686, 24.72425336507569], [46.76896625036021, 24.722993513585088], [46.76728284318027, 24.72205317170407], [46.76544712299019, 24.720823067853964], [46.76383063897959, 24.719747927764715], [46.762180313905134, 24.718749975680474], [46.76005499633635, 24.717800868787304], [46.75877718406227, 24.716638141976514], [46.75706856397614, 24.715457427205838], [46.755060681100595, 24.714454242543372], [46.7535988081674, 24.713290419674323], [46.75182946316661, 24.712397521378445], [46.75002702671028, 24.71100532579482], [46.748380314131936, 24.71014051570676], [46.74700687455973, 24.709189392695816], [46.745113136371664, 24.708067274615587], [46.743564781356625, 24.707087830786374], [46.7416500006791, 24.706015172634377], [46.739847970013905, 24.70448260076875], [46.737975505386885, 24.703288678470454], [46.735984962882, 24.702492017673382], [46.734331276985834, 24.701897740471527], [46.73259432289109, 24.701481024792795], [46.73088305538316, 24.70075192827958], [46.729265396227085, 24.700141692935805], [46.72717730907688, 24.699732913055044], [46.724687977041384, 24.698850985454225], [46.72282029396158, 24.698250648934412], [46.720971487247226, 24.69760522061823], [46.71888356479807, 24.696506455084073], [46.7175470836905, 24.695832962034142], [46.71578081018976, 24.695027126802152], [46.714782181632884, 24.694317837192482], [46.71342603799346, 24.693608670103423], [46.712749358081275, 24.692365732390563], [46.7122247535711, 24.69123099369618], [46.712160740132035, 24.690091180201115], [46.711392152922585, 24.689022675971856], [46.71076825517418, 24.68796663568354], [46.70977403022739, 24.687055154425938], [46.70894724462643, 24.6862264024644], [46.70831230727305, 24.684917987206052], [46.707559743288535, 24.68395387949773], [46.70658266591781, 24.682854938889797], [46.70619170261254, 24.68207958865026], [46.70525169346594, 24.681074135367716], [46.70447848152209, 24.68010533779297], [46.70511217993586, 24.67865517793523], [46.70571868983965, 24.67758482943632], [46.70637477292672, 24.676409526124317], [46.70682676394392, 24.675278289187066], [46.707189563970644, 24.67425677171996], [46.70764081390669, 24.673120748027394], [46.70798742960538, 24.671975672356478], [46.708438381225314, 24.670914241853712], [46.708825949443664, 24.670083733372895], [46.70862067686907, 24.66919281901009], [46.707826812260045, 24.66870131674667], [46.706932911894974, 24.66815443046504]], "pickup_time": "2016-3-3T12:41:24+00:00", "num_edges": 139}, {"id": "4675972", "matched": [[46.77939001984828, 24.740080715066053], [46.77953310701177, 24.74011061503002]], "gps": [[46.76866061821129, 24.733461722342735], [46.76935796785098, 24.733994052770456], [46.77000842949555, 24.73429549624673], [46.77056270995752, 24.734611394071916], [46.771381362209084, 24.73519665684981], [46.772030319336615, 24.73547847955461], [46.77273417084623, 24.735881800142394], [46.773333556503594, 24.73620754661305], [46.77436882468947, 24.736917658404927], [46.774879662845926, 24.737041181619507], [46.77573167773361, 24.737659370328515], [46.77638034389971, 24.73826892325821], [46.77733730480738, 24.738864479688733], [46.77805765736717, 24.739218081191797], [46.77865997258819, 24.73954604178738], [46.77921075861753, 24.739970834416777], [46.78010143702854, 24.74042119091832], [46.78064909248338, 24.74076984449183], [46.781443056009834, 24.741389410279105], [46.78223551096008, 24.741814127331335], [46.78247410400897, 24.742477505545054], [46.7816013647722, 24.74333854053946], [46.78111412536234, 24.744263515122693], [46.7803197397549, 24.74499748139922], [46.77966262318652, 24.74614450898884], [46.77899279889999, 24.747116844219036], [46.77830360069213, 24.748139526276287], [46.777425442323825, 24.74911204793157], [46.77668425542179, 24.750237227337106], [46.77595886612869, 24.751219060105324], [46.776278501315666, 24.752132286090283], [46.77734841233791, 24.752669353791116], [46.77859447384018, 24.753451187538886], [46.77971251278067, 24.754365432218812], [46.78061274891785, 24.754841466853396], [46.781938497490295, 24.7557059244826], [46.78313491383946, 24.756087086474928], [46.78414606961011, 24.756723465109015], [46.785228328740516, 24.757520654613714], [46.786073052261195, 24.758243249169816], [46.78716379949895, 24.758760057550504], [46.788028002014755, 24.75958560137], [46.78901504372262, 24.75970945828141], [46.79001144089316, 24.76065910916027], [46.791055138274174, 24.761090988298704], [46.79073384572537, 24.762047816616196], [46.79019693821079, 24.763130738411448], [46.789277566199324, 24.763838220620908], [46.78845618535939, 24.765034312593425], [46.78781220278443, 24.76603035260701], [46.787115868817864, 24.766931979199203], [46.7865102727634, 24.767950918647696], [46.78581433209627, 24.76881342873572], [46.78637123500059, 24.769056234815075], [46.78538126142007, 24.770191409619656], [46.78478496597179, 24.77132433940801], [46.78410871982626, 24.772116551333532], [46.78355318306114, 24.773040921774264], [46.78278850986978, 24.77395899075597], [46.782135395031574, 24.774882413795467], [46.78197950214012, 24.77559950852643], [46.782726987041606, 24.776191042504177], [46.783519321964185, 24.776369158804886], [46.78422460416152, 24.776886557537587], [46.784902220232105, 24.777367865191273], [46.78559111344627, 24.777803096131922], [46.786273072064255, 24.77854069200242], [46.78714082267641, 24.77885043765791], [46.787903438426646, 24.7792918232642], [46.78852905684226, 24.779693840012527], [46.789352835376235, 24.78024819458426], [46.78975962212951, 24.780293920766187], [46.79068080724976, 24.780942797669443], [46.7907960313078, 24.780969515878805]], "pickup_time": "2016-4-27T4:28:47+00:00", "num_edges": 153}, {"id": "6224292", "matched": [[46.77686676546783, 24.681573553041247], [46.77716511214107, 24.679875339483164], [46.777166259317475, 24.679872617296176], [46.7771693238981, 24.6798274376838], [46.77717652713639, 24.679809295036556], [46.77719518567948, 24.679780182305073], [46.777220193035426, 24.679752800100808], [46.77725072404558, 24.679731672526312], [46.77728570472027, 24.679717715166547], [46.77732262663457, 24.679708249134254], [46.77781574207114, 24.67985589414035], [46.77782131331672, 24.679858536723167], [46.77785802682585, 24.67987615900945], [46.77789048283507, 24.679900151798876], [46.77791691575837, 24.679931438882196], [46.777936471124455, 24.67996551605811], [46.77794933371556, 24.680001478273805], [46.777953626322095, 24.68003934777662], [46.77795268697546, 24.680061930557564], [46.77794136264179, 24.680087345000825], [46.77858719804465, 24.68307720415322]], "gps": [[46.75159018247987, 24.740527347524154], [46.752043373855216, 24.73965580083052], [46.75265614752695, 24.738604994134228], [46.75333936530534, 24.7375908553126], [46.75404008886001, 24.7357026536409], [46.75513151683612, 24.733915000450743], [46.75594498311502, 24.732438891963923], [46.75693394865058, 24.730529255741114], [46.7575674354943, 24.72854551903084], [46.75882253191495, 24.72676070700745], [46.75953735643414, 24.725197626668976], [46.760444761538885, 24.723390701864457], [46.76126833537101, 24.72184783272416], [46.7619810171047, 24.720375623214746], [46.76296639651287, 24.718815565961574], [46.76388322988058, 24.717488636703063], [46.765098565445406, 24.715652794050726], [46.76631486413556, 24.71421856011333], [46.76721693280857, 24.712314895051527], [46.76855670334818, 24.71085840527524], [46.76959066332904, 24.709211166194837], [46.770494971850844, 24.707692704843605], [46.771718636097056, 24.706026370966335], [46.77250747576392, 24.70404185832496], [46.77339516992076, 24.702289620237135], [46.77400733545285, 24.700564299168608], [46.77470429738455, 24.69844629840219], [46.7753089106323, 24.696905650697282], [46.77606738784023, 24.695062109507713], [46.77652050305063, 24.693098666323465], [46.77728914958978, 24.69111361883933], [46.777640204415256, 24.68920189344976], [46.77784555448849, 24.6880448750642], [46.77789623475295, 24.686935711087667], [46.77790206957626, 24.68577064668948], [46.778042887303194, 24.684415167366513], [46.77682146803026, 24.68380133286337], [46.77553726057821, 24.68326285302393], [46.774148667209836, 24.682878899135684], [46.77546474598864, 24.682811231355995], [46.77657525743696, 24.683342770486334], [46.777829476005074, 24.683713078929355], [46.77869779487139, 24.68276192575579], [46.778410021526106, 24.68189731396006], [46.77751727619353, 24.68144066763935], [46.77719409426463, 24.681204111673917], [46.776048545067034, 24.68100640628567], [46.77550862580501, 24.68078776153999], [46.77526820212374, 24.680507869629704], [46.77523918168102, 24.67979096021355], [46.77491222976169, 24.679307852343598], [46.7751751646486, 24.678883545084503], [46.77533857370969, 24.678261711980028], [46.77497943447871, 24.677646553113043], [46.775227178314935, 24.677222034016182]], "pickup_time": "2016-1-19T5:1:50+00:00", "num_edges": 123}, {"id": "7027987", "matched": [[46.704335262199365, 24.753774570040115], [46.704335855373486, 24.753774563287095]], "gps": [[46.71332026995709, 24.732350786316697], [46.715432622725146, 24.732671376459397], [46.71747991682141, 24.733335167175603], [46.719675452920306, 24.73381457761924], [46.72140456827602, 24.734077237842925], [46.723394387065, 24.734382572065066], [46.72577502608065, 24.73509991512096], [46.727856737677484, 24.735464836219762], [46.73020874356067, 24.73599235694427], [46.731935651035, 24.73635854794188], [46.73421771566957, 24.736804539235074], [46.73620497605559, 24.737534722162252], [46.73793525873431, 24.738210925053654], [46.74006248446087, 24.739195916713616], [46.74224060769233, 24.740140427633573], [46.74387979471262, 24.740921342947498], [46.74591005356175, 24.74196948759736], [46.74770770901145, 24.743224960153537], [46.74904277082178, 24.74388156875662], [46.749259773320254, 24.744290826544695], [46.747461961492604, 24.74328198647857], [46.745825209465416, 24.74239966721031], [46.74442045004761, 24.741321769330014], [46.74234177857255, 24.74033149442441], [46.74055636553566, 24.739382548103404], [46.73863208853815, 24.73870130910731], [46.73677588425915, 24.738010543375925], [46.73513112429531, 24.737231411370505], [46.73309374347297, 24.73654048158494], [46.73111595985064, 24.736231413827557], [46.729214330614376, 24.735899874733438], [46.72705264542668, 24.735469130780295], [46.72544207920537, 24.73508603642604], [46.722940982545396, 24.734625771115237], [46.720881499043436, 24.734201188836106], [46.71892214965563, 24.733710805955003], [46.71668898408278, 24.733493613350763], [46.7146789927901, 24.73283316192159], [46.71296078005463, 24.73266765974641], [46.71156267939981, 24.73359300207016], [46.71030886790801, 24.73463963741952], [46.71003856839505, 24.73645895928451], [46.709610565400695, 24.738582814955134], [46.708666446147966, 24.74023750352571], [46.707752120900054, 24.741713263591432], [46.706922876991385, 24.743730559734402], [46.705960681018595, 24.745243575088775], [46.70545557361485, 24.746802406357638], [46.70419670580401, 24.748638307093145], [46.70360471943771, 24.750132339916973], [46.70265614835379, 24.75171955413474], [46.70231513534484, 24.753231063779296], [46.70304931893723, 24.75362886559588], [46.704081421931114, 24.75394383832781], [46.70460375006096, 24.754188053283084], [46.70538123646147, 24.754542315188193], [46.70641610531387, 24.75490310603679], [46.706884928513475, 24.7543988385798], [46.70717559252635, 24.753576150418542], [46.70766040417854, 24.753077836701575], [46.707899746921655, 24.75339617108327], [46.7083941382164, 24.753685552011497], [46.70884094701407, 24.754215165066526], [46.70937764165098, 24.754503501260746], [46.70982257110892, 24.75479946608741], [46.71032173905926, 24.75547952148635], [46.71081070730831, 24.755691695928252], [46.71133697718751, 24.756231654003717], [46.71142123010069, 24.756484671393224]], "pickup_time": "2016-4-12T21:45:6+00:00", "num_edges": 17}];
        var layers = { gps: [], matched: [] };
        var showGps = true, showMatched = true;

        function clearLayers() {
            layers.gps.forEach(l => map.removeLayer(l));
            layers.matched.forEach(l => map.removeLayer(l));
            layers = { gps: [], matched: [] };
        }

        function toggleLayer(type) {
            if (type === 'gps') {
                showGps = !showGps;
                document.getElementById('btn-gps').classList.toggle('active', showGps);
                layers.gps.forEach(l => showGps ? l.addTo(map) : map.removeLayer(l));
            } else {
                showMatched = !showMatched;
                document.getElementById('btn-matched').classList.toggle('active', showMatched);
                layers.matched.forEach(l => showMatched ? l.addTo(map) : map.removeLayer(l));
            }
        }

        function loadTrip(idx) {
            clearLayers();
            var trip = trips[idx];
            var bounds = [];
            
            // Draw GPS track (red)
            if (trip.gps.length > 0) {
                var gpsLatLngs = trip.gps.map(c => [c[1], c[0]]);
                var gpsLine = L.polyline(gpsLatLngs, {color: '#e74c3c', weight: 4, opacity: 0.8, dashArray: '5,5'});
                layers.gps.push(gpsLine);
                if (showGps) gpsLine.addTo(map);
                bounds = bounds.concat(gpsLatLngs);
                
                // GPS points
                trip.gps.forEach((c, i) => {
                    var m = L.circleMarker([c[1], c[0]], {radius: 3, color: '#e74c3c', fillColor: '#e74c3c', fillOpacity: 0.6});
                    layers.gps.push(m);
                    if (showGps) m.addTo(map);
                });
            }
            
            // Draw matched route (blue) - this follows actual road geometry
            if (trip.matched.length > 0) {
                var matchedLatLngs = trip.matched.map(c => [c[1], c[0]]);
                var matchedLine = L.polyline(matchedLatLngs, {color: '#3498db', weight: 5, opacity: 0.9});
                layers.matched.push(matchedLine);
                if (showMatched) matchedLine.addTo(map);
                bounds = bounds.concat(matchedLatLngs);
                
                // Start marker
                var start = L.circleMarker(matchedLatLngs[0], {radius: 12, color: '#fff', weight: 3, fillColor: '#27ae60', fillOpacity: 1});
                start.bindPopup('<b>START</b><br>' + trip.pickup_time);
                layers.matched.push(start);
                if (showMatched) start.addTo(map);
                
                // End marker
                var end = L.circleMarker(matchedLatLngs[matchedLatLngs.length-1], {radius: 12, color: '#fff', weight: 3, fillColor: '#9b59b6', fillOpacity: 1});
                end.bindPopup('<b>END</b>');
                layers.matched.push(end);
                if (showMatched) end.addTo(map);
            }
            
            if (bounds.length > 0) map.fitBounds(bounds, {padding: [50, 50]});
            
            document.getElementById('status').innerHTML = '‚úÖ Trip ' + trip.id + ' | GPS: ' + trip.gps.length + ' pts | Matched: ' + trip.matched.length + ' road pts';
            document.querySelectorAll('.trip-item').forEach((el, i) => el.classList.toggle('active', i === idx));
        }

        // Build trip list
        var list = document.getElementById('trip-list');
        trips.forEach((trip, idx) => {
            var div = document.createElement('div');
            div.className = 'trip-item';
            div.onclick = () => loadTrip(idx);
            div.innerHTML = '<h4>Trip ' + trip.id + '</h4><p>' + trip.pickup_time + '<br>GPS: ' + trip.gps.length + ' points | Matched: ' + trip.num_edges + ' road segments</p>';
            list.appendChild(div);
        });

        if (trips.length > 0) loadTrip(0);
    </script>
</body>
</html>