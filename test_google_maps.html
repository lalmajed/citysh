<!DOCTYPE html>
<html>
<head>
    <title>Test Google Maps Keyless</title>
    <style>
        #map { width: 100%; height: 500px; }
        #status { padding: 20px; font-family: Arial; }
    </style>
</head>
<body>
    <div id="status">Loading Google Maps...</div>
    <div id="map"></div>
    
    <script>
        let map;
        let mapsLoadAttempts = 0;
        const MAX_LOAD_ATTEMPTS = 100;
        
        // Wait for Google Maps API to be available
        function waitForGoogleMaps() {
            mapsLoadAttempts++;
            if (typeof google !== 'undefined' && google.maps && google.maps.Map) {
                console.log('Google Maps API loaded after', mapsLoadAttempts, 'attempts');
                initMap();
            } else if (mapsLoadAttempts < MAX_LOAD_ATTEMPTS) {
                setTimeout(waitForGoogleMaps, 100);
            } else {
                document.getElementById('status').innerHTML = '❌ Google Maps failed to load after ' + MAX_LOAD_ATTEMPTS + ' attempts. Please refresh.';
                document.getElementById('status').style.color = 'red';
            }
        }
        
        // Start checking when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', waitForGoogleMaps);
        } else {
            waitForGoogleMaps();
        }
        
        function initMap() {
            if (map) return; // Prevent double initialization
            
            try {
                document.getElementById('status').innerHTML = '✅ Google Maps loaded successfully!';
                document.getElementById('status').style.color = 'green';
                
                map = new google.maps.Map(document.getElementById('map'), {
                    center: { lat: 24.7136, lng: 46.6753 },
                    zoom: 11
                });
            } catch (err) {
                document.getElementById('status').innerHTML = '❌ Error initializing map: ' + err.message;
                document.getElementById('status').style.color = 'red';
            }
        }
        
        // Expose for callback compatibility
        window.initMap = initMap;
    </script>
    <!-- Keyless Google Maps API - no API key required -->
    <script src="https://somanchiu.github.io/Keyless-Google-Maps-API/mapsJavaScriptAPI.js" async defer></script>
</body>
</html>
