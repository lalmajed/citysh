<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Segmentation Viewer</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; padding: 20px; }
        h1 { color: #4285f4; margin-bottom: 5px; }
        .subtitle { color: #666; margin-bottom: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .stat-row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .stat { flex: 1; min-width: 100px; background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stat-value { font-size: 1.5rem; font-weight: bold; color: #4285f4; }
        .stat-value.green { color: #34a853; }
        .stat-value.yellow { color: #fbbc05; }
        .stat-value.red { color: #ea4335; }
        .stat-label { color: #666; font-size: 0.75rem; }
        .grid { display: grid; grid-template-columns: 350px 1fr; gap: 15px; }
        .panel { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .panel h2 { color: #4285f4; font-size: 0.9rem; margin-bottom: 10px; border-bottom: 2px solid #4285f4; padding-bottom: 8px; }
        select, input[type="date"], input[type="time"] { width: 100%; padding: 10px; font-size: 0.9rem; border: 2px solid #ddd; border-radius: 6px; margin-bottom: 10px; }
        .btn { width: 100%; padding: 12px; background: #4285f4; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .btn:hover { background: #3367d6; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        #map { height: 500px; border-radius: 10px; }
        .trip-list { max-height: 400px; overflow-y: auto; }
        .trip-item { padding: 10px; margin: 5px 0; border-radius: 6px; cursor: pointer; border-left: 4px solid #4285f4; background: #f8f9fa; transition: all 0.2s; }
        .trip-item:hover { background: #e3f2fd; }
        .trip-item.selected { background: #bbdefb; border-left-color: #1565c0; }
        .trip-item.green { border-left-color: #34a853; }
        .trip-item.yellow { border-left-color: #fbbc05; }
        .trip-item.red { border-left-color: #ea4335; }
        .trip-header { display: flex; justify-content: space-between; font-weight: 600; }
        .trip-route { color: #333; }
        .trip-time { color: #666; font-size: 0.85rem; }
        .trip-meta { display: flex; gap: 10px; font-size: 0.75rem; color: #666; margin-top: 5px; }
        .path-badge { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; color: white; background: #4285f4; }
        .detail-panel { background: #e8f5e9; padding: 15px; border-radius: 8px; display: none; }
        .detail-panel.visible { display: block; }
        .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #c8e6c9; }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { color: #666; }
        .detail-value { font-weight: 600; color: #333; }
        .detail-value.green { color: #34a853; }
        .detail-value.yellow { color: #fbbc05; }
        .detail-value.red { color: #ea4335; }
        .legend { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; }
        .legend-color { width: 20px; height: 4px; border-radius: 2px; }
        .legend-color.green { background: #34a853; }
        .legend-color.yellow { background: #fbbc05; }
        .legend-color.red { background: #ea4335; }
        .time-inputs { display: flex; gap: 10px; }
        .time-inputs > div { flex: 1; }
        .time-inputs label { font-size: 0.75rem; color: #666; display: block; margin-bottom: 4px; }
        .no-data { text-align: center; padding: 30px; color: #999; }
        .loading { text-align: center; padding: 20px; color: #666; }
        .break-reason { background: #ffebee; color: #c62828; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; margin-top: 5px; display: inline-block; }
        .normal-band { background: #e8f5e9; padding: 10px; border-radius: 6px; margin-bottom: 10px; font-size: 0.8rem; }
        
        /* Timeline styles */
        .timeline-container { max-height: 300px; overflow-y: auto; padding: 10px 5px; }
        .timeline { position: relative; padding-left: 20px; }
        .timeline::before { content: ''; position: absolute; left: 8px; top: 0; bottom: 0; width: 2px; background: #e0e0e0; }
        .timeline-item { position: relative; padding: 8px 0 8px 15px; font-size: 0.75rem; }
        .timeline-item::before { content: ''; position: absolute; left: -16px; top: 12px; width: 10px; height: 10px; border-radius: 50%; background: #4285f4; border: 2px solid #fff; box-shadow: 0 0 0 2px #4285f4; }
        .timeline-item.break::before { background: #ea4335; box-shadow: 0 0 0 2px #ea4335; }
        .timeline-item.slow::before { background: #fbbc05; box-shadow: 0 0 0 2px #fbbc05; }
        .timeline-item.path-start::before { background: #1565C0; box-shadow: 0 0 0 3px #1565C0; width: 12px; height: 12px; left: -17px; }
        .timeline-item.path-end::before { background: #1565C0; box-shadow: 0 0 0 2px #1565C0; border-radius: 2px; }
        .timeline-time { color: #666; font-size: 0.7rem; }
        .timeline-site { font-weight: 600; color: #333; }
        .timeline-info { color: #666; font-size: 0.7rem; margin-top: 2px; }
        .timeline-break { background: #ffebee; color: #c62828; padding: 3px 6px; border-radius: 3px; font-size: 0.65rem; margin-top: 3px; display: inline-block; }
        .timeline-path-label { background: #e3f2fd; color: #1565C0; padding: 2px 6px; border-radius: 3px; font-size: 0.65rem; font-weight: bold; margin-left: 5px; }
        .normal-band-inputs { display: flex; gap: 10px; }
        .normal-band-inputs input { width: 70px; padding: 5px; text-align: center; }
        
        /* Page Tabs */
        .page-tabs { display: flex; gap: 0; margin-bottom: 20px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .page-tab { flex: 1; padding: 15px 20px; text-align: center; cursor: pointer; font-weight: 600; color: #666; border: none; background: white; transition: all 0.2s; border-bottom: 3px solid transparent; }
        .page-tab:hover { background: #f5f5f5; }
        .page-tab.active { color: #4285f4; border-bottom-color: #4285f4; background: #e3f2fd; }
        .page-content { display: none; }
        .page-content.active { display: block; }
        
        /* Page 2 Network styles */
        .network-controls { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; margin-bottom: 15px; }
        .network-control { flex: 1; min-width: 150px; }
        .network-control label { display: block; font-size: 0.75rem; color: #666; margin-bottom: 4px; }
        .network-control select, .network-control input { width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 6px; }
        .path-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .path-table th, .path-table td { padding: 8px 10px; text-align: left; border-bottom: 1px solid #eee; }
        .path-table th { background: #f5f5f5; font-weight: 600; color: #666; position: sticky; top: 0; }
        .path-table tr:hover { background: #f8f9fa; }
        .path-table .path-cell { font-family: monospace; font-size: 0.75rem; max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .vtype-badge { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; color: white; margin-right: 5px; }
        .vtype-0 { background: #4285f4; }
        .vtype-1 { background: #34a853; }
        .vtype-2 { background: #fbbc05; }
        .vtype-3 { background: #ea4335; }
        .vtype-4 { background: #9c27b0; }
        .edge-weight { display: inline-block; min-width: 50px; text-align: right; font-weight: bold; }
        #networkMap { height: 500px; border-radius: 10px; }
        .network-legend { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px; }
        .network-legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.75rem; }
        .network-legend-color { width: 30px; height: 4px; border-radius: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Route Segmentation Viewer</h1>
        <p class="subtitle">Visualize vehicle trips with path segmentation (temporal + spatial checks)</p>
        
        <!-- Page Tabs -->
        <div class="page-tabs">
            <button class="page-tab active" onclick="showPage(1)">
                Page 1: Vehicle Trips and Routes
            </button>
            <button class="page-tab" onclick="showPage(2)">
                Page 2: Network Overview
            </button>
        </div>
        
        <!-- PAGE 1: Vehicle Trips (existing content) -->
        <div id="page1" class="page-content active">
        
        <div class="stat-row">
            <div class="stat"><div class="stat-value" id="statVehicles">50</div><div class="stat-label">Vehicles</div></div>
            <div class="stat"><div class="stat-value" id="statTrips">0</div><div class="stat-label">Trips in Route</div></div>
            <div class="stat"><div class="stat-value green" id="statPaths">0</div><div class="stat-label">Paths Detected</div></div>
            <div class="stat"><div class="stat-value yellow" id="statSlow">0</div><div class="stat-label">Slow Segments</div></div>
            <div class="stat"><div class="stat-value red" id="statBreaks">0</div><div class="stat-label">Path Breaks</div></div>
        </div>
        <div style="text-align:center;font-size:0.8rem;margin-top:5px;color:#666;">
            Break Types: <span id="statBreakdown"><span style="color:#ff9800;">[T]0</span> <span style="color:#9c27b0;">[S]0</span> <span style="color:#c62828;">[Both]0</span></span>
        </div>
        
        <!-- Active Filter Display -->
        <div id="activeFilter" class="panel" style="display:none; background: #e3f2fd; padding: 10px 15px;">
            <strong>Active Filter:</strong> <span id="filterInfo">-</span>
        </div>
        
        <div class="grid">
            <div class="sidebar">
                <div class="panel">
                    <h2>Trip Data</h2>
                    <div id="tripDataStatus" style="font-size:0.8rem;margin-bottom:8px;">
                        <span style="color:#4caf50;">Embedded: <span id="embeddedTripCount">0</span> trips, <span id="embeddedVehicleCount">0</span> vehicles</span>
                    </div>
                    <input type="file" id="tripsUpload" accept=".parquet,.json,.csv" onchange="uploadTripsData(this)" style="display:none;">
                    <button onclick="document.getElementById('tripsUpload').click()" style="font-size:0.75rem;padding:6px 10px;cursor:pointer;background:#00897b;color:#fff;border:none;border-radius:3px;width:100%;margin-bottom:5px;">
                        Upload Trips (Small Files)
                    </button>
                    
                    <div style="margin-top:8px;padding-top:8px;border-top:1px dashed #ccc;">
                        <p style="font-size:0.7rem;color:#666;margin-bottom:5px;font-weight:bold;">For Large Files (1GB+):</p>
                        <input type="file" id="manifestUpload" accept=".json" onchange="uploadManifest(this)" style="display:none;">
                        <button onclick="document.getElementById('manifestUpload').click()" style="font-size:0.75rem;padding:6px 10px;cursor:pointer;background:#1565c0;color:#fff;border:none;border-radius:3px;width:100%;margin-bottom:3px;">
                            Load from Manifest (Chunked)
                        </button>
                        <input type="file" id="chunksUpload" accept=".json,.gz" multiple onchange="uploadChunks(this)" style="display:none;">
                        <button onclick="document.getElementById('chunksUpload').click()" style="font-size:0.75rem;padding:6px 10px;cursor:pointer;background:#7b1fa2;color:#fff;border:none;border-radius:3px;width:100%;">
                            Upload Chunks (Multi-Select)
                        </button>
                        <p style="font-size:0.6rem;color:#888;margin-top:3px;">
                            Use preprocess_large_parquet.py to chunk 1GB+ files
                        </p>
                    </div>
                    
                    <div id="chunkProgress" style="display:none;margin-top:8px;">
                        <div style="background:#e0e0e0;border-radius:4px;height:8px;overflow:hidden;">
                            <div id="chunkProgressBar" style="background:#4caf50;height:100%;width:0%;transition:width 0.3s;"></div>
                        </div>
                        <div id="chunkProgressText" style="font-size:0.7rem;color:#666;margin-top:3px;">Loading...</div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Controls</h2>
                    <label style="font-size:0.8rem;color:#666;">Vehicle</label>
                    <select id="vehicleSel" onchange="showVehicleInfo()">
                        <option value="">-- Select Vehicle --</option>
                    </select>
                    <div id="vehicleInfo" style="display:none;margin-top:8px;padding:8px;background:#e3f2fd;border-radius:4px;font-size:0.75rem;"></div>
                    
                    <div class="time-inputs">
                        <div>
                            <label>Start Date</label>
                            <input type="date" id="startDate">
                        </div>
                        <div>
                            <label>End Date</label>
                            <input type="date" id="endDate">
                        </div>
                    </div>
                    
                    <div class="time-inputs">
                        <div>
                            <label>Start Time</label>
                            <input type="time" id="startTime" value="00:00">
                        </div>
                        <div>
                            <label>End Time</label>
                            <input type="time" id="endTime" value="23:59">
                        </div>
                    </div>
                    
                    <button class="btn" onclick="showRoute()">Show Route</button>
                    <button class="btn" onclick="showAllTrips()" style="background:#34a853;">Show All Trips (No Filter)</button>
                    
                    <div style="margin-top:15px;padding-top:15px;border-top:1px solid #e0e0e0;">
                        <label style="font-size:0.8rem;color:#666;">Filter by Path</label>
                        <select id="pathFilter" onchange="filterByPath()">
                            <option value="all">All Paths</option>
                        </select>
                        <p style="font-size:0.7rem;color:#666;margin-top:5px;">
                            Select a path to view it in isolation on the map
                        </p>
                    </div>
                    
                    <div style="margin-top:15px;padding-top:15px;border-top:1px solid #e0e0e0;">
                        <label style="font-size:0.8rem;color:#666;display:block;margin-bottom:8px;">Batch Processing & Export</label>
                        <button onclick="processAllVehicles()" style="font-size:0.75rem;padding:6px 10px;cursor:pointer;background:#1565c0;color:#fff;border:none;border-radius:3px;width:100%;margin-bottom:5px;">
                            Process All Vehicles
                        </button>
                        <button onclick="downloadSegmentedPaths()" style="font-size:0.75rem;padding:6px 10px;cursor:pointer;background:#2e7d32;color:#fff;border:none;border-radius:3px;width:100%;margin-bottom:5px;">
                            Download Segmented Paths (JSON)
                        </button>
                        <button onclick="showNetworkAnalysis()" style="font-size:0.75rem;padding:6px 10px;cursor:pointer;background:#ff6f00;color:#fff;border:none;border-radius:3px;width:100%;margin-bottom:5px;">
                            Network Analysis
                        </button>
                        <button onclick="uploadProcessedPaths()" style="font-size:0.75rem;padding:6px 10px;cursor:pointer;background:#673ab7;color:#fff;border:none;border-radius:3px;width:100%;">
                            Load Saved Paths (JSON)
                        </button>
                        <input type="file" id="pathsUpload" accept=".json" onchange="handlePathsUpload(this)" style="display:none;">
                        <div id="batchStatus" style="font-size:0.7rem;color:#666;margin-top:5px;"></div>
                    </div>
                    
                    <div id="loadedPathsSection" style="margin-top:15px;padding-top:15px;border-top:1px solid #e0e0e0;display:none;">
                        <label style="font-size:0.8rem;color:#666;display:block;margin-bottom:8px;">Loaded Vehicle Paths</label>
                        <select id="loadedVehicleSel" onchange="showLoadedVehiclePaths()" style="width:100%;padding:8px;margin-bottom:5px;">
                            <option value="">-- Select Vehicle --</option>
                        </select>
                        <div id="loadedPathsInfo" style="font-size:0.75rem;color:#666;"></div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Expected Times (Google Matrix)</h2>
                    <div style="background:#fff3e0;padding:10px;border-radius:6px;margin-bottom:10px;font-size:0.8rem;">
                        <div style="margin-bottom:8px;">
                            <strong>Status:</strong> <span id="expectedTimesStatus" style="color:#e65100;">Not loaded</span>
                        </div>
                        <div style="margin-bottom:8px;">
                            <strong>Source:</strong> <span id="expectedTimesSource">-</span>
                        </div>
                        <div style="margin-bottom:8px;">
                            <strong>Time Entries:</strong> <span id="expectedTimesCount">0</span>
                        </div>
                        <div>
                            <strong>Routes with Waypoints:</strong> <span id="expectedWaypointsCount">0</span>
                        </div>
                    </div>
                    <input type="file" id="matrixUpload" accept=".json" onchange="uploadGoogleMatrix(this)" style="display:none;">
                    <button class="btn" onclick="document.getElementById('matrixUpload').click()" style="background:#ff9800;">
                        Upload Google Matrix JSON
                    </button>
                    <p style="font-size:0.7rem;color:#666;margin-top:5px;">
                        JSON: { "time_min": {...}, "distance_km": {...}, "waypoints": {...}, "sites": [...] }
                    </p>
                    <div style="margin-top:10px;padding-top:10px;border-top:1px solid #ddd;">
                        <label style="font-size:0.75rem;color:#666;">Check Route in Matrix:</label>
                        <div style="display:flex;gap:5px;margin-top:5px;">
                            <input type="text" id="checkRouteFrom" placeholder="From (e.g. RUHSM001)" style="flex:1;padding:4px;font-size:0.75rem;">
                            <input type="text" id="checkRouteTo" placeholder="To (e.g. RUHSM002)" style="flex:1;padding:4px;font-size:0.75rem;">
                            <button onclick="checkRouteInMatrix()" style="padding:4px 8px;font-size:0.75rem;cursor:pointer;">Check</button>
                        </div>
                        <div id="checkRouteResult" style="margin-top:5px;font-size:0.75rem;color:#666;"></div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Segmentation Parameters</h2>
                    <div class="normal-band">
                        <p style="margin-bottom:8px;font-weight:bold;">Temporal Check</p>
                        <p style="margin-bottom:8px;font-size:0.75rem;">R = observed_time / expected_time</p>
                        <div class="normal-band-inputs">
                            <div>
                                <label style="font-size:0.75rem;">r_min</label>
                                <input type="number" id="rMin" value="0.5" step="0.1" min="0">
                            </div>
                            <div>
                                <label style="font-size:0.75rem;">r_max (default)</label>
                                <input type="number" id="rMax" value="2.0" step="0.1" min="0">
                            </div>
                        </div>
                        <p style="margin-top:5px;font-size:0.7rem;color:#666;">
                            temporal_ok = r_min &le; R &le; r_max
                        </p>
                        
                        <div style="margin-top:10px;padding-top:10px;border-top:1px dashed #ccc;">
                            <p style="margin-bottom:5px;font-weight:bold;font-size:0.8rem;">Dynamic r_max (per route/day)</p>
                            <div id="dynamicRmaxStatus" style="font-size:0.75rem;color:#666;margin-bottom:5px;">
                                Not loaded - using fixed r_max
                            </div>
                            <input type="file" id="rmaxUpload" accept=".json,.csv,.parquet" onchange="uploadDynamicRmax(this)" style="display:none;">
                            <button onclick="document.getElementById('rmaxUpload').click()" style="font-size:0.7rem;padding:4px 8px;cursor:pointer;background:#9c27b0;color:#fff;border:none;border-radius:3px;">
                                Upload r_max Table (JSON/CSV/Parquet)
                            </button>
                            <p style="font-size:0.65rem;color:#888;margin-top:3px;">
                                Columns: camera_prev, camera_next, weekday, r_max, vehicle_type (optional)
                            </p>
                        </div>
                    </div>
                    <div class="normal-band" style="margin-top:10px;">
                        <p style="margin-bottom:8px;font-weight:bold;">Spatial Check (uses Google Matrix)</p>
                        <p style="margin-bottom:8px;font-size:0.75rem;">Is current site (camera_next) reachable from path_start?</p>
                        <div class="normal-band-inputs">
                            <div style="flex:1;">
                                <label style="font-size:0.75rem;">Epsilon (meters)</label>
                                <input type="number" id="epsilonMeters" value="500" step="50" min="0" style="width:100%;">
                            </div>
                        </div>
                        <p style="margin-top:5px;font-size:0.7rem;color:#666;">
                            Checks if route exists in matrix: path_start -> current_site
                        </p>
                    </div>
                    <div style="background:#ffebee;padding:8px;border-radius:4px;margin-top:10px;font-size:0.7rem;color:#c62828;">
                        <strong>Rule:</strong> Path continues only if temporal_ok AND spatial_ok.<br>
                        Spatial failure always breaks path, even if time is normal.
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Legend</h2>
                    <div class="legend" style="flex-direction: column; gap: 8px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">Trip Lines:</div>
                        <div class="legend-item"><div class="legend-color green"></div> Normal (same path)</div>
                        <div class="legend-item"><div class="legend-color yellow"></div> Slow (temporal warning)</div>
                        <div class="legend-item"><div class="legend-color red"></div> Path Break</div>
                        <div style="font-weight: 600; margin: 10px 0 5px 0;">Sites (Markers):</div>
                        <div class="legend-item"><div style="width:12px;height:12px;border-radius:50%;background:#4285f4;border:2px solid #fff;"></div> Normal site</div>
                        <div class="legend-item"><div style="width:14px;height:14px;border-radius:50%;background:#ff9800;border:2px solid #e65100;"></div> TEMPORAL FAIL ([T])</div>
                        <div class="legend-item"><div style="width:14px;height:14px;border-radius:50%;background:#9c27b0;border:2px solid #6a1b9a;"></div> SPATIAL FAIL ([S])</div>
                        <div class="legend-item"><div style="width:16px;height:16px;border-radius:50%;background:#ea4335;border:2px solid #b71c1c;"></div> BOTH FAILED</div>
                        <div class="legend-item"><div style="width:13px;height:13px;border-radius:50%;background:#fbbc05;border:2px solid #f57f17;"></div> SLOW</div>
                        <div style="font-weight: 600; margin: 10px 0 5px 0;">Path Origin/Destination:</div>
                        <div class="legend-item"><div style="width:0;height:0;border-left:12px solid #1565C0;border-top:6px solid transparent;border-bottom:6px solid transparent;"></div> <span style="background:#1565C0;color:#fff;padding:1px 4px;border-radius:2px;font-size:0.7rem;margin-left:4px;">O#</span> Path Origin</div>
                        <div class="legend-item"><div style="width:12px;height:12px;background:#1565C0;"></div> <span style="background:#1565C0;color:#fff;padding:1px 4px;border-radius:2px;font-size:0.7rem;margin-left:4px;">D#</span> Path Destination</div>
                        <div style="font-weight: 600; margin: 10px 0 5px 0;">Corridor (click trip to see):</div>
                        <div class="legend-item"><div style="width:20px;height:4px;background:repeating-linear-gradient(90deg,#2196F3 0,#2196F3 5px,transparent 5px,transparent 10px);"></div> Expected corridor (Google Matrix)</div>
                        <div class="legend-item"><div style="width:12px;height:12px;border-radius:50%;background:#2196F3;border:2px solid #0D47A1;"></div> Corridor waypoint</div>
                        <div class="legend-item"><div style="width:20px;height:3px;background:#F44336;"></div> Distance to corridor (if failed)</div>
                    </div>
                    <div style="margin-top:10px;padding:8px;background:#e8f5e9;border-radius:4px;font-size:0.7rem;color:#2e7d32;">
                        <strong>Spatial Check:</strong> Current site must be reachable from path start via Google Matrix route.<br>
                        <strong>Note:</strong> Intermediate observed sites are NOT checked - only reachability of current site matters.
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Trip List (click for details)</h2>
                    <div class="trip-list" id="tripList">
                        <div class="no-data">Select vehicle and click "Show Route"</div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Path Timeline</h2>
                    <div id="pathTimeline" class="timeline-container">
                        <div class="no-data">Load a route to see timeline</div>
                    </div>
                </div>
            </div>
            
            <div class="main">
                <div class="panel">
                    <div id="map"></div>
                </div>
                
                <div class="panel detail-panel" id="detailPanel">
                    <h2>Trip Details</h2>
                    <div id="tripDetails"></div>
                </div>
            </div>
        </div>
        </div>
        <!-- END PAGE 1 -->
        
        <!-- PAGE 2: Network Overview -->
        <div id="page2" class="page-content">
            <div class="stat-row">
                <div class="stat"><div class="stat-value" id="statNetworkPaths">0</div><div class="stat-label">Unique Paths</div></div>
                <div class="stat"><div class="stat-value" id="statNetworkEdges">0</div><div class="stat-label">Network Edges</div></div>
                <div class="stat"><div class="stat-value green" id="statNetworkVehicles">0</div><div class="stat-label">Total Vehicles</div></div>
                <div class="stat"><div class="stat-value" id="statNetworkNodes">0</div><div class="stat-label">Camera Nodes</div></div>
            </div>
            
            <div class="grid">
                <div class="sidebar">
                    <div class="panel">
                        <h2>Network Data</h2>
                        <div id="networkDataStatus" style="font-size:0.8rem;margin-bottom:8px;">
                            <span style="color:#666;">No network data loaded</span>
                        </div>
                        <input type="file" id="networkPathsUpload" accept=".json" onchange="uploadNetworkPaths(this)" style="display:none;">
                        <button onclick="document.getElementById('networkPathsUpload').click()" style="font-size:0.75rem;padding:8px 10px;cursor:pointer;background:#00897b;color:#fff;border:none;border-radius:3px;width:100%;">
                            Upload network_visualization.json
                        </button>
                        <div style="margin-top:10px;padding:8px;background:#e3f2fd;border-radius:4px;font-size:0.65rem;">
                            <strong>For large files, run first:</strong><br>
                            <code style="background:#fff;padding:2px 4px;border-radius:2px;">python prepare_network_data.py yourfile.csv</code>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h2>Site Coordinates</h2>
                        <div id="siteCoordStatus" style="font-size:0.75rem;margin-bottom:6px;">
                            <span style="color:#666;">Using embedded sites (${Object.keys(SITES).length})</span>
                        </div>
                        <input type="file" id="siteCoordUpload" accept=".json,.csv,.parquet" onchange="uploadSiteCoordinates(this)" style="display:none;">
                        <button onclick="document.getElementById('siteCoordUpload').click()" style="font-size:0.7rem;padding:6px 8px;cursor:pointer;background:#607d8b;color:#fff;border:none;border-radius:3px;">
                            Upload Site Coords (optional)
                        </button>
                    </div>
                    
                    <div class="panel">
                        <h2>Filters</h2>
                        <label style="font-size:0.8rem;color:#666;">Vehicle Type</label>
                        <select id="networkVehicleType" onchange="filterNetworkByType()">
                            <option value="all">All Vehicle Types</option>
                            <option value="0">Type 0 - Car</option>
                            <option value="1">Type 1 - Car</option>
                            <option value="2">Type 2</option>
                            <option value="3">Type 3 - Heavy Truck</option>
                            <option value="4">Type 4</option>
                        </select>
                        
                        <label style="font-size:0.8rem;color:#666;margin-top:10px;display:block;">Min Vehicles (frequency)</label>
                        <input type="range" id="networkMinVehicles" min="1" max="500" value="1" oninput="updateNetworkMinLabel(); filterNetworkByType();" style="width:100%;">
                        <div style="display:flex;justify-content:space-between;font-size:0.7rem;color:#666;">
                            <span>1</span>
                            <span id="networkMinLabel">1</span>
                            <span>500</span>
                        </div>
                        
                        <div style="margin-top:15px;">
                            <label style="font-size:0.8rem;color:#666;">Quick Filters</label>
                            <div style="display:flex;flex-wrap:wrap;gap:5px;margin-top:5px;">
                                <button onclick="setNetworkFilter('top10')" style="font-size:0.7rem;padding:4px 8px;cursor:pointer;">Top 10%</button>
                                <button onclick="setNetworkFilter('top50')" style="font-size:0.7rem;padding:4px 8px;cursor:pointer;">Top 50</button>
                                <button onclick="setNetworkFilter('all')" style="font-size:0.7rem;padding:4px 8px;cursor:pointer;">All</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h2>Top Paths</h2>
                        <div id="topPathsList" style="max-height:300px;overflow-y:auto;">
                            <div class="no-data">Upload network data to see top paths</div>
                        </div>
                    </div>
                </div>
                
                <div class="main-content">
                    <div class="panel">
                        <h2>Network Map</h2>
                        <div class="network-legend" id="networkLegend">
                            <div class="network-legend-item"><div class="network-legend-color vtype-0"></div> Type 0 (Car)</div>
                            <div class="network-legend-item"><div class="network-legend-color vtype-1"></div> Type 1</div>
                            <div class="network-legend-item"><div class="network-legend-color vtype-3"></div> Type 3 (Truck)</div>
                            <div class="network-legend-item" style="margin-left:auto;">Line thickness = vehicle count</div>
                        </div>
                        <div id="networkMap" style="background:#f0f0f0;display:flex;align-items:center;justify-content:center;">
                            <span id="networkMapLoading" style="color:#666;">Click Page 2 tab to load map</span>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h2>Path Details</h2>
                        <div id="pathDetailsPanel" style="display:none;">
                            <div id="pathDetails"></div>
                        </div>
                        <div id="noPathSelected" class="no-data">Click a path in the list or map to see details</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PAGE 2 -->
    
    </div>

    <script>
// ============ EMBEDDED DATA ============
const TRIPS = [{"plate": "1218LSJ", "camera_prev": "RUHSM001", "camera_next": "RUHSM345", "t_prev": "2025-08-04T16:49:33.971000", "t_next": "2025-08-14T21:24:41.927000", "obs_time_seconds": 880508}, {"plate": "120RLB", "camera_prev": "RUHSM210", "camera_next": "RUHSM210", "t_prev": "2025-08-10T20:44:07.538000", "t_next": "2025-08-10T20:44:07.538000", "obs_time_seconds": 0}, {"plate": "120RLB", "camera_prev": "RUHSM210", "camera_next": "RUHSM168", "t_prev": "2025-08-10T20:44:07.538000", "t_next": "2025-08-11T22:47:05.676000", "obs_time_seconds": 93778}, {"plate": "5540BBB", "camera_prev": "RUHSM345", "camera_next": "RUHSM345", "t_prev": "2025-08-06T17:00:33.287000", "t_next": "2025-08-06T17:00:33.287000", "obs_time_seconds": 0}, {"plate": "5540BBB", "camera_prev": "RUHSM345", "camera_next": "RUHSM059", "t_prev": "2025-08-06T17:00:33.287000", "t_next": "2025-08-10T00:02:52.136000", "obs_time_seconds": 284539}, {"plate": "5540BBB", "camera_prev": "RUHSM059", "camera_next": "RUHTE337", "t_prev": "2025-08-10T00:02:52.136000", "t_next": "2025-08-15T14:46:26.656000", "obs_time_seconds": 485014}, {"plate": "910TBJ", "camera_prev": "RUHSM190", "camera_next": "RUHSM052", "t_prev": "2025-07-30T17:57:40.036000", "t_next": "2025-08-02T04:10:37.470000", "obs_time_seconds": 209577}, {"plate": "910TBJ", "camera_prev": "RUHSM052", "camera_next": "RUHSM035", "t_prev": "2025-08-02T04:10:37.470000", "t_next": "2025-08-08T14:52:23.103000", "obs_time_seconds": 556906}, {"plate": "910TBJ", "camera_prev": "RUHSM035", "camera_next": "RUHSM035", "t_prev": "2025-08-08T14:52:23.103000", "t_next": "2025-08-08T14:52:23.103000", "obs_time_seconds": 0}, {"plate": "910TBJ", "camera_prev": "RUHSM035", "camera_next": "RUHSM207", "t_prev": "2025-08-08T14:52:23.103000", "t_next": "2025-08-10T18:29:32.292000", "obs_time_seconds": 185829}, {"plate": "910TBJ", "camera_prev": "RUHSM207", "camera_next": "RUHSM207", "t_prev": "2025-08-10T18:29:32.292000", "t_next": "2025-08-10T18:29:32.292000", "obs_time_seconds": 0}, {"plate": "910TBJ", "camera_prev": "RUHSM207", "camera_next": "RUHSM280", "t_prev": "2025-08-10T18:29:32.292000", "t_next": "2025-08-15T13:45:04.531000", "obs_time_seconds": 414932}, {"plate": "9675SBA", "camera_prev": "RUHSM157", "camera_next": "RUHTE312", "t_prev": "2025-08-11T11:32:22.187000", "t_next": "2025-08-17T21:16:09.060000", "obs_time_seconds": 553427}, {"plate": "9675SBA", "camera_prev": "RUHTE312", "camera_next": "RUHTE313", "t_prev": "2025-08-17T21:16:09.060000", "t_next": "2025-08-17T21:24:53.895000", "obs_time_seconds": 524}, {"plate": "6856UGB", "camera_prev": "RUHSM116", "camera_next": "RUHSM116", "t_prev": "2025-08-07T18:38:02.406000", "t_next": "2025-08-07T18:38:02.406000", "obs_time_seconds": 0}, {"plate": "6856UGB", "camera_prev": "RUHSM116", "camera_next": "RUHSM359", "t_prev": "2025-08-07T18:38:02.406000", "t_next": "2025-08-10T02:53:23.351000", "obs_time_seconds": 202521}, {"plate": "6856UGB", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-10T02:53:23.351000", "t_next": "2025-08-10T02:53:23.351000", "obs_time_seconds": 0}, {"plate": "9571XKJ", "camera_prev": "RUHSM281", "camera_next": "RUHSM281", "t_prev": "2025-08-04T14:50:56.525000", "t_next": "2025-08-04T14:50:56.525000", "obs_time_seconds": 0}, {"plate": "4650NLD", "camera_prev": "RUHSM350", "camera_next": "RUHSM192", "t_prev": "2025-07-29T19:44:44.527000", "t_next": "2025-08-02T09:48:23.310000", "obs_time_seconds": 309819}, {"plate": "4650NLD", "camera_prev": "RUHSM192", "camera_next": "RUHSM192", "t_prev": "2025-08-02T09:48:23.310000", "t_next": "2025-08-02T09:48:23.310000", "obs_time_seconds": 0}, {"plate": "4650NLD", "camera_prev": "RUHSM192", "camera_next": "RUHSM025", "t_prev": "2025-08-02T09:48:23.310000", "t_next": "2025-08-05T19:25:38.491000", "obs_time_seconds": 293835}, {"plate": "4650NLD", "camera_prev": "RUHSM025", "camera_next": "RUHSM025", "t_prev": "2025-08-05T19:25:38.491000", "t_next": "2025-08-11T19:41:41.919000", "obs_time_seconds": 519363}, {"plate": "4650NLD", "camera_prev": "RUHSM025", "camera_next": "RUHSM003", "t_prev": "2025-08-11T19:41:41.919000", "t_next": "2025-08-11T22:16:59.592000", "obs_time_seconds": 9318}, {"plate": "4650NLD", "camera_prev": "RUHSM003", "camera_next": "RUHSM350", "t_prev": "2025-08-11T22:16:59.592000", "t_next": "2025-08-18T22:16:29.376000", "obs_time_seconds": 604770}, {"plate": "4650NLD", "camera_prev": "RUHSM350", "camera_next": "RUHSM042", "t_prev": "2025-08-18T22:16:29.376000", "t_next": "2025-08-19T19:42:48.818000", "obs_time_seconds": 77179}, {"plate": "4650NLD", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-19T19:42:48.818000", "t_next": "2025-08-19T19:43:06.893000", "obs_time_seconds": 18}, {"plate": "4425ERR", "camera_prev": "RUHSM025", "camera_next": "RUHSM102", "t_prev": "2025-07-31T18:22:19.430000", "t_next": "2025-07-31T19:17:48.549000", "obs_time_seconds": 3329}, {"plate": "4425ERR", "camera_prev": "RUHSM102", "camera_next": "RUHSM060", "t_prev": "2025-07-31T19:17:48.549000", "t_next": "2025-08-03T20:15:57.693000", "obs_time_seconds": 262689}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-03T20:15:57.693000", "t_next": "2025-08-03T20:15:57.693000", "obs_time_seconds": 0}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-03T20:15:57.693000", "t_next": "2025-08-04T16:57:14.679000", "obs_time_seconds": 74477}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-04T16:57:14.679000", "t_next": "2025-08-04T16:57:14.679000", "obs_time_seconds": 0}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-04T16:57:14.679000", "t_next": "2025-08-04T16:57:14.680000", "obs_time_seconds": 0}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-04T16:57:14.680000", "t_next": "2025-08-04T16:57:14.680000", "obs_time_seconds": 0}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-04T16:57:14.680000", "t_next": "2025-08-05T15:40:33.615000", "obs_time_seconds": 81799}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-05T15:40:33.615000", "t_next": "2025-08-05T15:40:33.615000", "obs_time_seconds": 0}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-05T15:40:33.615000", "t_next": "2025-08-05T15:40:33.947000", "obs_time_seconds": 0}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM060", "t_prev": "2025-08-05T15:40:33.947000", "t_next": "2025-08-05T15:40:33.947000", "obs_time_seconds": 0}, {"plate": "4425ERR", "camera_prev": "RUHSM060", "camera_next": "RUHSM209", "t_prev": "2025-08-05T15:40:33.947000", "t_next": "2025-08-05T15:43:52.899000", "obs_time_seconds": 199}, {"plate": "4425ERR", "camera_prev": "RUHSM209", "camera_next": "RUHSM209", "t_prev": "2025-08-05T15:43:52.899000", "t_next": "2025-08-05T15:43:52.899000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM173", "t_prev": "2025-07-31T12:57:02.166000", "t_next": "2025-08-02T00:22:49.038000", "obs_time_seconds": 127547}, {"plate": "4148ZBJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM173", "t_prev": "2025-08-02T00:22:49.038000", "t_next": "2025-08-02T00:22:49.038000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM173", "t_prev": "2025-08-02T00:22:49.038000", "t_next": "2025-08-02T00:22:49.560000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM173", "t_prev": "2025-08-02T00:22:49.560000", "t_next": "2025-08-02T00:22:49.560000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM191", "t_prev": "2025-08-02T00:22:49.560000", "t_next": "2025-08-03T00:07:49.519000", "obs_time_seconds": 85500}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-03T00:07:49.519000", "t_next": "2025-08-03T00:07:49.519000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-03T00:07:49.519000", "t_next": "2025-08-03T00:07:49.620000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-03T00:07:49.620000", "t_next": "2025-08-03T00:07:49.620000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM173", "t_prev": "2025-08-03T00:07:49.620000", "t_next": "2025-08-06T00:29:54.004000", "obs_time_seconds": 260525}, {"plate": "4148ZBJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM042", "t_prev": "2025-08-06T00:29:54.004000", "t_next": "2025-08-07T13:20:55.380000", "obs_time_seconds": 132661}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-07T13:20:55.380000", "t_next": "2025-08-07T13:21:04.722000", "obs_time_seconds": 9}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM042", "t_prev": "2025-08-07T13:21:04.722000", "t_next": "2025-08-07T22:32:11.034000", "obs_time_seconds": 33067}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-07T22:32:11.034000", "t_next": "2025-08-07T22:32:24.441000", "obs_time_seconds": 13}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM228", "t_prev": "2025-08-07T22:32:24.441000", "t_next": "2025-08-07T22:32:24.807000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM196", "t_prev": "2025-08-07T22:32:24.807000", "t_next": "2025-08-08T17:56:11.577000", "obs_time_seconds": 69827}, {"plate": "4148ZBJ", "camera_prev": "RUHSM196", "camera_next": "RUHSM196", "t_prev": "2025-08-08T17:56:11.577000", "t_next": "2025-08-09T18:52:17.703000", "obs_time_seconds": 89766}, {"plate": "4148ZBJ", "camera_prev": "RUHSM196", "camera_next": "RUHSM191", "t_prev": "2025-08-09T18:52:17.703000", "t_next": "2025-08-10T01:33:41.621000", "obs_time_seconds": 24084}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T01:33:41.621000", "t_next": "2025-08-10T01:33:41.621000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T01:33:41.621000", "t_next": "2025-08-10T01:33:41.721000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T01:33:41.721000", "t_next": "2025-08-10T01:33:41.721000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM042", "t_prev": "2025-08-10T01:33:41.721000", "t_next": "2025-08-10T12:14:54.690000", "obs_time_seconds": 38473}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM042", "t_prev": "2025-08-10T12:14:54.690000", "t_next": "2025-08-10T12:14:54.690000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-10T12:14:54.690000", "t_next": "2025-08-10T12:15:05.708000", "obs_time_seconds": 11}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM228", "t_prev": "2025-08-10T12:15:05.708000", "t_next": "2025-08-10T12:15:05.708000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM191", "t_prev": "2025-08-10T12:15:05.708000", "t_next": "2025-08-10T23:53:25.794000", "obs_time_seconds": 41900}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T23:53:25.794000", "t_next": "2025-08-10T23:53:25.794000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T23:53:25.794000", "t_next": "2025-08-10T23:53:25.899000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T23:53:25.899000", "t_next": "2025-08-10T23:53:25.899000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM042", "t_prev": "2025-08-10T23:53:25.899000", "t_next": "2025-08-11T12:23:37.512000", "obs_time_seconds": 45012}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-11T12:23:37.512000", "t_next": "2025-08-11T12:23:50.077000", "obs_time_seconds": 13}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM191", "t_prev": "2025-08-11T12:23:50.077000", "t_next": "2025-08-11T23:50:54.665000", "obs_time_seconds": 41224}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-11T23:50:54.665000", "t_next": "2025-08-11T23:50:54.763000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM042", "t_prev": "2025-08-11T23:50:54.763000", "t_next": "2025-08-12T12:18:19.144000", "obs_time_seconds": 44845}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM042", "t_prev": "2025-08-12T12:18:19.144000", "t_next": "2025-08-12T12:18:19.245000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-12T12:18:19.245000", "t_next": "2025-08-12T12:18:32.703000", "obs_time_seconds": 13}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM191", "t_prev": "2025-08-12T12:18:32.703000", "t_next": "2025-08-13T01:40:38.971000", "obs_time_seconds": 48126}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-13T01:40:38.971000", "t_next": "2025-08-13T01:40:39.072000", "obs_time_seconds": 1}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM042", "t_prev": "2025-08-13T01:40:39.072000", "t_next": "2025-08-13T12:34:21.948000", "obs_time_seconds": 39222}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-13T12:34:21.948000", "t_next": "2025-08-13T12:34:32.846000", "obs_time_seconds": 11}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM228", "t_prev": "2025-08-13T12:34:32.846000", "t_next": "2025-08-13T12:34:34.624000", "obs_time_seconds": 2}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM191", "t_prev": "2025-08-13T12:34:34.624000", "t_next": "2025-08-13T23:53:22.603000", "obs_time_seconds": 40728}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-13T23:53:22.603000", "t_next": "2025-08-13T23:53:22.971000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-13T23:53:22.971000", "t_next": "2025-08-13T23:53:23.079000", "obs_time_seconds": 1}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-13T23:53:23.079000", "t_next": "2025-08-15T03:31:58.886000", "obs_time_seconds": 99515}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-15T03:31:58.886000", "t_next": "2025-08-15T03:31:58.989000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-15T03:31:58.989000", "t_next": "2025-08-16T04:10:14.972000", "obs_time_seconds": 88696}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-16T04:10:14.972000", "t_next": "2025-08-16T04:10:15.072000", "obs_time_seconds": 1}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-16T04:10:15.072000", "t_next": "2025-08-17T00:18:32.528000", "obs_time_seconds": 72497}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-17T00:18:32.528000", "t_next": "2025-08-17T00:18:32.626000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM042", "t_prev": "2025-08-17T00:18:32.626000", "t_next": "2025-08-17T12:12:36.542000", "obs_time_seconds": 42844}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-17T12:12:36.542000", "t_next": "2025-08-17T12:12:49.185000", "obs_time_seconds": 13}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM173", "t_prev": "2025-08-17T12:12:49.185000", "t_next": "2025-08-17T22:22:41.023000", "obs_time_seconds": 36592}, {"plate": "4148ZBJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM191", "t_prev": "2025-08-17T22:22:41.023000", "t_next": "2025-08-18T00:03:43.878000", "obs_time_seconds": 6062}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-18T00:03:43.878000", "t_next": "2025-08-18T00:03:43.975000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM042", "t_prev": "2025-08-18T00:03:43.975000", "t_next": "2025-08-18T11:58:07.803000", "obs_time_seconds": 42864}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-18T11:58:07.803000", "t_next": "2025-08-18T11:58:19.373000", "obs_time_seconds": 12}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM228", "t_prev": "2025-08-18T11:58:19.373000", "t_next": "2025-08-18T11:58:19.437000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM042", "t_prev": "2025-08-18T11:58:19.437000", "t_next": "2025-08-19T12:07:37.231000", "obs_time_seconds": 86958}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-19T12:07:37.231000", "t_next": "2025-08-19T12:07:50.248000", "obs_time_seconds": 13}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM106", "t_prev": "2025-08-19T12:07:50.248000", "t_next": "2025-08-19T14:06:29.666000", "obs_time_seconds": 7119}, {"plate": "4148ZBJ", "camera_prev": "RUHSM106", "camera_next": "RUHSM191", "t_prev": "2025-08-19T14:06:29.666000", "t_next": "2025-08-20T01:58:08.793000", "obs_time_seconds": 42699}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-20T01:58:08.793000", "t_next": "2025-08-20T01:58:08.892000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM042", "t_prev": "2025-08-20T01:58:08.892000", "t_next": "2025-08-20T12:30:13.873000", "obs_time_seconds": 37925}, {"plate": "4148ZBJ", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-20T12:30:13.873000", "t_next": "2025-08-20T12:30:22.921000", "obs_time_seconds": 9}, {"plate": "4148ZBJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM191", "t_prev": "2025-08-20T12:30:22.921000", "t_next": "2025-08-20T21:27:48.132000", "obs_time_seconds": 32246}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-20T21:27:48.132000", "t_next": "2025-08-20T21:27:50.133000", "obs_time_seconds": 2}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM192", "t_prev": "2025-08-20T21:27:50.133000", "t_next": "2025-08-20T21:30:08.332000", "obs_time_seconds": 138}, {"plate": "4148ZBJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM192", "t_prev": "2025-08-20T21:30:08.332000", "t_next": "2025-08-20T21:30:08.565000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM192", "t_prev": "2025-08-20T21:30:08.565000", "t_next": "2025-08-20T21:30:09.065000", "obs_time_seconds": 1}, {"plate": "4148ZBJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM173", "t_prev": "2025-08-20T21:30:09.065000", "t_next": "2025-08-20T22:30:36.244000", "obs_time_seconds": 3627}, {"plate": "4148ZBJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM191", "t_prev": "2025-08-20T22:30:36.244000", "t_next": "2025-08-20T23:28:56.652000", "obs_time_seconds": 3500}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-20T23:28:56.652000", "t_next": "2025-08-20T23:28:56.751000", "obs_time_seconds": 0}, {"plate": "4148ZBJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-20T23:28:56.751000", "t_next": "2025-08-20T23:28:56.888000", "obs_time_seconds": 0}, {"plate": "1620GAD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-11T12:03:07.378000", "t_next": "2025-08-18T08:47:10.908000", "obs_time_seconds": 593043}, {"plate": "1620GAD", "camera_prev": "RUHSM095", "camera_next": "RUHSM337", "t_prev": "2025-08-18T08:47:10.908000", "t_next": "2025-08-18T16:24:35.901000", "obs_time_seconds": 27445}, {"plate": "1855TZB", "camera_prev": "RUHSM210", "camera_next": "RUHSM210", "t_prev": "2025-08-04T18:39:09.629000", "t_next": "2025-08-04T18:39:09.629000", "obs_time_seconds": 0}, {"plate": "1855TZB", "camera_prev": "RUHSM210", "camera_next": "RUHSM191", "t_prev": "2025-08-04T18:39:09.629000", "t_next": "2025-08-05T23:59:50.797000", "obs_time_seconds": 105641}, {"plate": "1855TZB", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-05T23:59:50.797000", "t_next": "2025-08-05T23:59:50.797000", "obs_time_seconds": 0}, {"plate": "1855TZB", "camera_prev": "RUHSM191", "camera_next": "RUHSM030", "t_prev": "2025-08-05T23:59:50.797000", "t_next": "2025-08-09T00:32:48.397000", "obs_time_seconds": 261178}, {"plate": "4583ZDD", "camera_prev": "RUHSM054", "camera_next": "RUHTE332", "t_prev": "2025-07-31T09:36:05.515000", "t_next": "2025-08-07T15:54:00.618000", "obs_time_seconds": 627475}, {"plate": "4583ZDD", "camera_prev": "RUHTE332", "camera_next": "RUHTE332", "t_prev": "2025-08-07T15:54:00.618000", "t_next": "2025-08-07T15:54:00.618000", "obs_time_seconds": 0}, {"plate": "4583ZDD", "camera_prev": "RUHTE332", "camera_next": "RUHTE333", "t_prev": "2025-08-07T15:54:00.618000", "t_next": "2025-08-07T22:25:34.557000", "obs_time_seconds": 23494}, {"plate": "4583ZDD", "camera_prev": "RUHTE333", "camera_next": "RUHTE333", "t_prev": "2025-08-07T22:25:34.557000", "t_next": "2025-08-07T22:25:34.557000", "obs_time_seconds": 0}, {"plate": "4583ZDD", "camera_prev": "RUHTE333", "camera_next": "RUHSM057", "t_prev": "2025-08-07T22:25:34.557000", "t_next": "2025-08-08T15:55:11.477000", "obs_time_seconds": 62977}, {"plate": "4583ZDD", "camera_prev": "RUHSM057", "camera_next": "RUHTE332", "t_prev": "2025-08-08T15:55:11.477000", "t_next": "2025-08-09T16:00:47.906000", "obs_time_seconds": 86736}, {"plate": "4583ZDD", "camera_prev": "RUHTE332", "camera_next": "RUHSM057", "t_prev": "2025-08-09T16:00:47.906000", "t_next": "2025-08-09T16:03:01.468000", "obs_time_seconds": 134}, {"plate": "4583ZDD", "camera_prev": "RUHSM057", "camera_next": "RUHSM271", "t_prev": "2025-08-09T16:03:01.468000", "t_next": "2025-08-10T15:25:58.520000", "obs_time_seconds": 84177}, {"plate": "4583ZDD", "camera_prev": "RUHSM271", "camera_next": "RUHSM271", "t_prev": "2025-08-10T15:25:58.520000", "t_next": "2025-08-10T15:25:58.520000", "obs_time_seconds": 0}, {"plate": "4583ZDD", "camera_prev": "RUHSM271", "camera_next": "RUHTE332", "t_prev": "2025-08-10T15:25:58.520000", "t_next": "2025-08-15T15:58:09.048000", "obs_time_seconds": 433931}, {"plate": "4583ZDD", "camera_prev": "RUHTE332", "camera_next": "RUHTE332", "t_prev": "2025-08-15T15:58:09.048000", "t_next": "2025-08-15T15:58:09.048000", "obs_time_seconds": 0}, {"plate": "4583ZDD", "camera_prev": "RUHTE332", "camera_next": "RUHTE333", "t_prev": "2025-08-15T15:58:09.048000", "t_next": "2025-08-15T22:20:32.763000", "obs_time_seconds": 22943}, {"plate": "1511DAJ", "camera_prev": "RUHSM380", "camera_next": "RUHSM198", "t_prev": "2025-07-30T20:33:07.614000", "t_next": "2025-08-10T18:07:19.005000", "obs_time_seconds": 941652}, {"plate": "1511DAJ", "camera_prev": "RUHSM198", "camera_next": "RUHSM198", "t_prev": "2025-08-10T18:07:19.005000", "t_next": "2025-08-10T18:07:19.005000", "obs_time_seconds": 0}, {"plate": "914HDA", "camera_prev": "RUHSM023", "camera_next": "RUHTE325", "t_prev": "2025-08-03T08:50:37.012000", "t_next": "2025-08-15T16:45:17.370000", "obs_time_seconds": 1065280}, {"plate": "6250UJJ", "camera_prev": "RUHSM458", "camera_next": "RUHSM012", "t_prev": "2025-08-04T00:26:13.368000", "t_next": "2025-08-18T20:47:55.582000", "obs_time_seconds": 1282902}, {"plate": "2238NLA", "camera_prev": "RUHSM049", "camera_next": "RUHSM292", "t_prev": "2025-08-18T14:42:01.640000", "t_next": "2025-08-20T18:30:55.171000", "obs_time_seconds": 186534}, {"plate": "2734KRD", "camera_prev": "RUHSM201", "camera_next": "RUHSM201", "t_prev": "2025-07-30T17:25:51.741000", "t_next": "2025-08-07T18:12:35.420000", "obs_time_seconds": 694004}, {"plate": "2734KRD", "camera_prev": "RUHSM201", "camera_next": "RUHSM201", "t_prev": "2025-08-07T18:12:35.420000", "t_next": "2025-08-07T18:12:35.420000", "obs_time_seconds": 0}, {"plate": "2734KRD", "camera_prev": "RUHSM201", "camera_next": "RUHSM201", "t_prev": "2025-08-07T18:12:35.420000", "t_next": "2025-08-07T18:12:35.518000", "obs_time_seconds": 0}, {"plate": "2734KRD", "camera_prev": "RUHSM201", "camera_next": "RUHSM201", "t_prev": "2025-08-07T18:12:35.518000", "t_next": "2025-08-07T18:12:35.518000", "obs_time_seconds": 0}, {"plate": "2734KRD", "camera_prev": "RUHSM201", "camera_next": "RUHSM049", "t_prev": "2025-08-07T18:12:35.518000", "t_next": "2025-08-09T18:41:43.276000", "obs_time_seconds": 174548}, {"plate": "2734KRD", "camera_prev": "RUHSM049", "camera_next": "RUHSM049", "t_prev": "2025-08-09T18:41:43.276000", "t_next": "2025-08-09T18:41:43.276000", "obs_time_seconds": 0}, {"plate": "2734KRD", "camera_prev": "RUHSM049", "camera_next": "RUHSM187", "t_prev": "2025-08-09T18:41:43.276000", "t_next": "2025-08-12T16:03:20.741000", "obs_time_seconds": 249697}, {"plate": "2734KRD", "camera_prev": "RUHSM187", "camera_next": "RUHTE311", "t_prev": "2025-08-12T16:03:20.741000", "t_next": "2025-08-15T21:12:35.838000", "obs_time_seconds": 277755}, {"plate": "2734KRD", "camera_prev": "RUHTE311", "camera_next": "RUHSM051", "t_prev": "2025-08-15T21:12:35.838000", "t_next": "2025-08-17T18:06:05.628000", "obs_time_seconds": 161610}, {"plate": "2734KRD", "camera_prev": "RUHSM051", "camera_next": "RUHSM254", "t_prev": "2025-08-17T18:06:05.628000", "t_next": "2025-08-18T08:47:18.810000", "obs_time_seconds": 52873}, {"plate": "2734KRD", "camera_prev": "RUHSM254", "camera_next": "RUHSM054", "t_prev": "2025-08-18T08:47:18.810000", "t_next": "2025-08-19T12:27:34.664000", "obs_time_seconds": 99616}, {"plate": "2734KRD", "camera_prev": "RUHSM054", "camera_next": "RUHSM054", "t_prev": "2025-08-19T12:27:34.664000", "t_next": "2025-08-19T12:27:34.932000", "obs_time_seconds": 0}, {"plate": "2734KRD", "camera_prev": "RUHSM054", "camera_next": "RUHSM054", "t_prev": "2025-08-19T12:27:34.932000", "t_next": "2025-08-19T13:10:37.520000", "obs_time_seconds": 2583}, {"plate": "2734KRD", "camera_prev": "RUHSM054", "camera_next": "RUHSM054", "t_prev": "2025-08-19T13:10:37.520000", "t_next": "2025-08-19T13:10:37.622000", "obs_time_seconds": 0}, {"plate": "464SAL", "camera_prev": "RUHSM130", "camera_next": "RUHSM130", "t_prev": "2025-08-18T18:35:56.817000", "t_next": "2025-08-18T18:35:56.985000", "obs_time_seconds": 0}, {"plate": "8889BDR", "camera_prev": "RUHSM073", "camera_next": "RUHSM073", "t_prev": "2025-07-29T12:02:11.015000", "t_next": "2025-07-29T12:02:11.381000", "obs_time_seconds": 0}, {"plate": "8889BDR", "camera_prev": "RUHSM073", "camera_next": "RUHSM074", "t_prev": "2025-07-29T12:02:11.381000", "t_next": "2025-07-29T13:17:08.348000", "obs_time_seconds": 4497}, {"plate": "8889BDR", "camera_prev": "RUHSM074", "camera_next": "RUHSM074", "t_prev": "2025-07-29T13:17:08.348000", "t_next": "2025-07-29T13:17:10.515000", "obs_time_seconds": 2}, {"plate": "8889BDR", "camera_prev": "RUHSM074", "camera_next": "RUHSM074", "t_prev": "2025-07-29T13:17:10.515000", "t_next": "2025-07-29T13:17:11.150000", "obs_time_seconds": 1}, {"plate": "8889BDR", "camera_prev": "RUHSM074", "camera_next": "RUHSM027", "t_prev": "2025-07-29T13:17:11.150000", "t_next": "2025-07-29T13:20:39.669000", "obs_time_seconds": 208}, {"plate": "8889BDR", "camera_prev": "RUHSM027", "camera_next": "RUHSM279", "t_prev": "2025-07-29T13:20:39.669000", "t_next": "2025-07-29T22:21:57.866000", "obs_time_seconds": 32478}, {"plate": "8889BDR", "camera_prev": "RUHSM279", "camera_next": "RUHSM278", "t_prev": "2025-07-29T22:21:57.866000", "t_next": "2025-07-29T22:25:33.017000", "obs_time_seconds": 216}, {"plate": "8889BDR", "camera_prev": "RUHSM278", "camera_next": "RUHSM451", "t_prev": "2025-07-29T22:25:33.017000", "t_next": "2025-07-30T11:23:20.588000", "obs_time_seconds": 46667}, {"plate": "8889BDR", "camera_prev": "RUHSM451", "camera_next": "RUHSM451", "t_prev": "2025-07-30T11:23:20.588000", "t_next": "2025-07-30T11:23:20.922000", "obs_time_seconds": 0}, {"plate": "8889BDR", "camera_prev": "RUHSM451", "camera_next": "RUHSM452", "t_prev": "2025-07-30T11:23:20.922000", "t_next": "2025-07-30T12:05:26.640000", "obs_time_seconds": 2526}, {"plate": "8889BDR", "camera_prev": "RUHSM452", "camera_next": "RUHSM156", "t_prev": "2025-07-30T12:05:26.640000", "t_next": "2025-07-30T12:29:32.154000", "obs_time_seconds": 1446}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-07-30T12:29:32.154000", "t_next": "2025-07-30T12:29:32.155000", "obs_time_seconds": 0}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM451", "t_prev": "2025-07-30T12:29:32.155000", "t_next": "2025-07-31T09:48:27.303000", "obs_time_seconds": 76735}, {"plate": "8889BDR", "camera_prev": "RUHSM451", "camera_next": "RUHSM452", "t_prev": "2025-07-31T09:48:27.303000", "t_next": "2025-07-31T10:02:22.386000", "obs_time_seconds": 835}, {"plate": "8889BDR", "camera_prev": "RUHSM452", "camera_next": "RUHSM095", "t_prev": "2025-07-31T10:02:22.386000", "t_next": "2025-08-03T08:55:06.721000", "obs_time_seconds": 255164}, {"plate": "8889BDR", "camera_prev": "RUHSM095", "camera_next": "RUHSM451", "t_prev": "2025-08-03T08:55:06.721000", "t_next": "2025-08-03T11:42:17.668000", "obs_time_seconds": 10031}, {"plate": "8889BDR", "camera_prev": "RUHSM451", "camera_next": "RUHSM452", "t_prev": "2025-08-03T11:42:17.668000", "t_next": "2025-08-03T12:11:11.558000", "obs_time_seconds": 1734}, {"plate": "8889BDR", "camera_prev": "RUHSM452", "camera_next": "RUHSM156", "t_prev": "2025-08-03T12:11:11.558000", "t_next": "2025-08-03T12:40:12.277000", "obs_time_seconds": 1741}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM451", "t_prev": "2025-08-03T12:40:12.277000", "t_next": "2025-08-05T13:38:33.047000", "obs_time_seconds": 176301}, {"plate": "8889BDR", "camera_prev": "RUHSM451", "camera_next": "RUHSM451", "t_prev": "2025-08-05T13:38:33.047000", "t_next": "2025-08-05T13:38:33.048000", "obs_time_seconds": 0}, {"plate": "8889BDR", "camera_prev": "RUHSM451", "camera_next": "RUHSM452", "t_prev": "2025-08-05T13:38:33.048000", "t_next": "2025-08-05T13:53:38.581000", "obs_time_seconds": 905}, {"plate": "8889BDR", "camera_prev": "RUHSM452", "camera_next": "RUHSM452", "t_prev": "2025-08-05T13:53:38.581000", "t_next": "2025-08-05T13:53:38.984000", "obs_time_seconds": 0}, {"plate": "8889BDR", "camera_prev": "RUHSM452", "camera_next": "RUHSM156", "t_prev": "2025-08-05T13:53:38.984000", "t_next": "2025-08-05T14:17:05.657000", "obs_time_seconds": 1407}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM129", "t_prev": "2025-08-05T14:17:05.657000", "t_next": "2025-08-06T15:08:41.150000", "obs_time_seconds": 89496}, {"plate": "8889BDR", "camera_prev": "RUHSM129", "camera_next": "RUHSM156", "t_prev": "2025-08-06T15:08:41.150000", "t_next": "2025-08-06T15:23:33.803000", "obs_time_seconds": 892}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM129", "t_prev": "2025-08-06T15:23:33.803000", "t_next": "2025-08-07T15:13:31.519000", "obs_time_seconds": 85798}, {"plate": "8889BDR", "camera_prev": "RUHSM129", "camera_next": "RUHSM156", "t_prev": "2025-08-07T15:13:31.519000", "t_next": "2025-08-07T15:28:25.439000", "obs_time_seconds": 894}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM129", "t_prev": "2025-08-07T15:28:25.439000", "t_next": "2025-08-10T10:22:00.975000", "obs_time_seconds": 240815}, {"plate": "8889BDR", "camera_prev": "RUHSM129", "camera_next": "RUHSM023", "t_prev": "2025-08-10T10:22:00.975000", "t_next": "2025-08-10T10:37:40.203000", "obs_time_seconds": 940}, {"plate": "8889BDR", "camera_prev": "RUHSM023", "camera_next": "RUHSM181", "t_prev": "2025-08-10T10:37:40.203000", "t_next": "2025-08-11T12:50:16.661000", "obs_time_seconds": 94356}, {"plate": "8889BDR", "camera_prev": "RUHSM181", "camera_next": "RUHSM129", "t_prev": "2025-08-11T12:50:16.661000", "t_next": "2025-08-12T15:08:46.805000", "obs_time_seconds": 94710}, {"plate": "8889BDR", "camera_prev": "RUHSM129", "camera_next": "RUHSM129", "t_prev": "2025-08-12T15:08:46.805000", "t_next": "2025-08-12T15:08:46.906000", "obs_time_seconds": 0}, {"plate": "8889BDR", "camera_prev": "RUHSM129", "camera_next": "RUHSM129", "t_prev": "2025-08-12T15:08:46.906000", "t_next": "2025-08-14T15:04:39.808000", "obs_time_seconds": 172553}, {"plate": "8889BDR", "camera_prev": "RUHSM129", "camera_next": "RUHSM156", "t_prev": "2025-08-14T15:04:39.808000", "t_next": "2025-08-14T15:12:39.551000", "obs_time_seconds": 480}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-08-14T15:12:39.551000", "t_next": "2025-08-14T15:12:39.785000", "obs_time_seconds": 0}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM129", "t_prev": "2025-08-14T15:12:39.785000", "t_next": "2025-08-17T11:06:41.173000", "obs_time_seconds": 244442}, {"plate": "8889BDR", "camera_prev": "RUHSM129", "camera_next": "RUHSM156", "t_prev": "2025-08-17T11:06:41.173000", "t_next": "2025-08-17T13:48:12.260000", "obs_time_seconds": 9691}, {"plate": "8889BDR", "camera_prev": "RUHSM156", "camera_next": "RUHSM129", "t_prev": "2025-08-17T13:48:12.260000", "t_next": "2025-08-18T15:08:48.477000", "obs_time_seconds": 91236}, {"plate": "8889BDR", "camera_prev": "RUHSM129", "camera_next": "RUHSM052", "t_prev": "2025-08-18T15:08:48.477000", "t_next": "2025-08-19T10:30:56.614000", "obs_time_seconds": 69728}, {"plate": "8889BDR", "camera_prev": "RUHSM052", "camera_next": "RUHSM198", "t_prev": "2025-08-19T10:30:56.614000", "t_next": "2025-08-19T11:16:37.612000", "obs_time_seconds": 2741}, {"plate": "8889BDR", "camera_prev": "RUHSM198", "camera_next": "RUHSM156", "t_prev": "2025-08-19T11:16:37.612000", "t_next": "2025-08-20T15:27:11.612000", "obs_time_seconds": 101434}, {"plate": "9250TZD", "camera_prev": "RUHSM038", "camera_next": "RUHSM129", "t_prev": "2025-08-03T19:43:40.335000", "t_next": "2025-08-03T20:59:18.800000", "obs_time_seconds": 4538}, {"plate": "9250TZD", "camera_prev": "RUHSM129", "camera_next": "RUHSM359", "t_prev": "2025-08-03T20:59:18.800000", "t_next": "2025-08-09T16:53:25.345000", "obs_time_seconds": 503647}, {"plate": "9250TZD", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-09T16:53:25.345000", "t_next": "2025-08-09T16:53:25.345000", "obs_time_seconds": 0}, {"plate": "9250TZD", "camera_prev": "RUHSM359", "camera_next": "RUHSM033", "t_prev": "2025-08-09T16:53:25.345000", "t_next": "2025-08-09T17:00:07.586000", "obs_time_seconds": 402}, {"plate": "9250TZD", "camera_prev": "RUHSM033", "camera_next": "RUHSM033", "t_prev": "2025-08-09T17:00:07.586000", "t_next": "2025-08-09T17:00:07.586000", "obs_time_seconds": 0}, {"plate": "9250TZD", "camera_prev": "RUHSM033", "camera_next": "RUHSM033", "t_prev": "2025-08-09T17:00:07.586000", "t_next": "2025-08-09T17:00:08.021000", "obs_time_seconds": 1}, {"plate": "9250TZD", "camera_prev": "RUHSM033", "camera_next": "RUHSM033", "t_prev": "2025-08-09T17:00:08.021000", "t_next": "2025-08-09T17:00:08.021000", "obs_time_seconds": 0}, {"plate": "9250TZD", "camera_prev": "RUHSM033", "camera_next": "RUHSM025", "t_prev": "2025-08-09T17:00:08.021000", "t_next": "2025-08-09T21:05:15.472000", "obs_time_seconds": 14707}, {"plate": "9250TZD", "camera_prev": "RUHSM025", "camera_next": "RUHSM271", "t_prev": "2025-08-09T21:05:15.472000", "t_next": "2025-08-10T18:53:55.442000", "obs_time_seconds": 78520}, {"plate": "9250TZD", "camera_prev": "RUHSM271", "camera_next": "RUHSM271", "t_prev": "2025-08-10T18:53:55.442000", "t_next": "2025-08-10T18:53:56.109000", "obs_time_seconds": 1}, {"plate": "9250TZD", "camera_prev": "RUHSM271", "camera_next": "RUHSM304", "t_prev": "2025-08-10T18:53:56.109000", "t_next": "2025-08-15T20:59:43.760000", "obs_time_seconds": 439547}, {"plate": "9250TZD", "camera_prev": "RUHSM304", "camera_next": "RUHSM027", "t_prev": "2025-08-15T20:59:43.760000", "t_next": "2025-08-16T01:37:14.944000", "obs_time_seconds": 16651}, {"plate": "9250TZD", "camera_prev": "RUHSM027", "camera_next": "RUHSM027", "t_prev": "2025-08-16T01:37:14.944000", "t_next": "2025-08-16T01:37:15.211000", "obs_time_seconds": 1}, {"plate": "9250TZD", "camera_prev": "RUHSM027", "camera_next": "RUHSM129", "t_prev": "2025-08-16T01:37:15.211000", "t_next": "2025-08-16T01:42:17.228000", "obs_time_seconds": 302}, {"plate": "9250TZD", "camera_prev": "RUHSM129", "camera_next": "RUHSM187", "t_prev": "2025-08-16T01:42:17.228000", "t_next": "2025-08-17T23:39:16.396000", "obs_time_seconds": 165419}, {"plate": "9250TZD", "camera_prev": "RUHSM187", "camera_next": "RUHSM045", "t_prev": "2025-08-17T23:39:16.396000", "t_next": "2025-08-19T10:08:16.812000", "obs_time_seconds": 124140}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM208", "t_prev": "2025-08-09T20:22:11.786000", "t_next": "2025-08-09T20:22:11.786000", "obs_time_seconds": 0}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM208", "t_prev": "2025-08-09T20:22:11.786000", "t_next": "2025-08-09T20:22:12.027000", "obs_time_seconds": 1}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM208", "t_prev": "2025-08-09T20:22:12.027000", "t_next": "2025-08-09T20:22:12.027000", "obs_time_seconds": 0}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM003", "t_prev": "2025-08-09T20:22:12.027000", "t_next": "2025-08-10T00:28:57.481000", "obs_time_seconds": 14805}, {"plate": "6197GDD", "camera_prev": "RUHSM003", "camera_next": "RUHSM208", "t_prev": "2025-08-10T00:28:57.481000", "t_next": "2025-08-10T00:53:25.206000", "obs_time_seconds": 1468}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM209", "t_prev": "2025-08-10T00:53:25.206000", "t_next": "2025-08-10T00:54:13.839000", "obs_time_seconds": 48}, {"plate": "6197GDD", "camera_prev": "RUHSM209", "camera_next": "RUHSM209", "t_prev": "2025-08-10T00:54:13.839000", "t_next": "2025-08-10T00:54:14.139000", "obs_time_seconds": 1}, {"plate": "6197GDD", "camera_prev": "RUHSM209", "camera_next": "RUHSM025", "t_prev": "2025-08-10T00:54:14.139000", "t_next": "2025-08-14T18:21:50.019000", "obs_time_seconds": 408456}, {"plate": "6197GDD", "camera_prev": "RUHSM025", "camera_next": "RUHSM033", "t_prev": "2025-08-14T18:21:50.019000", "t_next": "2025-08-16T00:42:20.578000", "obs_time_seconds": 109230}, {"plate": "6197GDD", "camera_prev": "RUHSM033", "camera_next": "RUHSM033", "t_prev": "2025-08-16T00:42:20.578000", "t_next": "2025-08-16T00:42:20.580000", "obs_time_seconds": 0}, {"plate": "6197GDD", "camera_prev": "RUHSM033", "camera_next": "RUHSM023", "t_prev": "2025-08-16T00:42:20.580000", "t_next": "2025-08-16T17:28:46.803000", "obs_time_seconds": 60386}, {"plate": "6197GDD", "camera_prev": "RUHSM023", "camera_next": "RUHSM023", "t_prev": "2025-08-16T17:28:46.803000", "t_next": "2025-08-16T17:28:46.936000", "obs_time_seconds": 0}, {"plate": "6197GDD", "camera_prev": "RUHSM023", "camera_next": "RUHSM208", "t_prev": "2025-08-16T17:28:46.936000", "t_next": "2025-08-16T18:05:59.954000", "obs_time_seconds": 2233}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM208", "t_prev": "2025-08-16T18:05:59.954000", "t_next": "2025-08-16T18:06:01.054000", "obs_time_seconds": 2}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM208", "t_prev": "2025-08-16T18:06:01.054000", "t_next": "2025-08-16T18:06:01.188000", "obs_time_seconds": 0}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM208", "t_prev": "2025-08-16T18:06:01.188000", "t_next": "2025-08-16T19:21:52.316000", "obs_time_seconds": 4551}, {"plate": "6197GDD", "camera_prev": "RUHSM208", "camera_next": "RUHSM209", "t_prev": "2025-08-16T19:21:52.316000", "t_next": "2025-08-16T19:22:42.242000", "obs_time_seconds": 50}, {"plate": "6197GDD", "camera_prev": "RUHSM209", "camera_next": "RUHSM026", "t_prev": "2025-08-16T19:22:42.242000", "t_next": "2025-08-16T20:46:26.777000", "obs_time_seconds": 5024}, {"plate": "6197GDD", "camera_prev": "RUHSM026", "camera_next": "RUHSM033", "t_prev": "2025-08-16T20:46:26.777000", "t_next": "2025-08-16T21:21:20.385000", "obs_time_seconds": 2094}, {"plate": "6197GDD", "camera_prev": "RUHSM033", "camera_next": "RUHSM228", "t_prev": "2025-08-16T21:21:20.385000", "t_next": "2025-08-19T19:43:59.625000", "obs_time_seconds": 253359}, {"plate": "6585EZB", "camera_prev": "RUHSM116", "camera_next": "RUHSM279", "t_prev": "2025-07-31T16:54:35.960000", "t_next": "2025-08-01T20:28:31.203000", "obs_time_seconds": 99236}, {"plate": "6585EZB", "camera_prev": "RUHSM279", "camera_next": "RUHSM055", "t_prev": "2025-08-01T20:28:31.203000", "t_next": "2025-08-01T23:58:01.588000", "obs_time_seconds": 12570}, {"plate": "6585EZB", "camera_prev": "RUHSM055", "camera_next": "RUHSM095", "t_prev": "2025-08-01T23:58:01.588000", "t_next": "2025-08-02T18:33:28.680000", "obs_time_seconds": 66927}, {"plate": "6585EZB", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-02T18:33:28.680000", "t_next": "2025-08-02T18:33:28.980000", "obs_time_seconds": 0}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-07-29T14:31:26.313000", "t_next": "2025-07-29T20:43:55.302000", "obs_time_seconds": 22349}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-07-29T20:43:55.302000", "t_next": "2025-07-29T20:43:55.568000", "obs_time_seconds": 0}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM156", "t_prev": "2025-07-29T20:43:55.568000", "t_next": "2025-07-30T14:27:19.956000", "obs_time_seconds": 63804}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-07-30T14:27:19.956000", "t_next": "2025-07-30T14:27:20.056000", "obs_time_seconds": 1}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-07-30T14:27:20.056000", "t_next": "2025-07-31T14:26:11.191000", "obs_time_seconds": 86331}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-07-31T14:26:11.191000", "t_next": "2025-07-31T14:26:11.491000", "obs_time_seconds": 0}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM547", "t_prev": "2025-07-31T14:26:11.491000", "t_next": "2025-07-31T20:39:43.629000", "obs_time_seconds": 22412}, {"plate": "1594UBD", "camera_prev": "RUHSM547", "camera_next": "RUHSM095", "t_prev": "2025-07-31T20:39:43.629000", "t_next": "2025-08-01T22:28:52.807000", "obs_time_seconds": 92949}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-01T22:28:52.807000", "t_next": "2025-08-02T20:09:07.157000", "obs_time_seconds": 78015}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-02T20:09:07.157000", "t_next": "2025-08-02T20:09:07.290000", "obs_time_seconds": 0}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-02T20:09:07.290000", "t_next": "2025-08-04T06:41:02.058000", "obs_time_seconds": 124315}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM156", "t_prev": "2025-08-04T06:41:02.058000", "t_next": "2025-08-05T06:18:50.286000", "obs_time_seconds": 85068}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-08-05T06:18:50.286000", "t_next": "2025-08-06T06:28:03.842000", "obs_time_seconds": 86953}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-08-06T06:28:03.842000", "t_next": "2025-08-06T06:28:03.942000", "obs_time_seconds": 0}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM095", "t_prev": "2025-08-06T06:28:03.942000", "t_next": "2025-08-06T06:36:24.748000", "obs_time_seconds": 501}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-06T06:36:24.748000", "t_next": "2025-08-06T06:36:24.748000", "obs_time_seconds": 0}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM156", "t_prev": "2025-08-06T06:36:24.748000", "t_next": "2025-08-07T06:20:44.151000", "obs_time_seconds": 85460}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM095", "t_prev": "2025-08-07T06:20:44.151000", "t_next": "2025-08-07T06:26:25.794000", "obs_time_seconds": 341}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-07T06:26:25.794000", "t_next": "2025-08-07T06:26:26.094000", "obs_time_seconds": 1}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM156", "t_prev": "2025-08-07T06:26:26.094000", "t_next": "2025-08-10T06:15:07.091000", "obs_time_seconds": 258521}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM095", "t_prev": "2025-08-10T06:15:07.091000", "t_next": "2025-08-12T06:25:38.193000", "obs_time_seconds": 173431}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-12T06:25:38.193000", "t_next": "2025-08-13T06:22:41.071000", "obs_time_seconds": 86223}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM049", "t_prev": "2025-08-13T06:22:41.071000", "t_next": "2025-08-13T22:17:00.153000", "obs_time_seconds": 57259}, {"plate": "1594UBD", "camera_prev": "RUHSM049", "camera_next": "RUHSM156", "t_prev": "2025-08-13T22:17:00.153000", "t_next": "2025-08-14T06:14:29.406000", "obs_time_seconds": 28649}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM095", "t_prev": "2025-08-14T06:14:29.406000", "t_next": "2025-08-14T06:20:08.987000", "obs_time_seconds": 339}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM095", "t_prev": "2025-08-14T06:20:08.987000", "t_next": "2025-08-14T06:20:09.321000", "obs_time_seconds": 1}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM093", "t_prev": "2025-08-14T06:20:09.321000", "t_next": "2025-08-15T19:17:20.382000", "obs_time_seconds": 133031}, {"plate": "1594UBD", "camera_prev": "RUHSM093", "camera_next": "RUHSM156", "t_prev": "2025-08-15T19:17:20.382000", "t_next": "2025-08-17T06:16:54.702000", "obs_time_seconds": 125974}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM095", "t_prev": "2025-08-17T06:16:54.702000", "t_next": "2025-08-17T06:22:42.456000", "obs_time_seconds": 348}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM156", "t_prev": "2025-08-17T06:22:42.456000", "t_next": "2025-08-18T06:18:54.345000", "obs_time_seconds": 86172}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM095", "t_prev": "2025-08-18T06:18:54.345000", "t_next": "2025-08-18T06:25:09.617000", "obs_time_seconds": 375}, {"plate": "1594UBD", "camera_prev": "RUHSM095", "camera_next": "RUHSM156", "t_prev": "2025-08-18T06:25:09.617000", "t_next": "2025-08-19T06:22:22.768000", "obs_time_seconds": 86233}, {"plate": "1594UBD", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-08-19T06:22:22.768000", "t_next": "2025-08-20T06:19:54.493000", "obs_time_seconds": 86252}, {"plate": "118JUJ", "camera_prev": "RUHSM542", "camera_next": "RUHSM018", "t_prev": "2025-07-30T11:07:54.983000", "t_next": "2025-07-30T22:45:26.728000", "obs_time_seconds": 41852}, {"plate": "118JUJ", "camera_prev": "RUHSM018", "camera_next": "RUHSM156", "t_prev": "2025-07-30T22:45:26.728000", "t_next": "2025-08-09T16:51:23.237000", "obs_time_seconds": 842757}, {"plate": "118JUJ", "camera_prev": "RUHSM156", "camera_next": "RUHSM156", "t_prev": "2025-08-09T16:51:23.237000", "t_next": "2025-08-09T16:51:23.237000", "obs_time_seconds": 0}, {"plate": "118JUJ", "camera_prev": "RUHSM156", "camera_next": "RUHSM255", "t_prev": "2025-08-09T16:51:23.237000", "t_next": "2025-08-18T09:17:17.779000", "obs_time_seconds": 750354}, {"plate": "7178KBB", "camera_prev": "RUHSM003", "camera_next": "RUHSM350", "t_prev": "2025-08-04T15:41:58.514000", "t_next": "2025-08-05T19:21:15.119000", "obs_time_seconds": 99557}, {"plate": "7178KBB", "camera_prev": "RUHSM350", "camera_next": "RUHSM003", "t_prev": "2025-08-05T19:21:15.119000", "t_next": "2025-08-17T16:05:16.317000", "obs_time_seconds": 1025041}, {"plate": "5177T", "camera_prev": "RUHSM141", "camera_next": "RUHSM102", "t_prev": "2025-08-11T22:35:41.392000", "t_next": "2025-08-18T17:10:12.851000", "obs_time_seconds": 585271}, {"plate": "6491HEA", "camera_prev": "RUHSM098", "camera_next": "RUHSM098", "t_prev": "2025-08-07T07:19:53.348000", "t_next": "2025-08-07T07:19:53.348000", "obs_time_seconds": 0}, {"plate": "6491HEA", "camera_prev": "RUHSM098", "camera_next": "RUHSM049", "t_prev": "2025-08-07T07:19:53.348000", "t_next": "2025-08-13T10:11:08.021000", "obs_time_seconds": 528675}, {"plate": "6491HEA", "camera_prev": "RUHSM049", "camera_next": "RUHSM281", "t_prev": "2025-08-13T10:11:08.021000", "t_next": "2025-08-16T19:10:09.879000", "obs_time_seconds": 291541}, {"plate": "6491HEA", "camera_prev": "RUHSM281", "camera_next": "RUHTE325", "t_prev": "2025-08-16T19:10:09.879000", "t_next": "2025-08-17T15:15:46.845000", "obs_time_seconds": 72337}, {"plate": "6777KUB", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-17T17:01:25.171000", "t_next": "2025-08-17T17:01:25.461000", "obs_time_seconds": 0}, {"plate": "6777KUB", "camera_prev": "RUHSM026", "camera_next": "RUHSM106", "t_prev": "2025-08-17T17:01:25.461000", "t_next": "2025-08-17T18:17:59.679000", "obs_time_seconds": 4594}, {"plate": "6777KUB", "camera_prev": "RUHSM106", "camera_next": "RUHSM023", "t_prev": "2025-08-17T18:17:59.679000", "t_next": "2025-08-17T18:32:08.503000", "obs_time_seconds": 849}, {"plate": "6777KUB", "camera_prev": "RUHSM023", "camera_next": "RUHSM033", "t_prev": "2025-08-17T18:32:08.503000", "t_next": "2025-08-19T08:43:14.723000", "obs_time_seconds": 137466}, {"plate": "6777KUB", "camera_prev": "RUHSM033", "camera_next": "RUHSM033", "t_prev": "2025-08-19T08:43:14.723000", "t_next": "2025-08-19T08:43:14.886000", "obs_time_seconds": 0}, {"plate": "6777KUB", "camera_prev": "RUHSM033", "camera_next": "RUHSM267", "t_prev": "2025-08-19T08:43:14.886000", "t_next": "2025-08-19T08:50:51.981000", "obs_time_seconds": 457}, {"plate": "6777KUB", "camera_prev": "RUHSM267", "camera_next": "RUHSM060", "t_prev": "2025-08-19T08:50:51.981000", "t_next": "2025-08-19T09:19:30.717000", "obs_time_seconds": 1719}, {"plate": "6777KUB", "camera_prev": "RUHSM060", "camera_next": "RUHSM271", "t_prev": "2025-08-19T09:19:30.717000", "t_next": "2025-08-19T21:35:26.956000", "obs_time_seconds": 44156}, {"plate": "419ATJ", "camera_prev": "RUHSM281", "camera_next": "RUHSM157", "t_prev": "2025-08-01T03:49:52.418000", "t_next": "2025-08-06T20:05:29.807000", "obs_time_seconds": 490537}, {"plate": "419ATJ", "camera_prev": "RUHSM157", "camera_next": "RUHSM157", "t_prev": "2025-08-06T20:05:29.807000", "t_next": "2025-08-06T20:05:29.807000", "obs_time_seconds": 0}, {"plate": "419ATJ", "camera_prev": "RUHSM157", "camera_next": "RUHTE333", "t_prev": "2025-08-06T20:05:29.807000", "t_next": "2025-08-06T20:17:39.710000", "obs_time_seconds": 730}, {"plate": "419ATJ", "camera_prev": "RUHTE333", "camera_next": "RUHTE333", "t_prev": "2025-08-06T20:17:39.710000", "t_next": "2025-08-06T20:17:39.710000", "obs_time_seconds": 0}, {"plate": "419ATJ", "camera_prev": "RUHTE333", "camera_next": "RUHTE318", "t_prev": "2025-08-06T20:17:39.710000", "t_next": "2025-08-07T20:27:13.009000", "obs_time_seconds": 86974}, {"plate": "419ATJ", "camera_prev": "RUHTE318", "camera_next": "RUHTE318", "t_prev": "2025-08-07T20:27:13.009000", "t_next": "2025-08-07T20:27:13.009000", "obs_time_seconds": 0}, {"plate": "419ATJ", "camera_prev": "RUHTE318", "camera_next": "RUHSM045", "t_prev": "2025-08-07T20:27:13.009000", "t_next": "2025-08-09T18:51:44.440000", "obs_time_seconds": 167071}, {"plate": "419ATJ", "camera_prev": "RUHSM045", "camera_next": "RUHSM045", "t_prev": "2025-08-09T18:51:44.440000", "t_next": "2025-08-09T18:51:44.441000", "obs_time_seconds": 0}, {"plate": "419ATJ", "camera_prev": "RUHSM045", "camera_next": "RUHSM049", "t_prev": "2025-08-09T18:51:44.441000", "t_next": "2025-08-10T22:50:09.683000", "obs_time_seconds": 100705}, {"plate": "419ATJ", "camera_prev": "RUHSM049", "camera_next": "RUHSM243", "t_prev": "2025-08-10T22:50:09.683000", "t_next": "2025-08-14T04:48:25.294000", "obs_time_seconds": 280696}, {"plate": "419ATJ", "camera_prev": "RUHSM243", "camera_next": "RUHSM210", "t_prev": "2025-08-14T04:48:25.294000", "t_next": "2025-08-14T21:13:53.652000", "obs_time_seconds": 59128}, {"plate": "419ATJ", "camera_prev": "RUHSM210", "camera_next": "RUHSM033", "t_prev": "2025-08-14T21:13:53.652000", "t_next": "2025-08-16T19:58:26.845000", "obs_time_seconds": 168273}, {"plate": "2883ZJJ", "camera_prev": "RUHSM033", "camera_next": "RUHSM023", "t_prev": "2025-07-31T20:54:15.371000", "t_next": "2025-08-03T12:05:09.342000", "obs_time_seconds": 227454}, {"plate": "2883ZJJ", "camera_prev": "RUHSM023", "camera_next": "RUHSM052", "t_prev": "2025-08-03T12:05:09.342000", "t_next": "2025-08-03T22:01:17.970000", "obs_time_seconds": 35768}, {"plate": "2883ZJJ", "camera_prev": "RUHSM052", "camera_next": "RUHSM359", "t_prev": "2025-08-03T22:01:17.970000", "t_next": "2025-08-03T22:06:27.240000", "obs_time_seconds": 310}, {"plate": "2883ZJJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-03T22:06:27.240000", "t_next": "2025-08-03T22:06:31.283000", "obs_time_seconds": 4}, {"plate": "2883ZJJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-03T22:06:31.283000", "t_next": "2025-08-03T22:06:31.550000", "obs_time_seconds": 0}, {"plate": "2883ZJJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM025", "t_prev": "2025-08-03T22:06:31.550000", "t_next": "2025-08-07T17:55:27.836000", "obs_time_seconds": 330536}, {"plate": "2883ZJJ", "camera_prev": "RUHSM025", "camera_next": "RUHSM003", "t_prev": "2025-08-07T17:55:27.836000", "t_next": "2025-08-07T18:06:27.176000", "obs_time_seconds": 660}, {"plate": "2883ZJJ", "camera_prev": "RUHSM003", "camera_next": "RUHSM003", "t_prev": "2025-08-07T18:06:27.176000", "t_next": "2025-08-07T18:06:27.176000", "obs_time_seconds": 0}, {"plate": "2883ZJJ", "camera_prev": "RUHSM003", "camera_next": "RUHSM173", "t_prev": "2025-08-07T18:06:27.176000", "t_next": "2025-08-07T18:52:11.918000", "obs_time_seconds": 2744}, {"plate": "2883ZJJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM173", "t_prev": "2025-08-07T18:52:11.918000", "t_next": "2025-08-07T18:52:11.918000", "obs_time_seconds": 0}, {"plate": "2883ZJJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM274", "t_prev": "2025-08-07T18:52:11.918000", "t_next": "2025-08-09T18:07:05.551000", "obs_time_seconds": 170094}, {"plate": "2883ZJJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-09T18:07:05.551000", "t_next": "2025-08-09T18:07:05.551000", "obs_time_seconds": 0}, {"plate": "2883ZJJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-09T18:07:05.551000", "t_next": "2025-08-09T18:07:06.299000", "obs_time_seconds": 1}, {"plate": "2883ZJJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-09T18:07:06.299000", "t_next": "2025-08-09T18:07:06.299000", "obs_time_seconds": 0}, {"plate": "2883ZJJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-09T18:07:06.299000", "t_next": "2025-08-10T10:05:08.359000", "obs_time_seconds": 57482}, {"plate": "2883ZJJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-10T10:05:08.359000", "t_next": "2025-08-12T18:03:32.315000", "obs_time_seconds": 201504}, {"plate": "2883ZJJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-12T18:03:32.315000", "t_next": "2025-08-14T17:33:45.746000", "obs_time_seconds": 171013}, {"plate": "2883ZJJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-14T17:33:45.746000", "t_next": "2025-08-14T17:33:45.746000", "obs_time_seconds": 0}, {"plate": "2883ZJJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM292", "t_prev": "2025-08-14T17:33:45.746000", "t_next": "2025-08-16T11:04:28.743000", "obs_time_seconds": 149443}, {"plate": "5669SVB", "camera_prev": "RUHTE309", "camera_next": "RUHSM140", "t_prev": "2025-08-03T13:39:15.369000", "t_next": "2025-08-08T17:28:37.383000", "obs_time_seconds": 445762}, {"plate": "5669SVB", "camera_prev": "RUHSM140", "camera_next": "RUHSM196", "t_prev": "2025-08-08T17:28:37.383000", "t_next": "2025-08-16T07:39:10.488000", "obs_time_seconds": 655833}, {"plate": "5669SVB", "camera_prev": "RUHSM196", "camera_next": "RUHSM196", "t_prev": "2025-08-16T07:39:10.488000", "t_next": "2025-08-16T07:39:10.756000", "obs_time_seconds": 0}, {"plate": "5471XRB", "camera_prev": "RUHSM102", "camera_next": "RUHSM102", "t_prev": "2025-08-10T20:38:57.214000", "t_next": "2025-08-10T20:38:57.214000", "obs_time_seconds": 0}, {"plate": "9678KLA", "camera_prev": "RUHSM114", "camera_next": "RUHSM255", "t_prev": "2025-07-29T01:46:36.382000", "t_next": "2025-07-29T03:11:38.423000", "obs_time_seconds": 5102}, {"plate": "9678KLA", "camera_prev": "RUHSM255", "camera_next": "RUHSM255", "t_prev": "2025-07-29T03:11:38.423000", "t_next": "2025-07-31T04:55:01.477000", "obs_time_seconds": 179003}, {"plate": "9678KLA", "camera_prev": "RUHSM255", "camera_next": "RUHSM114", "t_prev": "2025-07-31T04:55:01.477000", "t_next": "2025-08-02T05:41:48.408000", "obs_time_seconds": 175607}, {"plate": "9678KLA", "camera_prev": "RUHSM114", "camera_next": "RUHSM055", "t_prev": "2025-08-02T05:41:48.408000", "t_next": "2025-08-08T17:18:44.307000", "obs_time_seconds": 560216}, {"plate": "9678KLA", "camera_prev": "RUHSM055", "camera_next": "RUHSM255", "t_prev": "2025-08-08T17:18:44.307000", "t_next": "2025-08-10T22:41:48.005000", "obs_time_seconds": 192184}, {"plate": "9678KLA", "camera_prev": "RUHSM255", "camera_next": "RUHSM130", "t_prev": "2025-08-10T22:41:48.005000", "t_next": "2025-08-14T18:26:55.678000", "obs_time_seconds": 330307}, {"plate": "9678KLA", "camera_prev": "RUHSM130", "camera_next": "RUHSM045", "t_prev": "2025-08-14T18:26:55.678000", "t_next": "2025-08-15T20:50:08.661000", "obs_time_seconds": 94993}, {"plate": "6113ENJ", "camera_prev": "RUHSM102", "camera_next": "RUHSM274", "t_prev": "2025-08-08T00:12:09.368000", "t_next": "2025-08-17T19:03:11.980000", "obs_time_seconds": 845462}, {"plate": "6113ENJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM467", "t_prev": "2025-08-17T19:03:11.980000", "t_next": "2025-08-19T18:43:04.570000", "obs_time_seconds": 171593}, {"plate": "3776RVA", "camera_prev": "RUHSM034", "camera_next": "RUHSM034", "t_prev": "2025-08-07T01:51:56.571000", "t_next": "2025-08-07T01:51:56.571000", "obs_time_seconds": 0}, {"plate": "2412GXJ", "camera_prev": "RUHSM095", "camera_next": "RUHSM097", "t_prev": "2025-08-08T17:40:48.134000", "t_next": "2025-08-13T21:07:44.500000", "obs_time_seconds": 444416}, {"plate": "8442ZZB", "camera_prev": "RUHSM308", "camera_next": "RUHSM308", "t_prev": "2025-08-10T21:38:06.981000", "t_next": "2025-08-10T21:38:06.981000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM350", "t_prev": "2025-07-29T13:34:19.714000", "t_next": "2025-07-29T14:06:58.708000", "obs_time_seconds": 1959}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHTE311", "t_prev": "2025-07-29T14:06:58.708000", "t_next": "2025-07-30T13:36:08.855000", "obs_time_seconds": 84550}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-07-30T13:36:08.855000", "t_next": "2025-07-30T13:56:03.786000", "obs_time_seconds": 1195}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM292", "t_prev": "2025-07-30T13:56:03.786000", "t_next": "2025-07-31T08:09:35.250000", "obs_time_seconds": 65612}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHTE311", "t_prev": "2025-07-31T08:09:35.250000", "t_next": "2025-08-02T08:08:31.497000", "obs_time_seconds": 172736}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-08-02T08:08:31.497000", "t_next": "2025-08-02T08:25:47.152000", "obs_time_seconds": 1036}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM292", "t_prev": "2025-08-02T08:25:47.152000", "t_next": "2025-08-02T08:25:47.152000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM292", "t_prev": "2025-08-02T08:25:47.152000", "t_next": "2025-08-02T08:25:47.253000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM292", "t_prev": "2025-08-02T08:25:47.253000", "t_next": "2025-08-02T08:25:47.253000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHTE311", "t_prev": "2025-08-02T08:25:47.253000", "t_next": "2025-08-03T07:52:54.714000", "obs_time_seconds": 84427}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM429", "t_prev": "2025-08-03T07:52:54.714000", "t_next": "2025-08-03T08:38:09.037000", "obs_time_seconds": 2715}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHTE311", "t_prev": "2025-08-03T08:38:09.037000", "t_next": "2025-08-04T08:01:38.551000", "obs_time_seconds": 84209}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-08-04T08:01:38.551000", "t_next": "2025-08-04T08:31:36.246000", "obs_time_seconds": 1798}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM292", "t_prev": "2025-08-04T08:31:36.246000", "t_next": "2025-08-04T08:31:36.246000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM350", "t_prev": "2025-08-04T08:31:36.246000", "t_next": "2025-08-04T08:37:51.813000", "obs_time_seconds": 375}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHTE311", "t_prev": "2025-08-04T08:37:51.813000", "t_next": "2025-08-05T13:29:32.353000", "obs_time_seconds": 103901}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHTE311", "t_prev": "2025-08-05T13:29:32.353000", "t_next": "2025-08-05T13:29:32.353000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-08-05T13:29:32.353000", "t_next": "2025-08-05T13:53:50.658000", "obs_time_seconds": 1458}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM350", "t_prev": "2025-08-05T13:53:50.658000", "t_next": "2025-08-05T13:59:36.360000", "obs_time_seconds": 346}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHSM429", "t_prev": "2025-08-05T13:59:36.360000", "t_next": "2025-08-05T14:10:15.694000", "obs_time_seconds": 639}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-05T14:10:15.694000", "t_next": "2025-08-05T14:10:15.694000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-05T14:10:15.694000", "t_next": "2025-08-05T14:19:12.703000", "obs_time_seconds": 537}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-05T14:19:12.703000", "t_next": "2025-08-05T14:19:12.703000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-05T14:19:12.703000", "t_next": "2025-08-05T23:04:07.158000", "obs_time_seconds": 31495}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM125", "t_prev": "2025-08-05T23:04:07.158000", "t_next": "2025-08-05T23:04:15.461000", "obs_time_seconds": 8}, {"plate": "6046JRA", "camera_prev": "RUHSM125", "camera_next": "RUHSM012", "t_prev": "2025-08-05T23:04:15.461000", "t_next": "2025-08-06T13:46:44.411000", "obs_time_seconds": 52949}, {"plate": "6046JRA", "camera_prev": "RUHSM012", "camera_next": "RUHSM012", "t_prev": "2025-08-06T13:46:44.411000", "t_next": "2025-08-06T13:46:44.411000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM012", "camera_next": "RUHSM012", "t_prev": "2025-08-06T13:46:44.411000", "t_next": "2025-08-06T13:46:44.510000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM012", "camera_next": "RUHSM012", "t_prev": "2025-08-06T13:46:44.510000", "t_next": "2025-08-06T13:46:44.510000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM012", "camera_next": "RUHSM106", "t_prev": "2025-08-06T13:46:44.510000", "t_next": "2025-08-06T13:52:12.732000", "obs_time_seconds": 328}, {"plate": "6046JRA", "camera_prev": "RUHSM106", "camera_next": "RUHSM023", "t_prev": "2025-08-06T13:52:12.732000", "t_next": "2025-08-06T14:00:20.562000", "obs_time_seconds": 488}, {"plate": "6046JRA", "camera_prev": "RUHSM023", "camera_next": "RUHSM429", "t_prev": "2025-08-06T14:00:20.562000", "t_next": "2025-08-06T14:17:58.613000", "obs_time_seconds": 1058}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-06T14:17:58.613000", "t_next": "2025-08-06T14:17:58.613000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-06T14:17:58.613000", "t_next": "2025-08-06T23:09:27.528000", "obs_time_seconds": 31889}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-06T23:09:27.528000", "t_next": "2025-08-06T23:09:27.528000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-06T23:09:27.528000", "t_next": "2025-08-06T23:09:27.795000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-06T23:09:27.795000", "t_next": "2025-08-06T23:09:27.795000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHTE311", "t_prev": "2025-08-06T23:09:27.795000", "t_next": "2025-08-07T07:58:57.036000", "obs_time_seconds": 31770}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHTE311", "t_prev": "2025-08-07T07:58:57.036000", "t_next": "2025-08-07T07:58:57.036000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-08-07T07:58:57.036000", "t_next": "2025-08-07T08:24:23.943000", "obs_time_seconds": 1526}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM350", "t_prev": "2025-08-07T08:24:23.943000", "t_next": "2025-08-07T08:30:33.623000", "obs_time_seconds": 370}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHSM429", "t_prev": "2025-08-07T08:30:33.623000", "t_next": "2025-08-07T08:39:59.411000", "obs_time_seconds": 566}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-07T08:39:59.411000", "t_next": "2025-08-07T08:39:59.411000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-07T08:39:59.411000", "t_next": "2025-08-07T14:26:21.238000", "obs_time_seconds": 20782}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-07T14:26:21.238000", "t_next": "2025-08-07T14:26:21.238000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-07T14:26:21.238000", "t_next": "2025-08-07T23:25:31.587000", "obs_time_seconds": 32350}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-07T23:25:31.587000", "t_next": "2025-08-07T23:25:31.587000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHTE311", "t_prev": "2025-08-07T23:25:31.587000", "t_next": "2025-08-09T13:44:16.095000", "obs_time_seconds": 137925}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHTE311", "t_prev": "2025-08-09T13:44:16.095000", "t_next": "2025-08-09T13:44:16.095000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-08-09T13:44:16.095000", "t_next": "2025-08-09T14:09:56.927000", "obs_time_seconds": 1540}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM292", "t_prev": "2025-08-09T14:09:56.927000", "t_next": "2025-08-09T14:09:56.927000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM350", "t_prev": "2025-08-09T14:09:56.927000", "t_next": "2025-08-09T14:15:23.615000", "obs_time_seconds": 327}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHSM350", "t_prev": "2025-08-09T14:15:23.615000", "t_next": "2025-08-09T14:15:23.615000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHSM429", "t_prev": "2025-08-09T14:15:23.615000", "t_next": "2025-08-09T14:24:53.877000", "obs_time_seconds": 570}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-09T14:24:53.877000", "t_next": "2025-08-09T14:24:53.877000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHTE311", "t_prev": "2025-08-09T14:24:53.877000", "t_next": "2025-08-10T13:39:23.501000", "obs_time_seconds": 83670}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-08-10T13:39:23.501000", "t_next": "2025-08-10T14:03:09.140000", "obs_time_seconds": 1426}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM292", "t_prev": "2025-08-10T14:03:09.140000", "t_next": "2025-08-10T14:03:09.140000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM350", "t_prev": "2025-08-10T14:03:09.140000", "t_next": "2025-08-10T14:08:45.200000", "obs_time_seconds": 336}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHSM429", "t_prev": "2025-08-10T14:08:45.200000", "t_next": "2025-08-10T14:18:32.220000", "obs_time_seconds": 587}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-10T14:18:32.220000", "t_next": "2025-08-10T14:18:32.220000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-10T14:18:32.220000", "t_next": "2025-08-10T23:13:39.525000", "obs_time_seconds": 32107}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-10T23:13:39.525000", "t_next": "2025-08-10T23:13:39.666000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHTE311", "t_prev": "2025-08-10T23:13:39.666000", "t_next": "2025-08-11T13:37:16.196000", "obs_time_seconds": 51817}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM429", "t_prev": "2025-08-11T13:37:16.196000", "t_next": "2025-08-11T14:16:31.940000", "obs_time_seconds": 2355}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-11T14:16:31.940000", "t_next": "2025-08-11T14:22:11.584000", "obs_time_seconds": 340}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-11T14:22:11.584000", "t_next": "2025-08-11T23:20:00.862000", "obs_time_seconds": 32269}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-11T23:20:00.862000", "t_next": "2025-08-11T23:20:00.863000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHTE311", "t_prev": "2025-08-11T23:20:00.863000", "t_next": "2025-08-12T13:49:54.013000", "obs_time_seconds": 52194}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM350", "t_prev": "2025-08-12T13:49:54.013000", "t_next": "2025-08-12T14:20:57.376000", "obs_time_seconds": 1863}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHSM026", "t_prev": "2025-08-12T14:20:57.376000", "t_next": "2025-08-12T23:13:44.418000", "obs_time_seconds": 31967}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-12T23:13:44.418000", "t_next": "2025-08-12T23:13:44.551000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-12T23:13:44.551000", "t_next": "2025-08-12T23:13:44.852000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM429", "t_prev": "2025-08-12T23:13:44.852000", "t_next": "2025-08-13T14:30:09.183000", "obs_time_seconds": 54985}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-13T14:30:09.183000", "t_next": "2025-08-13T14:39:06.961000", "obs_time_seconds": 537}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-13T14:39:06.961000", "t_next": "2025-08-13T23:04:18.135000", "obs_time_seconds": 30312}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-13T23:04:18.135000", "t_next": "2025-08-13T23:04:18.606000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-13T23:04:18.606000", "t_next": "2025-08-13T23:04:18.788000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHTE311", "t_prev": "2025-08-13T23:04:18.788000", "t_next": "2025-08-14T07:52:32.793000", "obs_time_seconds": 31694}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-08-14T07:52:32.793000", "t_next": "2025-08-14T08:19:10.140000", "obs_time_seconds": 1598}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM429", "t_prev": "2025-08-14T08:19:10.140000", "t_next": "2025-08-14T08:34:43.300000", "obs_time_seconds": 933}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-14T08:34:43.300000", "t_next": "2025-08-14T17:47:36.875000", "obs_time_seconds": 33173}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-14T17:47:36.875000", "t_next": "2025-08-14T23:13:49.358000", "obs_time_seconds": 19573}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-14T23:13:49.358000", "t_next": "2025-08-14T23:13:50.407000", "obs_time_seconds": 1}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM292", "t_prev": "2025-08-14T23:13:50.407000", "t_next": "2025-08-16T14:05:49.705000", "obs_time_seconds": 139919}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM429", "t_prev": "2025-08-16T14:05:49.705000", "t_next": "2025-08-16T14:22:31.818000", "obs_time_seconds": 1002}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-16T14:22:31.818000", "t_next": "2025-08-16T23:22:07.484000", "obs_time_seconds": 32376}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM292", "t_prev": "2025-08-16T23:22:07.484000", "t_next": "2025-08-17T14:14:35.951000", "obs_time_seconds": 53548}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM429", "t_prev": "2025-08-17T14:14:35.951000", "t_next": "2025-08-17T14:34:43.692000", "obs_time_seconds": 1208}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM429", "t_prev": "2025-08-17T14:34:43.692000", "t_next": "2025-08-17T14:44:53.514000", "obs_time_seconds": 610}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-17T14:44:53.514000", "t_next": "2025-08-17T23:24:50.424000", "obs_time_seconds": 31197}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-17T23:24:50.424000", "t_next": "2025-08-17T23:24:50.964000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-17T23:24:50.964000", "t_next": "2025-08-17T23:24:51.150000", "obs_time_seconds": 1}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM292", "t_prev": "2025-08-17T23:24:51.150000", "t_next": "2025-08-18T14:06:44.936000", "obs_time_seconds": 52913}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM350", "t_prev": "2025-08-18T14:06:44.936000", "t_next": "2025-08-18T14:12:45.140000", "obs_time_seconds": 361}, {"plate": "6046JRA", "camera_prev": "RUHSM350", "camera_next": "RUHSM429", "t_prev": "2025-08-18T14:12:45.140000", "t_next": "2025-08-18T14:24:51.044000", "obs_time_seconds": 726}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-18T14:24:51.044000", "t_next": "2025-08-18T23:15:59.881000", "obs_time_seconds": 31868}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-18T23:15:59.881000", "t_next": "2025-08-18T23:16:00.314000", "obs_time_seconds": 1}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-18T23:16:00.314000", "t_next": "2025-08-18T23:16:00.785000", "obs_time_seconds": 0}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHSM292", "t_prev": "2025-08-18T23:16:00.785000", "t_next": "2025-08-19T14:18:29.190000", "obs_time_seconds": 54149}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM429", "t_prev": "2025-08-19T14:18:29.190000", "t_next": "2025-08-19T14:36:53.583000", "obs_time_seconds": 1104}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-19T14:36:53.583000", "t_next": "2025-08-19T23:09:18.659000", "obs_time_seconds": 30745}, {"plate": "6046JRA", "camera_prev": "RUHSM026", "camera_next": "RUHTE311", "t_prev": "2025-08-19T23:09:18.659000", "t_next": "2025-08-20T13:16:42.836000", "obs_time_seconds": 50844}, {"plate": "6046JRA", "camera_prev": "RUHTE311", "camera_next": "RUHSM292", "t_prev": "2025-08-20T13:16:42.836000", "t_next": "2025-08-20T13:38:36.684000", "obs_time_seconds": 1314}, {"plate": "6046JRA", "camera_prev": "RUHSM292", "camera_next": "RUHSM429", "t_prev": "2025-08-20T13:38:36.684000", "t_next": "2025-08-20T13:55:10.553000", "obs_time_seconds": 994}, {"plate": "6046JRA", "camera_prev": "RUHSM429", "camera_next": "RUHSM026", "t_prev": "2025-08-20T13:55:10.553000", "t_next": "2025-08-20T23:16:53.673000", "obs_time_seconds": 33703}, {"plate": "2261EDJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM228", "t_prev": "2025-07-31T10:43:46.123000", "t_next": "2025-07-31T10:43:46.356000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM228", "camera_next": "RUHSM070", "t_prev": "2025-07-31T10:43:46.356000", "t_next": "2025-07-31T10:47:14.451000", "obs_time_seconds": 208}, {"plate": "2261EDJ", "camera_prev": "RUHSM070", "camera_next": "RUHSM069", "t_prev": "2025-07-31T10:47:14.451000", "t_next": "2025-07-31T10:56:52.556000", "obs_time_seconds": 578}, {"plate": "2261EDJ", "camera_prev": "RUHSM069", "camera_next": "RUHSM069", "t_prev": "2025-07-31T10:56:52.556000", "t_next": "2025-07-31T10:56:52.689000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM069", "camera_next": "RUHSM046", "t_prev": "2025-07-31T10:56:52.689000", "t_next": "2025-07-31T11:34:11.268000", "obs_time_seconds": 2239}, {"plate": "2261EDJ", "camera_prev": "RUHSM046", "camera_next": "RUHSM345", "t_prev": "2025-07-31T11:34:11.268000", "t_next": "2025-08-03T13:23:30.012000", "obs_time_seconds": 265759}, {"plate": "2261EDJ", "camera_prev": "RUHSM345", "camera_next": "RUHSM191", "t_prev": "2025-08-03T13:23:30.012000", "t_next": "2025-08-03T18:42:59.526000", "obs_time_seconds": 19169}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-03T18:42:59.526000", "t_next": "2025-08-03T18:42:59.526000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-03T18:42:59.526000", "t_next": "2025-08-03T18:42:59.660000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-03T18:42:59.660000", "t_next": "2025-08-03T18:42:59.660000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-03T18:42:59.660000", "t_next": "2025-08-03T18:42:59.760000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-03T18:42:59.760000", "t_next": "2025-08-03T18:42:59.760000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM196", "t_prev": "2025-08-03T18:42:59.760000", "t_next": "2025-08-03T22:15:52.288000", "obs_time_seconds": 12773}, {"plate": "2261EDJ", "camera_prev": "RUHSM196", "camera_next": "RUHSM196", "t_prev": "2025-08-03T22:15:52.288000", "t_next": "2025-08-03T22:15:52.288000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM196", "camera_next": "RUHTE326", "t_prev": "2025-08-03T22:15:52.288000", "t_next": "2025-08-04T21:25:13.220000", "obs_time_seconds": 83361}, {"plate": "2261EDJ", "camera_prev": "RUHTE326", "camera_next": "RUHTE326", "t_prev": "2025-08-04T21:25:13.220000", "t_next": "2025-08-04T21:25:13.220000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHTE326", "camera_next": "RUHTE325", "t_prev": "2025-08-04T21:25:13.220000", "t_next": "2025-08-05T00:06:58.804000", "obs_time_seconds": 9705}, {"plate": "2261EDJ", "camera_prev": "RUHTE325", "camera_next": "RUHTE325", "t_prev": "2025-08-05T00:06:58.804000", "t_next": "2025-08-05T00:06:58.804000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHTE325", "camera_next": "RUHSM192", "t_prev": "2025-08-05T00:06:58.804000", "t_next": "2025-08-05T13:11:23.308000", "obs_time_seconds": 47065}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM192", "t_prev": "2025-08-05T13:11:23.308000", "t_next": "2025-08-05T13:11:23.308000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM026", "t_prev": "2025-08-05T13:11:23.308000", "t_next": "2025-08-05T13:17:52.503000", "obs_time_seconds": 389}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM125", "t_prev": "2025-08-05T13:17:52.503000", "t_next": "2025-08-05T13:17:59.347000", "obs_time_seconds": 7}, {"plate": "2261EDJ", "camera_prev": "RUHSM125", "camera_next": "RUHSM106", "t_prev": "2025-08-05T13:17:59.347000", "t_next": "2025-08-05T14:17:22.333000", "obs_time_seconds": 3563}, {"plate": "2261EDJ", "camera_prev": "RUHSM106", "camera_next": "RUHSM023", "t_prev": "2025-08-05T14:17:22.333000", "t_next": "2025-08-05T15:02:51.586000", "obs_time_seconds": 2729}, {"plate": "2261EDJ", "camera_prev": "RUHSM023", "camera_next": "RUHSM191", "t_prev": "2025-08-05T15:02:51.586000", "t_next": "2025-08-05T15:10:43.924000", "obs_time_seconds": 472}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-05T15:10:43.924000", "t_next": "2025-08-05T15:10:43.924000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-05T15:10:43.924000", "t_next": "2025-08-05T15:10:44.023000", "obs_time_seconds": 1}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-05T15:10:44.023000", "t_next": "2025-08-05T15:10:44.023000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM173", "t_prev": "2025-08-05T15:10:44.023000", "t_next": "2025-08-05T15:16:16.391000", "obs_time_seconds": 332}, {"plate": "2261EDJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM012", "t_prev": "2025-08-05T15:16:16.391000", "t_next": "2025-08-06T18:19:41.355000", "obs_time_seconds": 97405}, {"plate": "2261EDJ", "camera_prev": "RUHSM012", "camera_next": "RUHSM012", "t_prev": "2025-08-06T18:19:41.355000", "t_next": "2025-08-06T18:19:41.355000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM012", "camera_next": "RUHSM106", "t_prev": "2025-08-06T18:19:41.355000", "t_next": "2025-08-06T18:30:47.695000", "obs_time_seconds": 666}, {"plate": "2261EDJ", "camera_prev": "RUHSM106", "camera_next": "RUHSM191", "t_prev": "2025-08-06T18:30:47.695000", "t_next": "2025-08-06T18:54:42.510000", "obs_time_seconds": 1435}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-06T18:54:42.510000", "t_next": "2025-08-06T18:54:42.510000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM359", "t_prev": "2025-08-06T18:54:42.510000", "t_next": "2025-08-07T12:33:19.966000", "obs_time_seconds": 63517}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM198", "t_prev": "2025-08-07T12:33:19.966000", "t_next": "2025-08-07T13:35:43.021000", "obs_time_seconds": 3744}, {"plate": "2261EDJ", "camera_prev": "RUHSM198", "camera_next": "RUHSM198", "t_prev": "2025-08-07T13:35:43.021000", "t_next": "2025-08-07T13:35:43.021000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM198", "camera_next": "RUHSM032", "t_prev": "2025-08-07T13:35:43.021000", "t_next": "2025-08-07T16:37:08.979000", "obs_time_seconds": 10885}, {"plate": "2261EDJ", "camera_prev": "RUHSM032", "camera_next": "RUHSM196", "t_prev": "2025-08-07T16:37:08.979000", "t_next": "2025-08-07T18:10:33.150000", "obs_time_seconds": 5605}, {"plate": "2261EDJ", "camera_prev": "RUHSM196", "camera_next": "RUHSM196", "t_prev": "2025-08-07T18:10:33.150000", "t_next": "2025-08-07T18:10:33.150000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM196", "camera_next": "RUHSM052", "t_prev": "2025-08-07T18:10:33.150000", "t_next": "2025-08-08T20:16:33.015000", "obs_time_seconds": 93960}, {"plate": "2261EDJ", "camera_prev": "RUHSM052", "camera_next": "RUHSM052", "t_prev": "2025-08-08T20:16:33.015000", "t_next": "2025-08-08T20:16:33.115000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM052", "camera_next": "RUHSM359", "t_prev": "2025-08-08T20:16:33.115000", "t_next": "2025-08-08T20:21:12.472000", "obs_time_seconds": 279}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-08T20:21:12.472000", "t_next": "2025-08-08T20:21:12.472000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-08T20:21:12.472000", "t_next": "2025-08-08T20:21:13.312000", "obs_time_seconds": 1}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-08T20:21:13.312000", "t_next": "2025-08-08T20:21:13.312000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM173", "t_prev": "2025-08-08T20:21:13.312000", "t_next": "2025-08-08T23:16:35.731000", "obs_time_seconds": 10522}, {"plate": "2261EDJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM274", "t_prev": "2025-08-08T23:16:35.731000", "t_next": "2025-08-09T13:09:50.711000", "obs_time_seconds": 49995}, {"plate": "2261EDJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-09T13:09:50.711000", "t_next": "2025-08-09T13:09:50.711000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-09T13:09:50.711000", "t_next": "2025-08-09T13:09:51.189000", "obs_time_seconds": 1}, {"plate": "2261EDJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-09T13:09:51.189000", "t_next": "2025-08-09T13:09:51.189000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM026", "t_prev": "2025-08-09T13:09:51.189000", "t_next": "2025-08-10T10:28:13.243000", "obs_time_seconds": 76702}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM023", "t_prev": "2025-08-10T10:28:13.243000", "t_next": "2025-08-10T18:49:59.358000", "obs_time_seconds": 30106}, {"plate": "2261EDJ", "camera_prev": "RUHSM023", "camera_next": "RUHSM191", "t_prev": "2025-08-10T18:49:59.358000", "t_next": "2025-08-10T18:58:00.903000", "obs_time_seconds": 481}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T18:58:00.903000", "t_next": "2025-08-10T18:58:00.903000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T18:58:00.903000", "t_next": "2025-08-10T18:58:01.004000", "obs_time_seconds": 1}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-10T18:58:01.004000", "t_next": "2025-08-10T18:58:01.004000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM305", "t_prev": "2025-08-10T18:58:01.004000", "t_next": "2025-08-11T12:50:04.870000", "obs_time_seconds": 64323}, {"plate": "2261EDJ", "camera_prev": "RUHSM305", "camera_next": "RUHSM012", "t_prev": "2025-08-11T12:50:04.870000", "t_next": "2025-08-11T18:32:18.363000", "obs_time_seconds": 20534}, {"plate": "2261EDJ", "camera_prev": "RUHSM012", "camera_next": "RUHSM023", "t_prev": "2025-08-11T18:32:18.363000", "t_next": "2025-08-11T18:53:30.436000", "obs_time_seconds": 1272}, {"plate": "2261EDJ", "camera_prev": "RUHSM023", "camera_next": "RUHSM023", "t_prev": "2025-08-11T18:53:30.436000", "t_next": "2025-08-11T18:53:30.844000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM023", "camera_next": "RUHSM191", "t_prev": "2025-08-11T18:53:30.844000", "t_next": "2025-08-11T19:01:47.236000", "obs_time_seconds": 497}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-11T19:01:47.236000", "t_next": "2025-08-11T19:01:47.336000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-11T19:01:47.336000", "t_next": "2025-08-11T19:01:47.337000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM141", "t_prev": "2025-08-11T19:01:47.337000", "t_next": "2025-08-12T00:01:36.811000", "obs_time_seconds": 17989}, {"plate": "2261EDJ", "camera_prev": "RUHSM141", "camera_next": "RUHSM192", "t_prev": "2025-08-12T00:01:36.811000", "t_next": "2025-08-12T10:53:16.375000", "obs_time_seconds": 39100}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM026", "t_prev": "2025-08-12T10:53:16.375000", "t_next": "2025-08-12T11:03:37.650000", "obs_time_seconds": 621}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM019", "t_prev": "2025-08-12T11:03:37.650000", "t_next": "2025-08-12T13:08:57.108000", "obs_time_seconds": 7520}, {"plate": "2261EDJ", "camera_prev": "RUHSM019", "camera_next": "RUHSM274", "t_prev": "2025-08-12T13:08:57.108000", "t_next": "2025-08-12T13:15:18.746000", "obs_time_seconds": 381}, {"plate": "2261EDJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM201", "t_prev": "2025-08-12T13:15:18.746000", "t_next": "2025-08-12T14:13:14.084000", "obs_time_seconds": 3476}, {"plate": "2261EDJ", "camera_prev": "RUHSM201", "camera_next": "RUHSM015", "t_prev": "2025-08-12T14:13:14.084000", "t_next": "2025-08-12T14:26:37.326000", "obs_time_seconds": 803}, {"plate": "2261EDJ", "camera_prev": "RUHSM015", "camera_next": "RUHSM015", "t_prev": "2025-08-12T14:26:37.326000", "t_next": "2025-08-12T14:26:37.644000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM015", "camera_next": "RUHSM012", "t_prev": "2025-08-12T14:26:37.644000", "t_next": "2025-08-12T17:23:18.153000", "obs_time_seconds": 10601}, {"plate": "2261EDJ", "camera_prev": "RUHSM012", "camera_next": "RUHSM106", "t_prev": "2025-08-12T17:23:18.153000", "t_next": "2025-08-12T17:33:20.297000", "obs_time_seconds": 602}, {"plate": "2261EDJ", "camera_prev": "RUHSM106", "camera_next": "RUHSM023", "t_prev": "2025-08-12T17:33:20.297000", "t_next": "2025-08-12T17:47:34.779000", "obs_time_seconds": 854}, {"plate": "2261EDJ", "camera_prev": "RUHSM023", "camera_next": "RUHSM191", "t_prev": "2025-08-12T17:47:34.779000", "t_next": "2025-08-12T17:58:03.395000", "obs_time_seconds": 629}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-12T17:58:03.395000", "t_next": "2025-08-12T17:58:03.495000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-12T17:58:03.495000", "t_next": "2025-08-12T17:58:04.100000", "obs_time_seconds": 1}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-12T17:58:04.100000", "t_next": "2025-08-12T17:58:04.206000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM023", "t_prev": "2025-08-12T17:58:04.206000", "t_next": "2025-08-13T17:57:01.095000", "obs_time_seconds": 86337}, {"plate": "2261EDJ", "camera_prev": "RUHSM023", "camera_next": "RUHSM191", "t_prev": "2025-08-13T17:57:01.095000", "t_next": "2025-08-13T18:06:04.762000", "obs_time_seconds": 543}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-13T18:06:04.762000", "t_next": "2025-08-13T18:06:04.862000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-13T18:06:04.862000", "t_next": "2025-08-13T18:06:04.999000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-13T18:06:04.999000", "t_next": "2025-08-13T18:06:05.040000", "obs_time_seconds": 1}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM192", "t_prev": "2025-08-13T18:06:05.040000", "t_next": "2025-08-14T10:04:33.846000", "obs_time_seconds": 57508}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM038", "t_prev": "2025-08-14T10:04:33.846000", "t_next": "2025-08-14T12:01:24.176000", "obs_time_seconds": 7011}, {"plate": "2261EDJ", "camera_prev": "RUHSM038", "camera_next": "RUHSM053", "t_prev": "2025-08-14T12:01:24.176000", "t_next": "2025-08-14T13:46:38.915000", "obs_time_seconds": 6314}, {"plate": "2261EDJ", "camera_prev": "RUHSM053", "camera_next": "RUHSM015", "t_prev": "2025-08-14T13:46:38.915000", "t_next": "2025-08-14T14:20:06.692000", "obs_time_seconds": 2008}, {"plate": "2261EDJ", "camera_prev": "RUHSM015", "camera_next": "RUHSM012", "t_prev": "2025-08-14T14:20:06.692000", "t_next": "2025-08-14T17:45:43.505000", "obs_time_seconds": 12337}, {"plate": "2261EDJ", "camera_prev": "RUHSM012", "camera_next": "RUHSM106", "t_prev": "2025-08-14T17:45:43.505000", "t_next": "2025-08-14T17:52:58.294000", "obs_time_seconds": 435}, {"plate": "2261EDJ", "camera_prev": "RUHSM106", "camera_next": "RUHSM106", "t_prev": "2025-08-14T17:52:58.294000", "t_next": "2025-08-14T17:52:58.628000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM106", "camera_next": "RUHSM191", "t_prev": "2025-08-14T17:52:58.628000", "t_next": "2025-08-14T18:18:02.014000", "obs_time_seconds": 1504}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM191", "t_prev": "2025-08-14T18:18:02.014000", "t_next": "2025-08-14T18:18:02.109000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM192", "t_prev": "2025-08-14T18:18:02.109000", "t_next": "2025-08-15T14:06:27.513000", "obs_time_seconds": 71305}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM192", "t_prev": "2025-08-15T14:06:27.513000", "t_next": "2025-08-15T14:06:27.647000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM191", "t_prev": "2025-08-15T14:06:27.647000", "t_next": "2025-08-15T14:37:05.098000", "obs_time_seconds": 1838}, {"plate": "2261EDJ", "camera_prev": "RUHSM191", "camera_next": "RUHSM196", "t_prev": "2025-08-15T14:37:05.098000", "t_next": "2025-08-16T00:58:55.146000", "obs_time_seconds": 37310}, {"plate": "2261EDJ", "camera_prev": "RUHSM196", "camera_next": "RUHSM173", "t_prev": "2025-08-16T00:58:55.146000", "t_next": "2025-08-16T21:09:05.341000", "obs_time_seconds": 72610}, {"plate": "2261EDJ", "camera_prev": "RUHSM173", "camera_next": "RUHSM196", "t_prev": "2025-08-16T21:09:05.341000", "t_next": "2025-08-17T12:46:39.863000", "obs_time_seconds": 56254}, {"plate": "2261EDJ", "camera_prev": "RUHSM196", "camera_next": "RUHSM192", "t_prev": "2025-08-17T12:46:39.863000", "t_next": "2025-08-17T13:06:20.944000", "obs_time_seconds": 1181}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM026", "t_prev": "2025-08-17T13:06:20.944000", "t_next": "2025-08-17T13:13:09.920000", "obs_time_seconds": 409}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM012", "t_prev": "2025-08-17T13:13:09.920000", "t_next": "2025-08-17T18:37:02.834000", "obs_time_seconds": 19433}, {"plate": "2261EDJ", "camera_prev": "RUHSM012", "camera_next": "RUHSM106", "t_prev": "2025-08-17T18:37:02.834000", "t_next": "2025-08-17T18:45:39.234000", "obs_time_seconds": 517}, {"plate": "2261EDJ", "camera_prev": "RUHSM106", "camera_next": "RUHSM192", "t_prev": "2025-08-17T18:45:39.234000", "t_next": "2025-08-18T10:49:17.843000", "obs_time_seconds": 57818}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM192", "t_prev": "2025-08-18T10:49:17.843000", "t_next": "2025-08-18T10:49:17.950000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM026", "t_prev": "2025-08-18T10:49:17.950000", "t_next": "2025-08-18T10:55:03.804000", "obs_time_seconds": 346}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-18T10:55:03.804000", "t_next": "2025-08-18T10:55:04.325000", "obs_time_seconds": 1}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM052", "t_prev": "2025-08-18T10:55:04.325000", "t_next": "2025-08-18T15:13:05.078000", "obs_time_seconds": 15481}, {"plate": "2261EDJ", "camera_prev": "RUHSM052", "camera_next": "RUHSM052", "t_prev": "2025-08-18T15:13:05.078000", "t_next": "2025-08-18T15:13:05.377000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM052", "camera_next": "RUHSM359", "t_prev": "2025-08-18T15:13:05.377000", "t_next": "2025-08-18T15:20:30.337000", "obs_time_seconds": 445}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-18T15:20:30.337000", "t_next": "2025-08-18T15:20:32.370000", "obs_time_seconds": 2}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-18T15:20:32.370000", "t_next": "2025-08-18T15:20:32.505000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM359", "t_prev": "2025-08-18T15:20:32.505000", "t_next": "2025-08-18T15:20:33.737000", "obs_time_seconds": 1}, {"plate": "2261EDJ", "camera_prev": "RUHSM359", "camera_next": "RUHSM274", "t_prev": "2025-08-18T15:20:33.737000", "t_next": "2025-08-18T15:59:23.932000", "obs_time_seconds": 2330}, {"plate": "2261EDJ", "camera_prev": "RUHSM274", "camera_next": "RUHSM192", "t_prev": "2025-08-18T15:59:23.932000", "t_next": "2025-08-19T12:57:26.829000", "obs_time_seconds": 75483}, {"plate": "2261EDJ", "camera_prev": "RUHSM192", "camera_next": "RUHSM026", "t_prev": "2025-08-19T12:57:26.829000", "t_next": "2025-08-19T13:08:19.112000", "obs_time_seconds": 653}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-19T13:08:19.112000", "t_next": "2025-08-19T13:08:19.478000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM026", "t_prev": "2025-08-19T13:08:19.478000", "t_next": "2025-08-19T13:08:19.479000", "obs_time_seconds": 0}, {"plate": "2261EDJ", "camera_prev": "RUHSM026", "camera_next": "RUHSM196", "t_prev": "2025-08-19T13:08:19.479000", "t_next": "2025-08-19T16:32:42.545000", "obs_time_seconds": 12263}, {"plate": "2261EDJ", "camera_prev": "RUHSM196", "camera_next": "RUHSM106", "t_prev": "2025-08-19T16:32:42.545000", "t_next": "2025-08-20T11:16:16.163000", "obs_time_seconds": 67414}, {"plate": "2261EDJ", "camera_prev": "RUHSM106", "camera_next": "RUHSM196", "t_prev": "2025-08-20T11:16:16.163000", "t_next": "2025-08-20T16:32:52.591000", "obs_time_seconds": 18996}, {"plate": "2359ZZA", "camera_prev": "RUHSM035", "camera_next": "RUHTE318", "t_prev": "2025-08-06T17:36:24.974000", "t_next": "2025-08-06T23:39:13.208000", "obs_time_seconds": 21769}, {"plate": "2359ZZA", "camera_prev": "RUHTE318", "camera_next": "RUHTE318", "t_prev": "2025-08-06T23:39:13.208000", "t_next": "2025-08-06T23:39:13.208000", "obs_time_seconds": 0}, {"plate": "2799AXD", "camera_prev": "RUHSM042", "camera_next": "RUHSM042", "t_prev": "2025-08-03T02:06:36.556000", "t_next": "2025-08-03T02:06:36.556000", "obs_time_seconds": 0}, {"plate": "2799AXD", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-03T02:06:36.556000", "t_next": "2025-08-18T11:13:25.639000", "obs_time_seconds": 1328809}, {"plate": "6086HHD", "camera_prev": "RUHSM059", "camera_next": "RUHSM059", "t_prev": "2025-08-07T15:57:36.016000", "t_next": "2025-08-07T15:57:36.016000", "obs_time_seconds": 0}, {"plate": "1751BUA", "camera_prev": "RUHSM325", "camera_next": "RUHSM274", "t_prev": "2025-07-29T06:02:32.458000", "t_next": "2025-08-09T18:13:41.686000", "obs_time_seconds": 994269}, {"plate": "1751BUA", "camera_prev": "RUHSM274", "camera_next": "RUHSM274", "t_prev": "2025-08-09T18:13:41.686000", "t_next": "2025-08-09T18:13:41.686000", "obs_time_seconds": 0}, {"plate": "1751BUA", "camera_prev": "RUHSM274", "camera_next": "RUHTE309", "t_prev": "2025-08-09T18:13:41.686000", "t_next": "2025-08-12T15:58:33.009000", "obs_time_seconds": 251092}, {"plate": "960TDU", "camera_prev": "RUHSM057", "camera_next": "RUHSM156", "t_prev": "2025-07-29T00:12:49.157000", "t_next": "2025-07-31T08:15:29.150000", "obs_time_seconds": 201760}, {"plate": "960TDU", "camera_prev": "RUHSM156", "camera_next": "RUHSM106", "t_prev": "2025-07-31T08:15:29.150000", "t_next": "2025-08-14T10:15:57.126000", "obs_time_seconds": 1216828}, {"plate": "960TDU", "camera_prev": "RUHSM106", "camera_next": "RUHSM106", "t_prev": "2025-08-14T10:15:57.126000", "t_next": "2025-08-19T08:08:03.826000", "obs_time_seconds": 424326}, {"plate": "960TDU", "camera_prev": "RUHSM106", "camera_next": "RUHSM106", "t_prev": "2025-08-19T08:08:03.826000", "t_next": "2025-08-19T08:08:05.460000", "obs_time_seconds": 2}, {"plate": "7291NNJ", "camera_prev": "RUHTE332", "camera_next": "RUHSM296", "t_prev": "2025-08-01T18:24:38.649000", "t_next": "2025-08-20T20:08:18.905000", "obs_time_seconds": 1647820}, {"plate": "688BR", "camera_prev": "RUHTE320", "camera_next": "RUHSM003", "t_prev": "2025-08-09T18:37:00.604000", "t_next": "2025-08-17T14:05:57.282000", "obs_time_seconds": 674937}, {"plate": "688BR", "camera_prev": "RUHSM003", "camera_next": "RUHSM281", "t_prev": "2025-08-17T14:05:57.282000", "t_next": "2025-08-19T16:55:55.435000", "obs_time_seconds": 182998}, {"plate": "6944EUD", "camera_prev": "RUHSM340", "camera_next": "RUHSM429", "t_prev": "2025-08-11T10:24:41.759000", "t_next": "2025-08-11T21:06:01.386000", "obs_time_seconds": 38480}, {"plate": "6944EUD", "camera_prev": "RUHSM429", "camera_next": "RUHSM025", "t_prev": "2025-08-11T21:06:01.386000", "t_next": "2025-08-11T21:17:37.053000", "obs_time_seconds": 696}, {"plate": "6944EUD", "camera_prev": "RUHSM025", "camera_next": "RUHSM042", "t_prev": "2025-08-11T21:17:37.053000", "t_next": "2025-08-11T21:22:06.422000", "obs_time_seconds": 269}, {"plate": "6944EUD", "camera_prev": "RUHSM042", "camera_next": "RUHSM228", "t_prev": "2025-08-11T21:22:06.422000", "t_next": "2025-08-11T21:22:17.153000", "obs_time_seconds": 11}, {"plate": "6944EUD", "camera_prev": "RUHSM228", "camera_next": "RUHSM070", "t_prev": "2025-08-11T21:22:17.153000", "t_next": "2025-08-11T21:25:39.404000", "obs_time_seconds": 202}, {"plate": "2035UZB", "camera_prev": "RUHSM547", "camera_next": "RUHSM098", "t_prev": "2025-08-09T20:49:51.758000", "t_next": "2025-08-11T00:18:45.958000", "obs_time_seconds": 98934}, {"plate": "2035UZB", "camera_prev": "RUHSM098", "camera_next": "RUHSM098", "t_prev": "2025-08-11T00:18:45.958000", "t_next": "2025-08-13T21:13:39.529000", "obs_time_seconds": 248094}, {"plate": "5543UUA", "camera_prev": "RUHSM190", "camera_next": "RUHSM190", "t_prev": "2025-08-10T21:39:58.216000", "t_next": "2025-08-10T21:39:58.216000", "obs_time_seconds": 0}, {"plate": "5543UUA", "camera_prev": "RUHSM190", "camera_next": "RUHSM304", "t_prev": "2025-08-10T21:39:58.216000", "t_next": "2025-08-16T23:48:16.960000", "obs_time_seconds": 526098}];

const VEHICLES = ["118JUJ", "120RLB", "1218LSJ", "1511DAJ", "1594UBD", "1620GAD", "1751BUA", "1855TZB", "2035UZB", "2238NLA", "2261EDJ", "2359ZZA", "2412GXJ", "2734KRD", "2799AXD", "2883ZJJ", "3776RVA", "4148ZBJ", "419ATJ", "4425ERR", "4583ZDD", "464SAL", "4650NLD", "5177T", "5471XRB", "5540BBB", "5543UUA", "5669SVB", "6046JRA", "6086HHD", "6113ENJ", "6197GDD", "6250UJJ", "6491HEA", "6585EZB", "6777KUB", "6856UGB", "688BR", "6944EUD", "7178KBB", "7291NNJ", "8442ZZB", "8889BDR", "910TBJ", "914HDA", "9250TZD", "9571XKJ", "960TDU", "9675SBA", "9678KLA"];

// Sites with coordinates (from google_matrix)
const SITES = {"RUHSM001":{"lat":24.7403322023658,"lon":46.6273981332779,"dir":"S"},"RUHSM002":{"lat":24.740427194217,"lon":46.6274785995483,"dir":"N"},"RUHSM003":{"lat":24.7546965432207,"lon":46.6325774788857,"dir":"E"},"RUHSM007":{"lat":24.6726265911391,"lon":46.656776368618,"dir":"S"},"RUHSM009":{"lat":24.7209740445557,"lon":46.6058734059334,"dir":"N"},"RUHSM012":{"lat":24.6483701639916,"lon":46.7946767807007,"dir":"N"},"RUHSM015":{"lat":24.5439855825558,"lon":46.872533261776,"dir":"S"},"RUHSM018":{"lat":24.8287062928303,"lon":46.6193702816963,"dir":"E"},"RUHSM019":{"lat":24.8178075375809,"lon":46.6184422373772,"dir":"S"},"RUHSM022":{"lat":24.670488879256,"lon":46.6602820158005,"dir":"N"},"RUHSM023":{"lat":24.780546768419,"lon":46.7285308241844,"dir":"N"},"RUHSM024":{"lat":24.6799116099266,"lon":46.6544723510742,"dir":"S"},"RUHSM025":{"lat":24.7649189230075,"lon":46.6561299562454,"dir":"W"},"RUHSM026":{"lat":24.7731896590511,"lon":46.7319613695145,"dir":"S"},"RUHSM027":{"lat":24.6750541016666,"lon":46.6531071066856,"dir":"E"},"RUHSM029":{"lat":24.9694129976553,"lon":46.7820569872856,"dir":"N"},"RUHSM030":{"lat":25.0012034832327,"lon":46.7709928750992,"dir":"S"},"RUHSM032":{"lat":24.7120199687664,"lon":46.6719147562981,"dir":"S"},"RUHSM033":{"lat":24.7897540511277,"lon":46.7158091068268,"dir":"E"},"RUHSM034":{"lat":24.6755122958506,"lon":46.6905936598778,"dir":"N"},"RUHSM035":{"lat":24.6203516108267,"lon":46.5742367506027,"dir":"E"},"RUHSM038":{"lat":24.6846274081011,"lon":46.7023712396622,"dir":"W"},"RUHSM042":{"lat":24.740704875449,"lon":46.5987414121628,"dir":"W"},"RUHSM044":{"lat":24.8400178982926,"lon":46.6072306036949,"dir":"S"},"RUHSM045":{"lat":24.6261962301252,"lon":46.7836314439774,"dir":"W"},"RUHSM046":{"lat":24.5856708282881,"lon":46.6952633857727,"dir":"E"},"RUHSM049":{"lat":24.8066959557292,"lon":46.7554226517677,"dir":"W"},"RUHSM051":{"lat":24.5581848394885,"lon":46.6767024993897,"dir":"E"},"RUHSM052":{"lat":24.7243240497979,"lon":46.6658690571785,"dir":"N"},"RUHSM053":{"lat":24.6729043824091,"lon":46.6916853189468,"dir":"S"},"RUHSM054":{"lat":24.6123632798959,"lon":46.7067539691925,"dir":"S"},"RUHSM055":{"lat":24.6110781730948,"lon":46.707022190094,"dir":"N"},"RUHSM057":{"lat":24.6656945509571,"lon":46.6192603111267,"dir":"E"},"RUHSM059":{"lat":24.831956030886,"lon":46.8484577536583,"dir":"S"},"RUHSM060":{"lat":24.8321897210297,"lon":46.7234346270561,"dir":"S"},"RUHSM062":{"lat":24.7980377711983,"lon":46.569601893425,"dir":"W"},"RUHSM069":{"lat":24.56560566558,"lon":46.6250592470169,"dir":"E"},"RUHSM070":{"lat":24.6942463632656,"lon":46.5634649991989,"dir":"S"},"RUHSM071":{"lat":24.6711544395348,"lon":46.6223931312561,"dir":"N"},"RUHSM072":{"lat":24.6707963331305,"lon":46.6222590208054,"dir":"S"},"RUHSM073":{"lat":24.6870447823229,"lon":46.6315904259682,"dir":"W"},"RUHSM074":{"lat":24.6869545710959,"lon":46.6317647695541,"dir":"E"},"RUHSM077":{"lat":24.8111586340332,"lon":46.7348715662956,"dir":"N"},"RUHSM078":{"lat":24.8110612436613,"lon":46.7346113920212,"dir":"S"},"RUHSM079":{"lat":24.5588531422709,"lon":46.6225674748421,"dir":"E"},"RUHSM080":{"lat":24.5589824415937,"lon":46.622556746006,"dir":"W"},"RUHSM093":{"lat":24.8325232108086,"lon":46.8203857541084,"dir":"W"},"RUHSM095":{"lat":24.7800816178938,"lon":46.8530228734016,"dir":"E"},"RUHSM096":{"lat":24.5348626583046,"lon":46.6983264684677,"dir":"N"},"RUHSM097":{"lat":24.598323749187,"lon":46.7443531751633,"dir":"S"},"RUHSM098":{"lat":24.8195992645787,"lon":46.8459257483482,"dir":"N"},"RUHSM100":{"lat":24.5686573528817,"lon":46.8897798657417,"dir":"S"},"RUHSM102":{"lat":24.7352066774981,"lon":46.6819301247597,"dir":"E"},"RUHSM106":{"lat":24.7087793016666,"lon":46.7659583687782,"dir":"N"},"RUHSM110":{"lat":24.8409306555311,"lon":46.5533074736595,"dir":"S"},"RUHSM111":{"lat":24.8410231157739,"lon":46.5536212921143,"dir":"N"},"RUHSM112":{"lat":24.5972800762424,"lon":46.6084000468254,"dir":"W"},"RUHSM113":{"lat":24.5971435038554,"lon":46.6084751486778,"dir":"E"},"RUHSM114":{"lat":24.5475208005664,"lon":46.7195722460747,"dir":"W"},"RUHSM116":{"lat":24.9070265631544,"lon":46.9199708104134,"dir":"W"},"RUHSM117":{"lat":24.5381879590055,"lon":46.6897889971733,"dir":"S"},"RUHSM118":{"lat":24.5382806827733,"lon":46.6898936033249,"dir":"N"},"RUHSM121":{"lat":24.6462394879027,"lon":46.6858944296837,"dir":"E"},"RUHSM122":{"lat":24.7958463762615,"lon":46.7296761274338,"dir":"W"},"RUHSM125":{"lat":24.771906272745,"lon":46.732605099678,"dir":"S"},"RUHSM128":{"lat":24.6981526522312,"lon":46.6789072751999,"dir":"S"},"RUHSM129":{"lat":24.6876372637067,"lon":46.7106726765633,"dir":"E"},"RUHSM130":{"lat":24.6636397195435,"lon":46.7306765913963,"dir":"W"},"RUHSM131":{"lat":24.6634934669944,"lon":46.7308187484741,"dir":"E"},"RUHSM136":{"lat":24.620424801656,"lon":46.5808054804802,"dir":"N"},"RUHSM140":{"lat":24.8769760481679,"lon":46.8059206008911,"dir":"S"},"RUHSM141":{"lat":24.8769687507318,"lon":46.8060520291329,"dir":"N"},"RUHSM142":{"lat":24.5674108328895,"lon":46.655505001545,"dir":"W"},"RUHSM144":{"lat":24.5638614614901,"lon":46.717287003994,"dir":"E"},"RUHSM145":{"lat":24.5687663130558,"lon":46.8898630142212,"dir":"W"},"RUHSM147":{"lat":24.6038597752923,"lon":46.6194561123848,"dir":"E"},"RUHSM148":{"lat":24.6040012164286,"lon":46.6193461418152,"dir":"W"},"RUHSM152":{"lat":24.6854562001529,"lon":46.6520261764526,"dir":"S"},"RUHSM153":{"lat":24.6855219810628,"lon":46.6522246599197,"dir":"N"},"RUHSM156":{"lat":24.7259342868167,"lon":46.7802920937538,"dir":"E"},"RUHSM157":{"lat":24.6409759484262,"lon":46.8291538953781,"dir":"E"},"RUHSM160":{"lat":24.6086054881289,"lon":46.7729669809341,"dir":"N"},"RUHSM161":{"lat":24.6336106991616,"lon":46.8119421601295,"dir":"E"},"RUHSM164":{"lat":24.5796291806517,"lon":46.5517866611481,"dir":"E"},"RUHSM165":{"lat":24.5797877232525,"lon":46.5518108010292,"dir":"W"},"RUHSM168":{"lat":24.5844927893916,"lon":46.7547172307968,"dir":"E"},"RUHSM169":{"lat":24.5982237727608,"lon":46.6173076629639,"dir":"N"},"RUHSM170":{"lat":24.5981359902433,"lon":46.6171762347221,"dir":"S"},"RUHSM173":{"lat":24.7946969705971,"lon":46.6560655832291,"dir":"N"},"RUHSM174":{"lat":24.5079388888788,"lon":46.9285324215889,"dir":"S"},"RUHSM175":{"lat":24.5081024122122,"lon":46.9286692142487,"dir":"N"},"RUHSM178":{"lat":25.0159432570743,"lon":46.7664411664009,"dir":"N"},"RUHSM179":{"lat":25.0158897994536,"lon":46.7662614583969,"dir":"S"},"RUHSM180":{"lat":24.66748117972,"lon":46.7952159047127,"dir":"W"},"RUHSM181":{"lat":24.6672764432188,"lon":46.7952185869217,"dir":"E"},"RUHSM182":{"lat":24.6433261861909,"lon":46.8339711427689,"dir":"S"},"RUHSM187":{"lat":24.642784983054,"lon":46.7355394363403,"dir":"N"},"RUHSM188":{"lat":24.6011674755442,"lon":46.6398543119431,"dir":"N"},"RUHSM189":{"lat":24.6013016369983,"lon":46.6397336125374,"dir":"S"},"RUHSM190":{"lat":24.6326745415304,"lon":46.5654820203781,"dir":"W"},"RUHSM191":{"lat":24.8129651971553,"lon":46.6760292649269,"dir":"S"},"RUHSM192":{"lat":24.8127826050202,"lon":46.6761177778244,"dir":"N"},"RUHSM195":{"lat":24.7299152397197,"lon":46.8647655844688,"dir":"S"},"RUHSM196":{"lat":24.7999978581173,"lon":46.6526859998703,"dir":"E"},"RUHSM198":{"lat":24.7694781484828,"lon":46.6684493422508,"dir":"S"},"RUHSM201":{"lat":24.615255335399,"lon":46.7573323845863,"dir":"S"},"RUHSM207":{"lat":24.7444197548951,"lon":46.6082498431206,"dir":"E"},"RUHSM208":{"lat":24.823774152058,"lon":46.7285388708115,"dir":"N"},"RUHSM209":{"lat":24.8236621627272,"lon":46.7282545566559,"dir":"S"},"RUHSM210":{"lat":24.7432407032976,"lon":46.8001833558083,"dir":"S"},"RUHSM211":{"lat":24.7433162129597,"lon":46.8002933263779,"dir":"N"},"RUHSM212":{"lat":24.6725825464765,"lon":46.8299263715744,"dir":"N"},"RUHSM213":{"lat":24.6725337944213,"lon":46.8298190832138,"dir":"S"},"RUHSM216":{"lat":24.5872366876198,"lon":46.5884765982628,"dir":"W"},"RUHSM217":{"lat":24.5871147808519,"lon":46.5885651111603,"dir":"E"},"RUHSM218":{"lat":24.7088894173431,"lon":46.8437933921814,"dir":"W"},"RUHSM221":{"lat":24.6402519488123,"lon":46.75511687994,"dir":"E"},"RUHSM224":{"lat":24.7455602489784,"lon":46.8242803215981,"dir":"N"},"RUHSM225":{"lat":24.7454847342479,"lon":46.8241676688194,"dir":"S"},"RUHSM226":{"lat":24.7641928838335,"lon":46.8337565660477,"dir":"N"},"RUHSM227":{"lat":24.764122238671,"lon":46.8336492776871,"dir":"S"},"RUHSM228":{"lat":24.7395185293973,"lon":46.5959626436234,"dir":"W"},"RUHSM232":{"lat":24.4701528666928,"lon":46.612468957901,"dir":"E"},"RUHSM233":{"lat":24.5476209553064,"lon":46.6873374581337,"dir":"E"},"RUHSM234":{"lat":24.5477331800292,"lon":46.6874313354492,"dir":"W"},"RUHSM235":{"lat":24.6672178504822,"lon":46.7845594882965,"dir":"W"},"RUHSM238":{"lat":24.4949618404793,"lon":46.9437834620476,"dir":"S"},"RUHSM239":{"lat":24.4951033915724,"lon":46.9439175724983,"dir":"N"},"RUHSM240":{"lat":24.6486919902838,"lon":46.7140683531761,"dir":"S"},"RUHSM241":{"lat":24.6487358708835,"lon":46.7141970992088,"dir":"N"},"RUHSM242":{"lat":24.5620708697593,"lon":46.5307635068893,"dir":"S"},"RUHSM243":{"lat":24.5622074829673,"lon":46.5307849645615,"dir":"N"},"RUHSM244":{"lat":24.5925682421353,"lon":46.5811836719513,"dir":"N"},"RUHSM245":{"lat":24.592451165573,"lon":46.5809771418572,"dir":"S"},"RUHSM246":{"lat":24.5606828008027,"lon":46.5485760569573,"dir":"S"},"RUHSM247":{"lat":24.5608462580163,"lon":46.5485733747482,"dir":"N"},"RUHSM248":{"lat":24.5591532055241,"lon":46.5682715177536,"dir":"S"},"RUHSM249":{"lat":24.5593190901152,"lon":46.5683010220528,"dir":"N"},"RUHSM250":{"lat":24.7962287009035,"lon":46.7782375216484,"dir":"E"},"RUHSM251":{"lat":24.7963431075156,"lon":46.778157055378,"dir":"W"},"RUHSM252":{"lat":24.6506762784333,"lon":46.7848706245422,"dir":"W"},"RUHSM253":{"lat":24.6505348901065,"lon":46.7849349975586,"dir":"E"},"RUHSM254":{"lat":24.6017820953835,"lon":46.6995683312416,"dir":"E"},"RUHSM255":{"lat":24.6019428426154,"lon":46.6995227336884,"dir":"W"},"RUHSM257":{"lat":24.5417677210066,"lon":46.6960680484772,"dir":"N"},"RUHSM258":{"lat":24.5416505969815,"lon":46.6959768533707,"dir":"S"},"RUHSM260":{"lat":24.6184495728811,"lon":46.5350738167763,"dir":"W"},"RUHSM261":{"lat":24.8220580564739,"lon":46.8324986100197,"dir":"W"},"RUHSM262":{"lat":24.7625659273025,"lon":46.8108746409416,"dir":"N"},"RUHSM263":{"lat":24.7625074578522,"lon":46.810756623745,"dir":"S"},"RUHSM265":{"lat":24.6282468000288,"lon":46.5544849634171,"dir":"S"},"RUHSM266":{"lat":24.621812214839,"lon":46.5321287512779,"dir":"S"},"RUHSM267":{"lat":24.8855940582138,"lon":46.7199504375458,"dir":"N"},"RUHSM268":{"lat":24.5686427243791,"lon":46.5279042720795,"dir":"S"},"RUHSM269":{"lat":24.56878873,"lon":46.52792484,"dir":"N"},"RUHSM270":{"lat":24.6423900305582,"lon":46.7355823516846,"dir":"S"},"RUHSM271":{"lat":24.7657883617786,"lon":46.7543041706085,"dir":"E"},"RUHSM274":{"lat":24.8155925940606,"lon":46.6353213787079,"dir":"E"},"RUHSM275":{"lat":24.8347697001099,"lon":46.7905327677727,"dir":"N"},"RUHSM276":{"lat":24.8346966545502,"lon":46.7903396487236,"dir":"S"},"RUHSM278":{"lat":24.6766160926836,"lon":46.8499436974526,"dir":"N"},"RUHSM279":{"lat":24.6765527121673,"lon":46.8497881293297,"dir":"S"},"RUHSM280":{"lat":24.8184475122469,"lon":46.8023881316185,"dir":"N"},"RUHSM281":{"lat":24.8183549901527,"lon":46.8022164702416,"dir":"S"},"RUHSM286":{"lat":24.6720829180904,"lon":46.5581783652306,"dir":"S"},"RUHSM287":{"lat":24.6433213464037,"lon":46.5461325645447,"dir":"W"},"RUHSM290":{"lat":24.6155723237174,"lon":46.7154604196549,"dir":"N"},"RUHSM291":{"lat":24.6155430622212,"lon":46.7153263092041,"dir":"S"},"RUHSM292":{"lat":24.6999315543658,"lon":46.7230913043022,"dir":"N"},"RUHSM296":{"lat":24.7779751316449,"lon":46.7809116840363,"dir":"W"},"RUHSM304":{"lat":24.7020076530006,"lon":46.6487458348274,"dir":"E"},"RUHSM305":{"lat":24.8371752096259,"lon":46.6561380028725,"dir":"S"},"RUHSM306":{"lat":24.7059527461551,"lon":46.6575327515602,"dir":"W"},"RUHSM308":{"lat":24.6226168155053,"lon":46.5494531393051,"dir":"W"},"RUHSM312":{"lat":25.0212345764591,"lon":46.6135954856873,"dir":"E"},"RUHSM313":{"lat":25.0214120108395,"lon":46.6135391592979,"dir":"W"},"RUHSM315":{"lat":24.5423701171962,"lon":46.7042890191078,"dir":"S"},"RUHSM316":{"lat":24.5422652060434,"lon":46.7044472694397,"dir":"N"},"RUHSM325":{"lat":24.5786754649118,"lon":46.741595864296,"dir":"E"},"RUHSM326":{"lat":24.5788146164014,"lon":46.7415341734886,"dir":"W"},"RUHSM336":{"lat":24.9067906009768,"lon":46.977547109127,"dir":"W"},"RUHSM337":{"lat":24.9066907889091,"lon":46.9776409864426,"dir":"E"},"RUHSM340":{"lat":24.9288681103428,"lon":46.7166620492935,"dir":"S"},"RUHSM345":{"lat":24.6962883540936,"lon":46.8563032150269,"dir":"S"},"RUHSM350":{"lat":24.7642247877842,"lon":46.6931256651878,"dir":"N"},"RUHSM358":{"lat":24.7884113106178,"lon":46.6334706544876,"dir":"N"},"RUHSM359":{"lat":24.7553980581506,"lon":46.6502237319946,"dir":"N"},"RUHSM360":{"lat":24.5945431171705,"lon":46.7034012079239,"dir":"S"},"RUHSM368":{"lat":24.6352978544649,"lon":46.6226264834404,"dir":"W"},"RUHSM369":{"lat":24.6351466822632,"lon":46.6227042675018,"dir":"E"},"RUHSM380":{"lat":24.841429643951,"lon":46.8063712120056,"dir":"N"},"RUHSM381":{"lat":24.8413541914201,"lon":46.8061780929566,"dir":"S"},"RUHSM396":{"lat":24.3294130168959,"lon":46.8735444545746,"dir":"S"},"RUHSM397":{"lat":24.3294912044514,"lon":46.8738126754761,"dir":"N"},"RUHSM432":{"lat":24.8907017220214,"lon":46.8079134821892,"dir":"N"},"RUHSM433":{"lat":24.8907309072334,"lon":46.8077713251114,"dir":"S"},"RUHSM451":{"lat":24.6446348177146,"lon":46.6930103302002,"dir":"S"},"RUHSM452":{"lat":24.6443911519871,"lon":46.6931363940239,"dir":"N"},"RUHSM455":{"lat":24.5519562952254,"lon":46.6132870316506,"dir":"E"},"RUHSM456":{"lat":24.5520953694537,"lon":46.6132897138596,"dir":"W"},"RUHSM458":{"lat":24.8195554339359,"lon":46.7520859837532,"dir":"N"},"RUHSM459":{"lat":24.5847343246958,"lon":46.6552877426148,"dir":"E"},"RUHSM460":{"lat":24.5848514020341,"lon":46.6554942727089,"dir":"W"},"RUHSM467":{"lat":24.6270665833972,"lon":46.5201660990715,"dir":"W"},"RUHSM468":{"lat":24.6266960872229,"lon":46.5199971199036,"dir":"E"},"RUHSM525":{"lat":25.012863802906,"lon":46.6809833049774,"dir":"S"},"RUHSM526":{"lat":25.0128613773877,"lon":46.6811040043831,"dir":"N"},"RUHSM530":{"lat":24.6072056361663,"lon":46.660198867321,"dir":"N"},"RUHSM531":{"lat":24.6073153598916,"lon":46.6601157188416,"dir":"S"},"RUHSM540":{"lat":24.625494022299,"lon":46.6844916343689,"dir":"W"},"RUHSM541":{"lat":24.6253794264026,"lon":46.6844862699509,"dir":"E"},"RUHSM542":{"lat":24.9065182947864,"lon":46.6434082388878,"dir":"W"},"RUHSM543":{"lat":24.9064526219956,"lon":46.6431882977486,"dir":"E"},"RUHSM546":{"lat":24.7902436855305,"lon":46.8545919656754,"dir":"W"},"RUHSM547":{"lat":24.7901097595178,"lon":46.8544578552246,"dir":"E"},"RUHSM555":{"lat":24.8721018851866,"lon":46.6604670882225,"dir":"N"},"RUHSM556":{"lat":24.8720069697679,"lon":46.6602981090546,"dir":"S"},"RUHSM559":{"lat":24.5441977464061,"lon":46.8807810544968,"dir":"E"},"RUHSM560":{"lat":24.5442490050968,"lon":46.8806630373001,"dir":"W"},"RUHSM576":{"lat":24.856359089514,"lon":46.7374357581139,"dir":"N"},"RUHSM577":{"lat":24.8563639531407,"lon":46.7373177409172,"dir":"S"},"RUHTE304":{"lat":24.5842414097686,"lon":46.7537328600884,"dir":"W"},"RUHTE305":{"lat":24.5903877908723,"lon":46.7684072256088,"dir":"E"},"RUHTE306":{"lat":24.5905317003463,"lon":46.7683106660843,"dir":"W"},"RUHTE309":{"lat":24.6524997358911,"lon":46.837058365345,"dir":"S"},"RUHTE311":{"lat":24.6064936135113,"lon":46.7306846380234,"dir":"N"},"RUHTE312":{"lat":24.7251035336184,"lon":46.846419274807,"dir":"S"},"RUHTE313":{"lat":24.7251863658135,"lon":46.8465641140938,"dir":"N"},"RUHTE315":{"lat":24.6141750770559,"lon":46.8200236558914,"dir":"S"},"RUHTE316":{"lat":24.6142896999613,"lon":46.8201014399529,"dir":"N"},"RUHTE317":{"lat":24.6667255799159,"lon":46.5599271655083,"dir":"N"},"RUHTE318":{"lat":24.8014076405187,"lon":46.7830601334572,"dir":"N"},"RUHTE319":{"lat":24.8013516499019,"lon":46.7829152941704,"dir":"S"},"RUHTE320":{"lat":24.5822390462004,"lon":46.800848543644,"dir":"E"},"RUHTE321":{"lat":24.5821049042435,"lon":46.8009102344513,"dir":"W"},"RUHTE325":{"lat":24.8405124734256,"lon":46.6326740384102,"dir":"S"},"RUHTE326":{"lat":24.84056807361,"lon":46.632821559906,"dir":"N"},"RUHTE327":{"lat":25.0019957881179,"lon":46.5249887108803,"dir":"S"},"RUHTE329":{"lat":24.7977018282743,"lon":46.6402861475945,"dir":"E"},"RUHTE330":{"lat":24.7980061369433,"lon":46.6402700543404,"dir":"W"},"RUHTE331":{"lat":24.5881342040044,"lon":46.6691654920578,"dir":"W"},"RUHTE332":{"lat":24.6438528149027,"lon":46.5914431214333,"dir":"W"},"RUHTE333":{"lat":24.643733326556,"lon":46.5916550159454,"dir":"E"},"RUHTE334":{"lat":24.6315966143575,"lon":46.8755158782005,"dir":"N"},"RUHTE335":{"lat":24.6308021511539,"lon":46.8756607174873,"dir":"S"},"RUHTE336":{"lat":24.9054087603904,"lon":46.5742716193199,"dir":"N"},"RUHTE337":{"lat":24.9053406696483,"lon":46.5741160511971,"dir":"S"},"RUHSM429":{"lat":24.7897,"lon":46.6761,"dir":"E"}};

// Expected times will be loaded from external file or use fallback estimates
let EXPECTED_TIMES = {};
let EXPECTED_WAYPOINTS = {}; // Store waypoints: "SITE_A_SITE_B" -> [siteId1, siteId2, ...]
let EXPECTED_DISTANCES = {}; // Store distances: "SITE_A_SITE_B" -> km
let expectedTimesLoaded = false;

// Dynamic r_max table: "camera_prev_camera_next_weekday" -> r_max
// Or with vehicle type: "camera_prev_camera_next_weekday_vehicleType" -> r_max
let DYNAMIC_RMAX = {};
let dynamicRmaxLoaded = false;
let dynamicRmaxHasVehicleType = false; // Whether r_max table includes vehicle type

// Vehicle types found in data
let VEHICLE_TYPES = {}; // { typeCode: label }

// Batch processing results: vehicle -> segmented paths
let ALL_SEGMENTED_PATHS = {};

// Initialize self-routes (site to itself = 0 time, 0 distance) - embedded in HTML
(function initSelfRoutes() {
    Object.keys(SITES).forEach(siteId => {
        const selfKey = siteId + '_' + siteId;
        EXPECTED_TIMES[selfKey] = 0;
        EXPECTED_DISTANCES[selfKey] = 0;
        // No waypoints for self-route
    });
    console.log('Initialized', Object.keys(SITES).length, 'self-routes (site to itself = 0)');
})();

// ============ MAP VARIABLES ============
let map, markers = [], polylines = [];
let currentRoute = [];
let directionsService = null;
let corridorPolyline = null;  // For displaying expected corridor from Google Matrix
let corridorMarkers = [];     // Waypoint markers on the corridor

// ============ INITIALIZATION ============
// Make initMap globally available
window.initMap = initMap;

function initMap() {
    console.log('initMap called');
    map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 24.7136, lng: 46.6753 },
        zoom: 10,
        styles: [
            { featureType: 'poi', stylers: [{ visibility: 'off' }] },
            { featureType: 'transit', stylers: [{ visibility: 'off' }] }
        ]
    });
    
    // Initialize DirectionsService for road-snapped routes
    directionsService = new google.maps.DirectionsService();
    
    // Populate vehicle dropdown
    const sel = document.getElementById('vehicleSel');
    VEHICLES.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        sel.appendChild(opt);
    });
    
    // Set default dates (from first to last trip date)
    const allDates = TRIPS.map(t => t.t_prev.split('T')[0]).sort();
    const firstDate = allDates[0];
    const lastDate = allDates[allDates.length - 1];
    document.getElementById('startDate').value = firstDate;
    document.getElementById('endDate').value = lastDate;
    
    // Load expected times
    loadExpectedTimes();
    
    console.log('Map initialized with', TRIPS.length, 'trips and', Object.keys(SITES).length, 'sites');
}

// Load expected times from google_matrix file
async function loadExpectedTimes() {
    updateExpectedTimesUI('Loading...', 'Auto-loading google_matrix (2).json', 0, '#2196f3');
    
    try {
        // URL encode the filename (spaces and parentheses)
        const response = await fetch(encodeURI('google_matrix (2).json'));
        if (!response.ok) {
            throw new Error('HTTP ' + response.status);
        }
        const data = await response.json();
        
        console.log('Google Matrix loaded, sites:', data.sites?.length, 'time_min keys:', Object.keys(data.time_min || {}).length);
        processGoogleMatrix(data, 'google_matrix (2).json (auto-loaded)');
        
    } catch (e) {
        console.warn('Could not load google_matrix, using distance-based estimates:', e);
        expectedTimesLoaded = false;
        updateExpectedTimesUI('Not loaded - using distance estimates', 'None (upload a file)', 0, '#e65100');
    }
}

// Process Google Matrix data
function processGoogleMatrix(data, sourceName) {
    EXPECTED_TIMES = {}; // Reset
    EXPECTED_WAYPOINTS = {}; // Reset
    EXPECTED_DISTANCES = {}; // Reset
    
    // Build site_id to index mapping
    const siteIdToIdx = {};
    const sites = data.sites || [];
    sites.forEach((s, i) => siteIdToIdx[s.site_id] = i);
    
    // Also build index to site_id mapping
    const idxToSiteId = {};
    sites.forEach((s, i) => idxToSiteId[i] = s.site_id);
    
    // Convert index-based keys to site_id based - TIME
    const timeMin = data.time_min || {};
    let convertedCount = 0;
    for (const key in timeMin) {
        const parts = key.split('_');
        if (parts.length === 2) {
            const i = parseInt(parts[0]);
            const j = parseInt(parts[1]);
            if (i < sites.length && j < sites.length && sites[i] && sites[j]) {
                const siteKey = sites[i].site_id + '_' + sites[j].site_id;
                EXPECTED_TIMES[siteKey] = timeMin[key];
                convertedCount++;
                // Debug: log first few conversions
                if (convertedCount <= 3) {
                    console.log('Converted time:', key, '->', siteKey, '=', timeMin[key], 'min');
                }
            }
        }
    }
    console.log('Total time entries converted:', convertedCount);
    
    // Convert index-based keys to site_id based - DISTANCE
    const distKm = data.distance_km || {};
    for (const key in distKm) {
        const parts = key.split('_');
        if (parts.length === 2) {
            const i = parseInt(parts[0]);
            const j = parseInt(parts[1]);
            if (i < sites.length && j < sites.length) {
                const siteKey = sites[i].site_id + '_' + sites[j].site_id;
                EXPECTED_DISTANCES[siteKey] = distKm[key];
            }
        }
    }
    
    // Convert waypoints - they are stored as arrays of site indices
    const waypoints = data.waypoints || {};
    let wpCount = 0;
    for (const key in waypoints) {
        const parts = key.split('_');
        if (parts.length === 2) {
            const i = parseInt(parts[0]);
            const j = parseInt(parts[1]);
            if (i < sites.length && j < sites.length) {
                const siteKey = sites[i].site_id + '_' + sites[j].site_id;
                // Convert waypoint indices to site IDs
                const wpIndices = waypoints[key] || [];
                if (wpIndices.length > 0) {
                    EXPECTED_WAYPOINTS[siteKey] = wpIndices.map(idx => idxToSiteId[idx]).filter(Boolean);
                    wpCount++;
                }
            }
        }
    }
    
    // Add self-routes (site to itself = 0 time, 0 distance, 0 waypoints)
    let selfRouteCount = 0;
    Object.keys(SITES).forEach(siteId => {
        const selfKey = siteId + '_' + siteId;
        if (EXPECTED_TIMES[selfKey] === undefined) {
            EXPECTED_TIMES[selfKey] = 0;
            EXPECTED_DISTANCES[selfKey] = 0;
            // No waypoints needed for self-route
            selfRouteCount++;
        }
    });
    console.log('Added', selfRouteCount, 'self-routes (site to itself = 0)');
    
    expectedTimesLoaded = true;
    const count = Object.keys(EXPECTED_TIMES).length;
    const distCount = Object.keys(EXPECTED_DISTANCES).length;
    console.log('Loaded', count, 'expected times,', distCount, 'distances,', wpCount, 'routes with waypoints from', sourceName);
    
    updateExpectedTimesUI('Loaded', sourceName, count + ' (+' + selfRouteCount + ' self)', '#4caf50', wpCount);
}

// Check if a specific route exists in the matrix
function checkRouteInMatrix() {
    const from = document.getElementById('checkRouteFrom').value.trim().toUpperCase();
    const to = document.getElementById('checkRouteTo').value.trim().toUpperCase();
    const resultDiv = document.getElementById('checkRouteResult');
    
    if (!from || !to) {
        resultDiv.innerHTML = '<span style="color:#f44336;">Enter both From and To site IDs</span>';
        return;
    }
    
    const key = from + '_' + to;
    const time = EXPECTED_TIMES[key];
    const dist = EXPECTED_DISTANCES[key];
    const waypoints = EXPECTED_WAYPOINTS[key];
    
    let html = '';
    if (time !== undefined && time !== null) {
        html += `<div style="color:#4caf50;"><strong>${key}</strong>: ${time.toFixed(2)} min`;
        if (dist !== undefined && dist !== null) html += `, ${dist.toFixed(2)} km`;
        html += '</div>';
        if (waypoints && waypoints.length > 0) {
            html += `<div style="color:#1565c0;font-size:0.7rem;">Waypoints: ${waypoints.join('  ')}</div>`;
        } else if (from === to) {
            html += `<div style="color:#666;font-size:0.7rem;">(Self-route: same site)</div>`;
        }
    } else {
        html += `<span style="color:#f44336;"><strong>${key}</strong>: NOT FOUND in matrix</span>`;
        // Check if sites exist
        const fromExists = SITES[from];
        const toExists = SITES[to];
        if (!fromExists) html += `<div style="color:#ff9800;font-size:0.7rem;">Site ${from} not in SITES</div>`;
        if (!toExists) html += `<div style="color:#ff9800;font-size:0.7rem;">Site ${to} not in SITES</div>`;
        
        // Show total entries for debugging
        html += `<div style="color:#666;font-size:0.7rem;">Total EXPECTED_TIMES entries: ${Object.keys(EXPECTED_TIMES).length}</div>`;
    }
    
    resultDiv.innerHTML = html;
}

// ============ DYNAMIC R_MAX ============

// Upload dynamic r_max table (JSON, CSV, or Parquet)
async function uploadDynamicRmax(input) {
    const file = input.files[0];
    if (!file) return;
    
    const statusDiv = document.getElementById('dynamicRmaxStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Reading file...</span>';
    
    try {
        let data;
        
        if (file.name.endsWith('.parquet')) {
            // Handle parquet file
            statusDiv.innerHTML = '<span style="color:#2196f3;">Reading parquet file...</span>';
            data = await readParquetRmax(file);
        } else if (file.name.endsWith('.json')) {
            const text = await file.text();
            data = JSON.parse(text);
            // Handle array or {data: [...]} format
            if (!Array.isArray(data) && data.data) data = data.data;
        } else if (file.name.endsWith('.csv')) {
            const text = await file.text();
            data = parseCSVtoRmax(text);
        } else {
            throw new Error('Unsupported file format. Use .json, .csv, or .parquet');
        }
        
        // Process the r_max data
        processRmaxData(data, file.name);
        
    } catch (err) {
        statusDiv.innerHTML = `<span style="color:#f44336;">Error: ${err.message}</span>`;
        console.error('Error loading r_max:', err);
    }
}

// Read parquet file for r_max data
async function readParquetRmax(file) {
    try {
        const parquet = await import('https://cdn.jsdelivr.net/npm/parquet-wasm@0.6.0/esm/parquet_wasm.js');
        await parquet.default();
        
        const arrayBuffer = await file.arrayBuffer();
        const uint8Array = new Uint8Array(arrayBuffer);
        const arrowTable = parquet.readParquet(uint8Array);
        
        const data = [];
        const schema = arrowTable.schema;
        const numRows = arrowTable.numRows;
        
        // Get columns
        const columns = {};
        for (let i = 0; i < schema.fields.length; i++) {
            const field = schema.fields[i];
            columns[field.name.toLowerCase()] = arrowTable.getChildAt(i);
        }
        
        // Convert to array of objects
        for (let row = 0; row < numRows; row++) {
            const record = {};
            for (const [name, column] of Object.entries(columns)) {
                let value = column.get(row);
                if (typeof value === 'bigint') value = Number(value);
                record[name] = value;
            }
            data.push(record);
        }
        
        return data;
        
    } catch (err) {
        console.error('Parquet reading failed:', err);
        throw new Error('Could not read parquet. Convert to JSON first with: python3 convert_rmax_parquet.py ' + file.name);
    }
}

// Process r_max data into lookup table
function processRmaxData(data, sourceName) {
    const statusDiv = document.getElementById('dynamicRmaxStatus');
    
    DYNAMIC_RMAX = {};
    dynamicRmaxHasVehicleType = false;
    let count = 0;
    let countWithType = 0;
    
    // Check if data has vehicle_type column
    if (data.length > 0 && (data[0].vehicle_type !== undefined || data[0].Vehicle_type !== undefined)) {
        dynamicRmaxHasVehicleType = true;
    }
    
    data.forEach(row => {
        const prev = row.camera_prev || row.from;
        const next = row.camera_next || row.to;
        const weekday = row.weekday || row.day;
        const rmax = parseFloat(row.r_max || row.rmax);
        const vehicleType = row.vehicle_type || row.Vehicle_type;
        
        if (prev && next && weekday && !isNaN(rmax)) {
            // Store with vehicle type if available
            if (vehicleType !== undefined) {
                const keyWithType = prev + '_' + next + '_' + weekday + '_' + vehicleType;
                DYNAMIC_RMAX[keyWithType] = rmax;
                countWithType++;
            }
            
            // Also store without vehicle type (as fallback)
            const key = prev + '_' + next + '_' + weekday;
            if (DYNAMIC_RMAX[key] === undefined) {
                DYNAMIC_RMAX[key] = rmax;
            }
            count++;
        }
    });
    
    dynamicRmaxLoaded = true;
    let statusMsg = `Loaded ${count.toLocaleString()} r_max entries`;
    if (dynamicRmaxHasVehicleType) {
        statusMsg += ` (${countWithType.toLocaleString()} with vehicle type)`;
    }
    statusDiv.innerHTML = `<span style="color:#4caf50;">${statusMsg}</span>
        <div style="font-size:0.65rem;color:#666;margin-top:2px;">Source: ${sourceName}</div>`;
    console.log('Loaded dynamic r_max:', count, 'entries,', countWithType, 'with vehicle type');
}

// Parse CSV to r_max format
function parseCSVtoRmax(csvText) {
    const lines = csvText.trim().split('\n');
    if (lines.length < 2) return [];
    
    const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/"/g, ''));
    const data = [];
    
    for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
        const row = {};
        headers.forEach((h, idx) => {
            row[h] = values[idx];
        });
        data.push(row);
    }
    
    return data;
}

// Get r_max for a specific route, day, and optionally vehicle type
function getRmax(cameraPrev, cameraNext, tripDate, vehicleType) {
    if (!dynamicRmaxLoaded) {
        return parseFloat(document.getElementById('rMax').value) || 2.0;
    }
    
    // Get weekday from trip date
    const date = new Date(tripDate);
    const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const weekday = weekdays[date.getDay()];
    
    // Try to find dynamic r_max with vehicle type first (most specific)
    if (dynamicRmaxHasVehicleType && vehicleType !== undefined) {
        const keyWithType = cameraPrev + '_' + cameraNext + '_' + weekday + '_' + vehicleType;
        if (DYNAMIC_RMAX[keyWithType] !== undefined) {
            return DYNAMIC_RMAX[keyWithType];
        }
    }
    
    // Try without vehicle type
    const key = cameraPrev + '_' + cameraNext + '_' + weekday;
    if (DYNAMIC_RMAX[key] !== undefined) {
        return DYNAMIC_RMAX[key];
    }
    
    // Fallback to default
    return parseFloat(document.getElementById('rMax').value) || 2.0;
}

// ============ BATCH PROCESSING ============

// Process all vehicles and store segmented paths
async function processAllVehicles() {
    const statusDiv = document.getElementById('batchStatus');
    
    if (VEHICLES.length === 0) {
        statusDiv.innerHTML = '<span style="color:#f44336;">No vehicles to process. Upload trip data first.</span>';
        return;
    }
    
    // For large datasets, use batch processing
    if (TRIPS.length > 100000) {
        statusDiv.innerHTML = `<span style="color:#ff9800;">Large dataset detected (${TRIPS.length.toLocaleString()} trips). Using optimized batch processing...</span>`;
        await new Promise(r => setTimeout(r, 100));
        await processVehiclesBatch(VEHICLES, 20);
        return;
    }
    
    statusDiv.innerHTML = '<span style="color:#2196f3;">Processing all vehicles...</span>';
    
    ALL_SEGMENTED_PATHS = {};
    let totalPaths = 0;
    let totalTrips = 0;
    
    for (let i = 0; i < VEHICLES.length; i++) {
        const vehicle = VEHICLES[i];
        
        if (i % 10 === 0) {
            statusDiv.innerHTML = `<span style="color:#2196f3;">Processing ${i+1}/${VEHICLES.length}: ${vehicle}...</span>`;
            await new Promise(r => setTimeout(r, 0)); // Yield to UI
        }
        
        // Get all trips for this vehicle
        const vehicleTrips = TRIPS.filter(t => t.plate === vehicle)
            .sort((a, b) => new Date(a.t_prev) - new Date(b.t_prev));
        
        if (vehicleTrips.length > 0) {
            // Segment the route
            const segmented = segmentRoute(vehicleTrips);
            
            // Store results
            ALL_SEGMENTED_PATHS[vehicle] = {
                trips: segmented,
                pathCount: new Set(segmented.map(t => t.pathId)).size,
                tripCount: segmented.length,
                dateRange: {
                    start: vehicleTrips[0].t_prev,
                    end: vehicleTrips[vehicleTrips.length - 1].t_next
                }
            };
            
            totalPaths += ALL_SEGMENTED_PATHS[vehicle].pathCount;
            totalTrips += segmented.length;
        }
    }
    
    statusDiv.innerHTML = `<span style="color:#4caf50;">Processed ${VEHICLES.length} vehicles: ${totalTrips.toLocaleString()} trips, ${totalPaths.toLocaleString()} paths</span>`;
    console.log('Batch processing complete:', ALL_SEGMENTED_PATHS);
    
    // Show loaded paths section
    updateLoadedVehiclesDropdown();
}

// Download segmented paths as JSON
function downloadSegmentedPaths() {
    if (Object.keys(ALL_SEGMENTED_PATHS).length === 0) {
        alert('No segmented paths to download. Click "Process All Vehicles" first.');
        return;
    }
    
    const totalTrips = Object.values(ALL_SEGMENTED_PATHS).reduce((sum, v) => sum + v.tripCount, 0);
    
    // For large datasets, offer chunked download
    if (totalTrips > 500000) {
        if (confirm(`Large dataset (${totalTrips.toLocaleString()} trips). Download as chunked files for better performance?`)) {
            downloadSegmentedPathsChunked();
            return;
        }
    }
    
    // Build export data
    const exportData = {
        metadata: {
            exportDate: new Date().toISOString(),
            vehicleCount: Object.keys(ALL_SEGMENTED_PATHS).length,
            totalTrips: totalTrips,
            totalPaths: Object.values(ALL_SEGMENTED_PATHS).reduce((sum, v) => sum + v.pathCount, 0),
            parameters: {
                rMin: parseFloat(document.getElementById('rMin').value),
                rMaxDefault: parseFloat(document.getElementById('rMax').value),
                epsilon: parseFloat(document.getElementById('epsilonMeters').value),
                dynamicRmaxLoaded: dynamicRmaxLoaded
            }
        },
        vehicles: ALL_SEGMENTED_PATHS
    };
    
    // Create download
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'segmented_paths_' + new Date().toISOString().split('T')[0] + '.json';
    a.click();
    URL.revokeObjectURL(url);
}

// Download segmented paths as multiple chunk files (for large datasets)
async function downloadSegmentedPathsChunked() {
    const statusDiv = document.getElementById('batchStatus');
    const vehicles = Object.keys(ALL_SEGMENTED_PATHS);
    const chunkSize = 100; // vehicles per chunk
    
    statusDiv.innerHTML = '<span style="color:#2196f3;">Preparing chunked download...</span>';
    
    // Create manifest
    const manifest = {
        version: '1.0',
        exportDate: new Date().toISOString(),
        vehicleCount: vehicles.length,
        totalTrips: Object.values(ALL_SEGMENTED_PATHS).reduce((sum, v) => sum + v.tripCount, 0),
        totalPaths: Object.values(ALL_SEGMENTED_PATHS).reduce((sum, v) => sum + v.pathCount, 0),
        parameters: {
            rMin: parseFloat(document.getElementById('rMin').value),
            rMaxDefault: parseFloat(document.getElementById('rMax').value),
            epsilon: parseFloat(document.getElementById('epsilonMeters').value),
            dynamicRmaxLoaded: dynamicRmaxLoaded
        },
        chunks: []
    };
    
    // Download each chunk
    let chunkNum = 0;
    for (let i = 0; i < vehicles.length; i += chunkSize) {
        chunkNum++;
        const chunkVehicles = vehicles.slice(i, i + chunkSize);
        const chunkData = {};
        
        chunkVehicles.forEach(v => {
            chunkData[v] = ALL_SEGMENTED_PATHS[v];
        });
        
        const chunkFilename = `segmented_chunk_${String(chunkNum).padStart(3, '0')}.json`;
        manifest.chunks.push({
            filename: chunkFilename,
            vehicles: chunkVehicles.length,
            trips: chunkVehicles.reduce((s, v) => s + ALL_SEGMENTED_PATHS[v].tripCount, 0)
        });
        
        // Download chunk
        const blob = new Blob([JSON.stringify(chunkData)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = chunkFilename;
        a.click();
        URL.revokeObjectURL(url);
        
        statusDiv.innerHTML = `<span style="color:#2196f3;">Downloaded chunk ${chunkNum}/${Math.ceil(vehicles.length / chunkSize)}...</span>`;
        
        // Small delay between downloads
        await new Promise(r => setTimeout(r, 500));
    }
    
    // Download manifest
    const manifestBlob = new Blob([JSON.stringify(manifest, null, 2)], { type: 'application/json' });
    const manifestUrl = URL.createObjectURL(manifestBlob);
    const manifestLink = document.createElement('a');
    manifestLink.href = manifestUrl;
    manifestLink.download = 'segmented_manifest_' + new Date().toISOString().split('T')[0] + '.json';
    manifestLink.click();
    URL.revokeObjectURL(manifestUrl);
    
    statusDiv.innerHTML = `<span style="color:#4caf50;">Downloaded ${chunkNum} chunks + manifest</span>`;
}

// ============ NETWORK ANALYSIS ============

// Show network analysis modal
function showNetworkAnalysis() {
    if (Object.keys(ALL_SEGMENTED_PATHS).length === 0) {
        alert('No data for network analysis. Click "Process All Vehicles" first.');
        return;
    }
    
    // Build network data: route -> weekday -> count
    const networkData = {};
    const routeStats = {};
    
    Object.keys(ALL_SEGMENTED_PATHS).forEach(vehicle => {
        const trips = ALL_SEGMENTED_PATHS[vehicle].trips;
        
        trips.forEach(trip => {
            const route = trip.camera_prev + '  ' + trip.camera_next;
            const date = new Date(trip.t_prev);
            const weekday = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][date.getDay()];
            
            if (!networkData[route]) {
                networkData[route] = { Sunday: 0, Monday: 0, Tuesday: 0, Wednesday: 0, Thursday: 0, Friday: 0, Saturday: 0, total: 0 };
            }
            networkData[route][weekday]++;
            networkData[route].total++;
            
            // Route stats
            if (!routeStats[route]) {
                routeStats[route] = { vehicles: new Set(), paths: new Set(), avgR: [], rmaxValues: [], breaks: 0, vehicleTypes: {} };
            }
            routeStats[route].vehicles.add(vehicle);
            routeStats[route].paths.add(vehicle + '_' + trip.pathId);
            if (trip.R !== null) routeStats[route].avgR.push(trip.R);
            if (trip.usedRmax !== null && trip.usedRmax !== undefined) routeStats[route].rmaxValues.push(trip.usedRmax);
            if (trip.status === 'break') routeStats[route].breaks++;
            
            // Track vehicle types
            const vTypeLabel = trip.vehicle_type_label || trip.Vehicle_type_label || (trip.vehicle_type !== undefined ? VEHICLE_TYPES[trip.vehicle_type] || 'Type ' + trip.vehicle_type : 'Unknown');
            if (!routeStats[route].vehicleTypes[vTypeLabel]) routeStats[route].vehicleTypes[vTypeLabel] = 0;
            routeStats[route].vehicleTypes[vTypeLabel]++;
        });
    });
    
    // Sort routes by total usage
    const sortedRoutes = Object.keys(networkData).sort((a, b) => networkData[b].total - networkData[a].total);
    
    // Build modal HTML
    let html = `
        <div id="networkModal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:1000;overflow-y:auto;padding:20px;">
            <div style="background:#fff;max-width:1200px;margin:0 auto;border-radius:8px;padding:20px;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                    <h2 style="margin:0;">Network Analysis</h2>
                    <button onclick="document.getElementById('networkModal').remove()" style="padding:5px 15px;cursor:pointer;">Close</button>
                </div>
                
                <div style="display:flex;gap:20px;margin-bottom:15px;flex-wrap:wrap;">
                    <div style="background:#e3f2fd;padding:10px;border-radius:4px;">
                        <strong>${Object.keys(networkData).length}</strong> unique routes
                    </div>
                    <div style="background:#e8f5e9;padding:10px;border-radius:4px;">
                        <strong>${Object.keys(ALL_SEGMENTED_PATHS).length}</strong> vehicles
                    </div>
                    <div style="background:#fff3e0;padding:10px;border-radius:4px;">
                        <strong>${Object.values(networkData).reduce((s, r) => s + r.total, 0)}</strong> total trips
                    </div>
                </div>
                
                <div style="margin-bottom:10px;">
                    <input type="text" id="networkSearch" placeholder="Search routes..." oninput="filterNetworkTable()" style="padding:8px;width:300px;">
                    <button onclick="downloadNetworkCSV()" style="margin-left:10px;padding:8px 15px;cursor:pointer;background:#2e7d32;color:#fff;border:none;border-radius:3px;">
                        Download CSV
                    </button>
                </div>
                
                <div style="max-height:500px;overflow-y:auto;">
                    <table id="networkTable" style="width:100%;border-collapse:collapse;font-size:0.8rem;">
                        <thead style="position:sticky;top:0;background:#f5f5f5;">
                            <tr>
                                <th style="padding:8px;text-align:left;border-bottom:2px solid #ddd;">Route</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Sun</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Mon</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Tue</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Wed</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Thu</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Fri</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Sat</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;background:#e3f2fd;">Total</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Vehicles</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Avg R</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Avg r_max</th>
                                <th style="padding:8px;text-align:center;border-bottom:2px solid #ddd;">Breaks</th>
                                <th style="padding:8px;text-align:left;border-bottom:2px solid #ddd;">Vehicle Types</th>
                            </tr>
                        </thead>
                        <tbody>
    `;
    
    sortedRoutes.forEach(route => {
        const data = networkData[route];
        const stats = routeStats[route];
        const avgR = stats.avgR.length > 0 ? (stats.avgR.reduce((a, b) => a + b, 0) / stats.avgR.length).toFixed(2) : '-';
        const avgRmax = stats.rmaxValues && stats.rmaxValues.length > 0 ? (stats.rmaxValues.reduce((a, b) => a + b, 0) / stats.rmaxValues.length).toFixed(2) : '-';
        
        // Format vehicle types
        const vTypesStr = Object.entries(stats.vehicleTypes || {})
            .map(([type, count]) => `${type}:${count}`)
            .join(', ') || '-';
        
        html += `
            <tr class="network-row" data-route="${route.toLowerCase()}">
                <td style="padding:6px;border-bottom:1px solid #eee;font-family:monospace;">${route}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;${data.Sunday > 0 ? 'background:#e8f5e9;' : ''}">${data.Sunday || '-'}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;${data.Monday > 0 ? 'background:#e8f5e9;' : ''}">${data.Monday || '-'}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;${data.Tuesday > 0 ? 'background:#e8f5e9;' : ''}">${data.Tuesday || '-'}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;${data.Wednesday > 0 ? 'background:#e8f5e9;' : ''}">${data.Wednesday || '-'}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;${data.Thursday > 0 ? 'background:#e8f5e9;' : ''}">${data.Thursday || '-'}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;${data.Friday > 0 ? 'background:#e8f5e9;' : ''}">${data.Friday || '-'}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;${data.Saturday > 0 ? 'background:#e8f5e9;' : ''}">${data.Saturday || '-'}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;background:#e3f2fd;font-weight:bold;">${data.total}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;">${stats.vehicles.size}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;">${avgR}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;color:#9c27b0;">${avgRmax}</td>
                <td style="padding:6px;text-align:center;border-bottom:1px solid #eee;${stats.breaks > 0 ? 'color:#f44336;font-weight:bold;' : ''}">${stats.breaks || '-'}</td>
                <td style="padding:6px;border-bottom:1px solid #eee;font-size:0.7rem;color:#00897b;">${vTypesStr}</td>
            </tr>
        `;
    });
    
    html += `
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    
    // Store network data for CSV export
    window.networkExportData = { networkData, routeStats, sortedRoutes };
    
    // Insert modal
    document.body.insertAdjacentHTML('beforeend', html);
}

// Filter network table
function filterNetworkTable() {
    const search = document.getElementById('networkSearch').value.toLowerCase();
    const rows = document.querySelectorAll('.network-row');
    
    rows.forEach(row => {
        const route = row.getAttribute('data-route');
        row.style.display = route.includes(search) ? '' : 'none';
    });
}

// Download network data as CSV
function downloadNetworkCSV() {
    if (!window.networkExportData) return;
    
    const { networkData, routeStats, sortedRoutes } = window.networkExportData;
    
    let csv = 'Route,From,To,Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Total,Vehicles,AvgR,AvgRmax,Breaks,VehicleTypes\n';
    
    sortedRoutes.forEach(route => {
        const [from, to] = route.split('  ');
        const data = networkData[route];
        const stats = routeStats[route];
        const avgR = stats.avgR.length > 0 ? (stats.avgR.reduce((a, b) => a + b, 0) / stats.avgR.length).toFixed(2) : '';
        const avgRmax = stats.rmaxValues && stats.rmaxValues.length > 0 ? (stats.rmaxValues.reduce((a, b) => a + b, 0) / stats.rmaxValues.length).toFixed(2) : '';
        const vTypes = Object.entries(stats.vehicleTypes || {}).map(([t, c]) => `${t}:${c}`).join('; ');
        
        csv += `"${route}","${from}","${to}",${data.Sunday},${data.Monday},${data.Tuesday},${data.Wednesday},${data.Thursday},${data.Friday},${data.Saturday},${data.total},${stats.vehicles.size},${avgR},${avgRmax},${stats.breaks},"${vTypes}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'network_analysis_' + new Date().toISOString().split('T')[0] + '.csv';
    a.click();
    URL.revokeObjectURL(url);
}

// ============ LOAD SAVED PATHS ============

function uploadProcessedPaths() {
    document.getElementById('pathsUpload').click();
}

function handlePathsUpload(input) {
    const file = input.files[0];
    if (!file) return;
    
    const statusDiv = document.getElementById('batchStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Loading saved paths...</span>';
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            if (data.vehicles) {
                ALL_SEGMENTED_PATHS = data.vehicles;
                const vehicleCount = Object.keys(ALL_SEGMENTED_PATHS).length;
                const totalTrips = Object.values(ALL_SEGMENTED_PATHS).reduce((sum, v) => sum + (v.tripCount || v.trips.length), 0);
                const totalPaths = Object.values(ALL_SEGMENTED_PATHS).reduce((sum, v) => sum + (v.pathCount || new Set(v.trips.map(t => t.pathId)).size), 0);
                
                statusDiv.innerHTML = `<span style="color:#4caf50;">Loaded ${vehicleCount} vehicles: ${totalTrips} trips, ${totalPaths} paths</span>`;
                
                // Show loaded paths section
                updateLoadedVehiclesDropdown();
                
            } else {
                throw new Error('Invalid format. Expected { vehicles: {...} }');
            }
        } catch (err) {
            statusDiv.innerHTML = `<span style="color:#f44336;">Error: ${err.message}</span>`;
            console.error('Error loading paths:', err);
        }
    };
    reader.readAsText(file);
}

function updateLoadedVehiclesDropdown() {
    const section = document.getElementById('loadedPathsSection');
    const select = document.getElementById('loadedVehicleSel');
    
    if (Object.keys(ALL_SEGMENTED_PATHS).length === 0) {
        section.style.display = 'none';
        return;
    }
    
    section.style.display = 'block';
    
    // Sort vehicles by path count
    const vehicles = Object.keys(ALL_SEGMENTED_PATHS).sort((a, b) => {
        const pathsA = ALL_SEGMENTED_PATHS[a].pathCount || new Set(ALL_SEGMENTED_PATHS[a].trips.map(t => t.pathId)).size;
        const pathsB = ALL_SEGMENTED_PATHS[b].pathCount || new Set(ALL_SEGMENTED_PATHS[b].trips.map(t => t.pathId)).size;
        return pathsB - pathsA;
    });
    
    let html = '<option value="">-- Select Vehicle (' + vehicles.length + ') --</option>';
    vehicles.forEach(v => {
        const data = ALL_SEGMENTED_PATHS[v];
        const pathCount = data.pathCount || new Set(data.trips.map(t => t.pathId)).size;
        const tripCount = data.tripCount || data.trips.length;
        html += `<option value="${v}">${v} (${pathCount} paths, ${tripCount} trips)</option>`;
    });
    
    select.innerHTML = html;
}

function showLoadedVehiclePaths() {
    const vehicle = document.getElementById('loadedVehicleSel').value;
    const infoDiv = document.getElementById('loadedPathsInfo');
    
    if (!vehicle || !ALL_SEGMENTED_PATHS[vehicle]) {
        infoDiv.innerHTML = '';
        return;
    }
    
    const data = ALL_SEGMENTED_PATHS[vehicle];
    const trips = data.trips;
    
    // Group trips by pathId
    const paths = {};
    trips.forEach(t => {
        if (!paths[t.pathId]) paths[t.pathId] = [];
        paths[t.pathId].push(t);
    });
    
    let html = `<div style="margin-bottom:8px;"><strong>${Object.keys(paths).length} paths</strong></div>`;
    html += '<div style="max-height:200px;overflow-y:auto;">';
    
    Object.keys(paths).sort((a, b) => parseInt(a) - parseInt(b)).forEach(pathId => {
        const pathTrips = paths[pathId];
        const start = pathTrips[0].camera_prev;
        const end = pathTrips[pathTrips.length - 1].camera_next;
        const startTime = new Date(pathTrips[0].t_prev).toLocaleString();
        
        html += `
            <div style="padding:5px;margin:3px 0;background:#f5f5f5;border-radius:3px;cursor:pointer;" 
                 onclick="displayLoadedPath('${vehicle}', ${pathId})">
                <div style="font-weight:bold;">Path ${pathId}: ${start}  ${end}</div>
                <div style="font-size:0.7rem;color:#666;">${pathTrips.length} trips | ${startTime}</div>
            </div>
        `;
    });
    
    html += '</div>';
    html += `<button onclick="displayAllLoadedPaths('${vehicle}')" style="margin-top:8px;width:100%;padding:6px;cursor:pointer;background:#1565c0;color:#fff;border:none;border-radius:3px;">Show All Paths on Map</button>`;
    
    infoDiv.innerHTML = html;
}

function displayLoadedPath(vehicle, pathId) {
    const data = ALL_SEGMENTED_PATHS[vehicle];
    if (!data) return;
    
    const pathTrips = data.trips.filter(t => t.pathId === pathId);
    if (pathTrips.length === 0) return;
    
    // Update current route and visualize
    currentRoute = pathTrips;
    visualizeSinglePath(pathTrips, pathId);
    renderTripList(pathTrips);
    updateStats(pathTrips);
    
    document.getElementById('activeFilter').innerHTML = `
        <div style="margin-bottom:5px;"><strong>Loaded Path View</strong></div>
        <div>Vehicle: ${vehicle}</div>
        <div>Path: ${pathId}</div>
        <div>Trips: ${pathTrips.length}</div>
    `;
}

function displayAllLoadedPaths(vehicle) {
    const data = ALL_SEGMENTED_PATHS[vehicle];
    if (!data) return;
    
    currentRoute = data.trips;
    visualizeRoute(data.trips);
    renderTripList(data.trips);
    updateStats(data.trips);
    
    document.getElementById('activeFilter').innerHTML = `
        <div style="margin-bottom:5px;"><strong>Loaded Vehicle View</strong></div>
        <div>Vehicle: ${vehicle}</div>
        <div>Paths: ${data.pathCount || new Set(data.trips.map(t => t.pathId)).size}</div>
        <div>Trips: ${data.trips.length}</div>
    `;
}

// ============ TRIP DATA UPLOAD ============

// Track loaded chunks for large files
let LOADED_CHUNKS = {};
let MANIFEST_DATA = null;

// Upload manifest for chunked data (large files)
async function uploadManifest(input) {
    const file = input.files[0];
    if (!file) return;
    
    const statusDiv = document.getElementById('tripDataStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Reading manifest...</span>';
    
    try {
        const text = await file.text();
        const manifest = JSON.parse(text);
        
        if (!manifest.chunks || !Array.isArray(manifest.chunks)) {
            throw new Error('Invalid manifest: missing chunks array');
        }
        
        MANIFEST_DATA = manifest;
        LOADED_CHUNKS = {};
        TRIPS = [];
        VEHICLES = [];
        
        // Set vehicle types from manifest
        if (manifest.vehicle_types) {
            VEHICLE_TYPES = manifest.vehicle_types;
        }
        
        const totalChunks = manifest.chunks.length;
        const totalTrips = manifest.total_trips || manifest.chunks.reduce((s, c) => s + c.trip_count, 0);
        
        statusDiv.innerHTML = `
            <span style="color:#ff9800;">Manifest loaded: ${totalTrips.toLocaleString()} trips in ${totalChunks} chunks</span>
            <div style="font-size:0.7rem;color:#666;margin-top:3px;">Source: ${manifest.source_file || file.name}</div>
            <div style="font-size:0.65rem;color:#1565c0;margin-top:3px;">Upload chunk files or place in same directory</div>
        `;
        
        // Try to auto-load chunks from same directory (if served from server)
        const basePath = file.name.includes('/') ? file.name.substring(0, file.name.lastIndexOf('/') + 1) : '';
        
        // Show chunk status
        showChunkStatus();
        
    } catch (err) {
        statusDiv.innerHTML = `<span style="color:#f44336;">Error: ${err.message}</span>`;
        console.error('Error loading manifest:', err);
    }
}

// Upload multiple chunk files
async function uploadChunks(input) {
    const files = Array.from(input.files);
    if (files.length === 0) return;
    
    const progressDiv = document.getElementById('chunkProgress');
    const progressBar = document.getElementById('chunkProgressBar');
    const progressText = document.getElementById('chunkProgressText');
    
    progressDiv.style.display = 'block';
    progressBar.style.width = '0%';
    progressText.textContent = `Loading 0/${files.length} chunks...`;
    
    let loadedCount = 0;
    let totalTrips = 0;
    
    for (const file of files) {
        try {
            progressText.textContent = `Loading ${file.name}...`;
            
            let text;
            if (file.name.endsWith('.gz')) {
                // Decompress gzip
                const arrayBuffer = await file.arrayBuffer();
                const decompressed = await decompressGzip(arrayBuffer);
                text = new TextDecoder().decode(decompressed);
            } else {
                text = await file.text();
            }
            
            const chunkData = JSON.parse(text);
            
            if (Array.isArray(chunkData)) {
                LOADED_CHUNKS[file.name] = chunkData;
                totalTrips += chunkData.length;
            }
            
            loadedCount++;
            const progress = (loadedCount / files.length) * 100;
            progressBar.style.width = progress + '%';
            progressText.textContent = `Loaded ${loadedCount}/${files.length} chunks (${totalTrips.toLocaleString()} trips)`;
            
        } catch (err) {
            console.error(`Error loading chunk ${file.name}:`, err);
            progressText.textContent = `Error loading ${file.name}: ${err.message}`;
        }
    }
    
    // Merge all chunks into TRIPS
    mergeLoadedChunks();
    
    progressDiv.style.display = 'none';
}

// Decompress gzip data
async function decompressGzip(arrayBuffer) {
    const ds = new DecompressionStream('gzip');
    const blob = new Blob([arrayBuffer]);
    const decompressedStream = blob.stream().pipeThrough(ds);
    const decompressedBlob = await new Response(decompressedStream).blob();
    return await decompressedBlob.arrayBuffer();
}

// Merge all loaded chunks into TRIPS array
function mergeLoadedChunks() {
    const statusDiv = document.getElementById('tripDataStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Merging chunks...</span>';
    
    TRIPS = [];
    
    // Sort chunk names to maintain order
    const chunkNames = Object.keys(LOADED_CHUNKS).sort();
    
    for (const name of chunkNames) {
        TRIPS.push(...LOADED_CHUNKS[name]);
    }
    
    // Extract vehicles and vehicle types
    VEHICLES = [...new Set(TRIPS.map(t => t.plate))].sort();
    
    VEHICLE_TYPES = {};
    TRIPS.forEach(t => {
        if (t.vehicle_type !== undefined || t.Vehicle_type !== undefined) {
            const typeCode = t.vehicle_type || t.Vehicle_type;
            const typeLabel = t.vehicle_type_label || t.Vehicle_type_label || 'Type ' + typeCode;
            VEHICLE_TYPES[typeCode] = typeLabel;
        }
    });
    
    // Update UI
    updateTripsUI(TRIPS.length, VEHICLES.length, `${chunkNames.length} chunks`);
    updateVehicleDropdown();
    
    // Reset batch processing data
    ALL_SEGMENTED_PATHS = {};
    document.getElementById('loadedPathsSection').style.display = 'none';
    document.getElementById('batchStatus').innerHTML = '';
    
    console.log('Merged chunks:', chunkNames.length, 'Total trips:', TRIPS.length);
}

// Show chunk loading status
function showChunkStatus() {
    if (!MANIFEST_DATA) return;
    
    const totalChunks = MANIFEST_DATA.chunks.length;
    const loadedChunks = Object.keys(LOADED_CHUNKS).length;
    
    const progressDiv = document.getElementById('chunkProgress');
    const progressBar = document.getElementById('chunkProgressBar');
    const progressText = document.getElementById('chunkProgressText');
    
    if (loadedChunks < totalChunks) {
        progressDiv.style.display = 'block';
        const progress = (loadedChunks / totalChunks) * 100;
        progressBar.style.width = progress + '%';
        progressText.textContent = `${loadedChunks}/${totalChunks} chunks loaded. Upload remaining chunk files.`;
    } else {
        progressDiv.style.display = 'none';
    }
}

// Process vehicles in batches for large datasets
async function processVehiclesBatch(vehicleList, batchSize = 10) {
    const statusDiv = document.getElementById('batchStatus');
    const total = vehicleList.length;
    let processed = 0;
    
    ALL_SEGMENTED_PATHS = {};
    let totalPaths = 0;
    let totalTrips = 0;
    
    for (let i = 0; i < total; i += batchSize) {
        const batch = vehicleList.slice(i, i + batchSize);
        
        for (const vehicle of batch) {
            const vehicleTrips = TRIPS.filter(t => t.plate === vehicle)
                .sort((a, b) => new Date(a.t_prev) - new Date(b.t_prev));
            
            if (vehicleTrips.length > 0) {
                const segmented = segmentRoute(vehicleTrips);
                
                ALL_SEGMENTED_PATHS[vehicle] = {
                    trips: segmented,
                    pathCount: new Set(segmented.map(t => t.pathId)).size,
                    tripCount: segmented.length,
                    dateRange: {
                        start: vehicleTrips[0].t_prev,
                        end: vehicleTrips[vehicleTrips.length - 1].t_next
                    }
                };
                
                totalPaths += ALL_SEGMENTED_PATHS[vehicle].pathCount;
                totalTrips += segmented.length;
            }
            
            processed++;
        }
        
        // Update progress
        const progress = Math.round((processed / total) * 100);
        statusDiv.innerHTML = `<span style="color:#2196f3;">Processing: ${processed}/${total} vehicles (${progress}%) - ${totalTrips.toLocaleString()} trips, ${totalPaths.toLocaleString()} paths</span>`;
        
        // Yield to UI
        await new Promise(r => setTimeout(r, 0));
    }
    
    statusDiv.innerHTML = `<span style="color:#4caf50;">Processed ${total} vehicles: ${totalTrips.toLocaleString()} trips, ${totalPaths.toLocaleString()} paths</span>`;
    
    updateLoadedVehiclesDropdown();
}

// Upload trips data (Parquet, JSON, or CSV)
async function uploadTripsData(input) {
    const file = input.files[0];
    if (!file) return;
    
    const statusDiv = document.getElementById('tripDataStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Reading file...</span>';
    
    try {
        let trips = [];
        
        if (file.name.endsWith('.parquet')) {
            trips = await readParquetFile(file);
        } else if (file.name.endsWith('.json')) {
            trips = await readJSONTripsFile(file);
        } else if (file.name.endsWith('.csv')) {
            trips = await readCSVTripsFile(file);
        } else {
            throw new Error('Unsupported file format. Use .parquet, .json, or .csv');
        }
        
        if (trips.length === 0) {
            throw new Error('No trips found in file');
        }
        
        // Validate required columns
        const required = ['plate', 'camera_prev', 'camera_next', 't_prev', 't_next', 'obs_time_seconds'];
        const firstTrip = trips[0];
        const missing = required.filter(col => !(col in firstTrip));
        if (missing.length > 0) {
            throw new Error('Missing columns: ' + missing.join(', '));
        }
        
        // Update global TRIPS and VEHICLES
        TRIPS = trips;
        VEHICLES = [...new Set(trips.map(t => t.plate))].sort();
        
        // Extract vehicle types if available
        VEHICLE_TYPES = {};
        trips.forEach(t => {
            if (t.vehicle_type !== undefined || t.Vehicle_type !== undefined) {
                const typeCode = t.vehicle_type || t.Vehicle_type;
                const typeLabel = t.vehicle_type_label || t.Vehicle_type_label || 'Type ' + typeCode;
                VEHICLE_TYPES[typeCode] = typeLabel;
            }
        });
        
        // Update UI
        updateTripsUI(trips.length, VEHICLES.length, file.name);
        updateVehicleDropdown();
        
        // Reset batch processing data
        ALL_SEGMENTED_PATHS = {};
        document.getElementById('loadedPathsSection').style.display = 'none';
        document.getElementById('batchStatus').innerHTML = '';
        
        console.log('Loaded trips:', trips.length, 'Vehicles:', VEHICLES.length);
        
    } catch (err) {
        statusDiv.innerHTML = `<span style="color:#f44336;">Error: ${err.message}</span>`;
        console.error('Error loading trips:', err);
    }
}

// Read Parquet file using parquet-wasm
async function readParquetFile(file) {
    const statusDiv = document.getElementById('tripDataStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Loading parquet library...</span>';
    
    // Try to use parquet-wasm if available
    try {
        // Dynamic import for parquet-wasm
        const parquet = await import('https://cdn.jsdelivr.net/npm/parquet-wasm@0.6.0/esm/parquet_wasm.js');
        await parquet.default();
        
        statusDiv.innerHTML = '<span style="color:#2196f3;">Reading parquet file...</span>';
        
        const arrayBuffer = await file.arrayBuffer();
        const uint8Array = new Uint8Array(arrayBuffer);
        
        // Read parquet file
        const arrowTable = parquet.readParquet(uint8Array);
        
        // Convert Arrow table to JSON
        const trips = [];
        const schema = arrowTable.schema;
        const numRows = arrowTable.numRows;
        
        // Get column names
        const columns = {};
        for (let i = 0; i < schema.fields.length; i++) {
            const field = schema.fields[i];
            columns[field.name] = arrowTable.getChildAt(i);
        }
        
        // Convert to array of objects
        for (let row = 0; row < numRows; row++) {
            const trip = {};
            for (const [name, column] of Object.entries(columns)) {
                let value = column.get(row);
                // Convert BigInt to Number if needed
                if (typeof value === 'bigint') {
                    value = Number(value);
                }
                // Handle plate_numbers -> plate renaming
                if (name === 'plate_numbers') {
                    trip['plate'] = value;
                } else {
                    trip[name] = value;
                }
            }
            
            // Ensure obs_time_seconds exists
            if (!trip.obs_time_seconds && trip.t_prev && trip.t_next) {
                const tPrev = new Date(trip.t_prev);
                const tNext = new Date(trip.t_next);
                trip.obs_time_seconds = (tNext - tPrev) / 1000;
            }
            
            trips.push(trip);
        }
        
        return trips;
        
    } catch (err) {
        console.error('Parquet-wasm failed:', err);
        throw new Error('Could not read parquet file. Try converting to JSON or CSV first. Error: ' + err.message);
    }
}

// Read JSON trips file
async function readJSONTripsFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                let data = JSON.parse(e.target.result);
                
                // Handle different JSON structures
                if (Array.isArray(data)) {
                    resolve(data);
                } else if (data.trips && Array.isArray(data.trips)) {
                    resolve(data.trips);
                } else if (data.data && Array.isArray(data.data)) {
                    resolve(data.data);
                } else {
                    reject(new Error('Invalid JSON structure. Expected array of trips.'));
                }
            } catch (err) {
                reject(new Error('Invalid JSON: ' + err.message));
            }
        };
        reader.onerror = () => reject(new Error('Failed to read file'));
        reader.readAsText(file);
    });
}

// Read CSV trips file
async function readCSVTripsFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const lines = e.target.result.trim().split('\n');
                if (lines.length < 2) {
                    reject(new Error('CSV file is empty or has no data rows'));
                    return;
                }
                
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, '').toLowerCase());
                const trips = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    const trip = {};
                    
                    headers.forEach((h, idx) => {
                        let value = values[idx];
                        
                        // Type conversion
                        if (h === 'obs_time_seconds') {
                            value = parseFloat(value) || 0;
                        }
                        
                        // Handle plate_numbers -> plate
                        if (h === 'plate_numbers') {
                            trip['plate'] = value;
                        } else {
                            trip[h] = value;
                        }
                    });
                    
                    // Calculate obs_time_seconds if missing
                    if (!trip.obs_time_seconds && trip.t_prev && trip.t_next) {
                        const tPrev = new Date(trip.t_prev);
                        const tNext = new Date(trip.t_next);
                        trip.obs_time_seconds = (tNext - tPrev) / 1000;
                    }
                    
                    trips.push(trip);
                }
                
                resolve(trips);
            } catch (err) {
                reject(new Error('Failed to parse CSV: ' + err.message));
            }
        };
        reader.onerror = () => reject(new Error('Failed to read file'));
        reader.readAsText(file);
    });
}

// Parse CSV line handling quoted values
function parseCSVLine(line) {
    const values = [];
    let current = '';
    let inQuotes = false;
    
    for (let i = 0; i < line.length; i++) {
        const char = line[i];
        
        if (char === '"') {
            inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
            values.push(current.trim());
            current = '';
        } else {
            current += char;
        }
    }
    values.push(current.trim());
    
    return values;
}

// Update trips UI
function updateTripsUI(tripCount, vehicleCount, source) {
    const statusDiv = document.getElementById('tripDataStatus');
    
    // Build vehicle type summary
    let vtSummary = '';
    if (Object.keys(VEHICLE_TYPES).length > 0) {
        const vtList = Object.entries(VEHICLE_TYPES).map(([k, v]) => v).join(', ');
        vtSummary = `<div style="font-size:0.65rem;color:#00897b;margin-top:2px;">Types: ${vtList}</div>`;
    }
    
    statusDiv.innerHTML = `<span style="color:#4caf50;">Loaded: ${tripCount} trips, ${vehicleCount} vehicles</span>
        <div style="font-size:0.7rem;color:#666;margin-top:3px;">Source: ${source}</div>${vtSummary}`;
    
    document.getElementById('embeddedTripCount').textContent = tripCount;
    document.getElementById('embeddedVehicleCount').textContent = vehicleCount;
}

// Update vehicle dropdown after loading new trips
function updateVehicleDropdown() {
    const select = document.getElementById('vehicleSel');
    let html = '<option value="">-- Select Vehicle (' + VEHICLES.length + ') --</option>';
    
    VEHICLES.forEach(v => {
        const tripCount = TRIPS.filter(t => t.plate === v).length;
        html += `<option value="${v}">${v} (${tripCount} trips)</option>`;
    });
    
    select.innerHTML = html;
    
    // Update stats
    document.getElementById('statVehicles').textContent = VEHICLES.length;
}

// Upload Google Matrix JSON
function uploadGoogleMatrix(input) {
    const file = input.files[0];
    if (!file) return;
    
    updateExpectedTimesUI('Reading file...', file.name, 0, '#2196f3');
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            // Validate structure
            if (!data.time_min) {
                alert('Invalid file: missing "time_min" field');
                updateExpectedTimesUI('Error - invalid file', file.name, 0, '#f44336');
                return;
            }
            if (!data.sites || !Array.isArray(data.sites)) {
                alert('Invalid file: missing or invalid "sites" array');
                updateExpectedTimesUI('Error - invalid file', file.name, 0, '#f44336');
                return;
            }
            
            processGoogleMatrix(data, file.name + ' (uploaded)');
            alert('Loaded ' + Object.keys(EXPECTED_TIMES).length + ' expected times from ' + file.name);
            
        } catch (err) {
            alert('Error parsing JSON: ' + err.message);
            updateExpectedTimesUI('Error - ' + err.message, file.name, 0, '#f44336');
        }
    };
    reader.readAsText(file);
    input.value = '';
}

// Update Expected Times UI
function updateExpectedTimesUI(status, source, count, color, wpCount = 0) {
    const statusEl = document.getElementById('expectedTimesStatus');
    const sourceEl = document.getElementById('expectedTimesSource');
    const countEl = document.getElementById('expectedTimesCount');
    const wpCountEl = document.getElementById('expectedWaypointsCount');
    
    if (statusEl) {
        statusEl.textContent = status;
        statusEl.style.color = color;
    }
    if (sourceEl) sourceEl.textContent = source;
    if (countEl) countEl.textContent = count.toLocaleString();
    if (wpCountEl) wpCountEl.textContent = wpCount.toLocaleString();
}

// Get expected time between two sites (minutes)
function getExpectedTime(siteA, siteB) {
    if (siteA === siteB) return 0;
    
    const key = siteA + '_' + siteB;
    if (EXPECTED_TIMES[key] !== undefined) {
        return EXPECTED_TIMES[key];
    }
    
    // Fallback: estimate based on distance (avg 40 km/h in city)
    const a = SITES[siteA];
    const b = SITES[siteB];
    if (!a || !b) return null;
    
    const dist = haversineDistance(a.lat, a.lon, b.lat, b.lon);
    return (dist / 40) * 60; // minutes assuming 40 km/h
}

// Haversine distance in km
function haversineDistance(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

// Show vehicle info when selected
function showVehicleInfo() {
    const vehicle = document.getElementById('vehicleSel').value;
    const infoDiv = document.getElementById('vehicleInfo');
    
    if (!vehicle) {
        infoDiv.style.display = 'none';
        return;
    }
    
    // Get all trips for this vehicle
    const vehicleTrips = TRIPS.filter(t => t.plate === vehicle);
    
    if (vehicleTrips.length === 0) {
        infoDiv.style.display = 'block';
        infoDiv.innerHTML = '<span style="color:#f44336;">No trips found for this vehicle</span>';
        return;
    }
    
    // Get unique dates and count trips per date
    const dateMap = {};
    vehicleTrips.forEach(t => {
        const date = t.t_prev.split('T')[0];
        if (!dateMap[date]) {
            dateMap[date] = { count: 0, trips: [] };
        }
        dateMap[date].count++;
        dateMap[date].trips.push(t);
    });
    
    const dates = Object.keys(dateMap).sort();
    const firstDate = dates[0];
    const lastDate = dates[dates.length - 1];
    
    // Build date list with trip counts
    let dateListHtml = '<div style="max-height:100px;overflow-y:auto;margin-top:5px;">';
    dates.forEach(date => {
        const info = dateMap[date];
        const isSelected = date >= document.getElementById('startDate').value && 
                          date <= document.getElementById('endDate').value;
        dateListHtml += `<div style="display:flex;justify-content:space-between;padding:2px 4px;${isSelected ? 'background:#bbdefb;' : ''}">
            <span>${date}</span>
            <span style="color:#1565c0;font-weight:bold;">${info.count} trips</span>
        </div>`;
    });
    dateListHtml += '</div>';
    
    infoDiv.style.display = 'block';
    infoDiv.innerHTML = `
        <div style="margin-bottom:5px;">
            <strong>${vehicle}</strong>: <span style="color:#4caf50;">${vehicleTrips.length} total trips</span>
        </div>
        <div style="margin-bottom:5px;">
            <strong>Date range:</strong> ${firstDate} to ${lastDate}
        </div>
        <div style="font-size:0.7rem;color:#666;">Available dates (click to set):</div>
        ${dateListHtml}
        <div style="margin-top:5px;">
            <button onclick="setDateRange('${firstDate}', '${lastDate}')" style="font-size:0.7rem;padding:3px 8px;cursor:pointer;background:#1565c0;color:#fff;border:none;border-radius:3px;">
                Set Full Range (${firstDate} to ${lastDate})
            </button>
        </div>
    `;
    
    // Make dates clickable
    setTimeout(() => {
        const dateItems = infoDiv.querySelectorAll('div[style*="display:flex"]');
        dateItems.forEach(item => {
            item.style.cursor = 'pointer';
            item.addEventListener('click', () => {
                const date = item.querySelector('span').textContent;
                setDateRange(date, date);
            });
            item.addEventListener('mouseover', () => item.style.background = '#e3f2fd');
            item.addEventListener('mouseout', () => {
                const date = item.querySelector('span').textContent;
                const isSelected = date >= document.getElementById('startDate').value && 
                                  date <= document.getElementById('endDate').value;
                item.style.background = isSelected ? '#bbdefb' : '';
            });
        });
    }, 0);
}

// Set date range from vehicle info
function setDateRange(startDate, endDate) {
    document.getElementById('startDate').value = startDate;
    document.getElementById('endDate').value = endDate;
    showVehicleInfo(); // Refresh to highlight selected dates
}

// ============ ROUTE FILTERING ============
function filterTrips(vehicle, startDate, endDate, startTime, endTime) {
    console.log('Filtering trips:', { vehicle, startDate, endDate, startTime, endTime });
    console.log('Total TRIPS:', TRIPS.length);
    
    const filtered = TRIPS.filter(trip => {
        // Filter by vehicle
        if (vehicle && trip.plate !== vehicle) return false;
        
        // Get trip start and end datetime
        const tripStart = new Date(trip.t_prev);
        const tripEnd = new Date(trip.t_next);
        
        // Filter by date and time range
        if (startDate && endDate) {
            // Build the filter window
            // Window starts at: startDate + startTime (or 00:00 if no startTime)
            // Window ends at: endDate + endTime (or 23:59 if no endTime)
            const filterStart = new Date(startDate + 'T' + (startTime || '00:00') + ':00');
            const filterEnd = new Date(endDate + 'T' + (endTime || '23:59') + ':59');
            
            // Trip must START within the filter window
            if (tripStart < filterStart || tripStart > filterEnd) {
                return false;
            }
            
            // Trip must also END within the filter window
            // This ensures we only see trips that complete within the selected timeframe
            if (tripEnd > filterEnd) {
                return false;
            }
        }
        
        return true;
    });
    
    console.log('Filtered trips:', filtered.length);
    
    // Sort by trip start time
    return filtered.sort((a, b) => new Date(a.t_prev) - new Date(b.t_prev));
}

// ============ PATH SEGMENTATION ============

// Build the corridor (list of site coordinates) from pathStart to destination using Google Matrix waypoints
function buildCorridor(pathStartSite, destSite) {
    const corridor = [];
    
    // Add path start site
    const startData = SITES[pathStartSite];
    if (startData) {
        corridor.push({ siteId: pathStartSite, lat: startData.lat, lon: startData.lon });
    }
    
    // Add waypoints from Google Matrix (if available)
    const routeKey = pathStartSite + '_' + destSite;
    const waypoints = EXPECTED_WAYPOINTS[routeKey] || [];
    
    for (const wpSite of waypoints) {
        const wpData = SITES[wpSite];
        if (wpData) {
            corridor.push({ siteId: wpSite, lat: wpData.lat, lon: wpData.lon });
        }
    }
    
    // Add destination site
    const destData = SITES[destSite];
    if (destData) {
        corridor.push({ siteId: destSite, lat: destData.lat, lon: destData.lon });
    }
    
    return corridor;
}

// Calculate minimum distance from a point to a corridor (polyline of sites) in meters
function distanceToCorridor(lat, lon, corridor) {
    if (!corridor || corridor.length === 0) return Infinity;
    
    let minDist = Infinity;
    
    // Check distance to each segment of the corridor
    for (let i = 0; i < corridor.length - 1; i++) {
        const p1 = corridor[i];
        const p2 = corridor[i + 1];
        
        // Get distance from point to line segment
        const dist = distanceToSegment(lat, lon, p1.lat, p1.lon, p2.lat, p2.lon);
        if (dist < minDist) minDist = dist;
    }
    
    // Also check distance to each waypoint directly
    for (const wp of corridor) {
        const dist = haversineDistance(lat, lon, wp.lat, wp.lon) * 1000; // km to meters
        if (dist < minDist) minDist = dist;
    }
    
    return minDist;
}

// Distance from point to line segment (in meters)
function distanceToSegment(lat, lon, lat1, lon1, lat2, lon2) {
    // Vector from p1 to p2
    const dx = lat2 - lat1;
    const dy = lon2 - lon1;
    
    // If segment is a point
    if (dx === 0 && dy === 0) {
        return haversineDistance(lat, lon, lat1, lon1) * 1000; // Convert to meters
    }
    
    // Calculate projection parameter t
    const t = Math.max(0, Math.min(1, ((lat - lat1) * dx + (lon - lon1) * dy) / (dx * dx + dy * dy)));
    
    // Find closest point on segment
    const closestLat = lat1 + t * dx;
    const closestLon = lon1 + t * dy;
    
    // Return distance in meters
    return haversineDistance(lat, lon, closestLat, closestLon) * 1000;
}

// Check spatial continuity using precomputed Google Matrix waypoints
// Checks if the CURRENT site (camera_next) lies on/near the corridor from pathStart to that site
// NOTE: Intermediate observed sites (camera_prev) are NOT checked - only the current destination matters
function checkSpatialContinuity(pathStartSite, currentSite, epsilonMeters) {
    // If current site = path start, always OK (path just started)
    if (pathStartSite === currentSite) {
        return { spatialOk: true, distanceToRoute: 0, corridorSites: [pathStartSite], reason: 'Same as path start' };
    }
    
    // Get site coordinates
    const startData = SITES[pathStartSite];
    const currentData = SITES[currentSite];
    
    if (!startData || !currentData) {
        return { 
            spatialOk: false, 
            distanceToRoute: null, 
            corridorSites: [], 
            reason: 'Site coordinates not found' 
        };
    }
    
    // Build the expected corridor from pathStart to currentSite
    const corridor = buildCorridor(pathStartSite, currentSite);
    
    // Check if corridor exists in the matrix
    const routeKey = pathStartSite + '_' + currentSite;
    const hasMatrixEntry = EXPECTED_TIMES[routeKey] !== undefined;
    
    if (corridor.length < 2) {
        // Can't build corridor - no matrix data
        // Fall back to direct distance check
        const directDist = haversineDistance(startData.lat, startData.lon, currentData.lat, currentData.lon) * 1000;
        return { 
            spatialOk: false, 
            distanceToRoute: directDist, 
            corridorSites: [pathStartSite, currentSite], 
            reason: 'No route in matrix from ' + pathStartSite + ' to ' + currentSite
        };
    }
    
    // Corridor exists - current site is reachable from path start via Google routes
    // The current site IS the destination of the corridor, so it's on the corridor by definition
    // But we verify the corridor endpoint matches the current site location
    const corridorEnd = corridor[corridor.length - 1];
    const distToCorridorEnd = haversineDistance(currentData.lat, currentData.lon, corridorEnd.lat, corridorEnd.lon) * 1000;
    
    if (distToCorridorEnd <= epsilonMeters) {
        return { 
            spatialOk: true, 
            distanceToRoute: distToCorridorEnd, 
            corridorSites: corridor.map(c => c.siteId), 
            reason: hasMatrixEntry 
                ? 'Route exists in matrix (' + corridor.length + ' sites in corridor)'
                : 'Direct route (no waypoints)'
        };
    } else {
        // This shouldn't normally happen unless there's coordinate mismatch
        return {
            spatialOk: false,
            distanceToRoute: distToCorridorEnd,
            corridorSites: corridor.map(c => c.siteId),
            reason: 'Coordinate mismatch: site ' + Math.round(distToCorridorEnd) + 'm from corridor endpoint'
        };
    }
}

// Segmentation using precomputed Google Matrix data (no API calls)
function segmentRoute(trips) {
    const rMin = parseFloat(document.getElementById('rMin').value) || 0.5;
    const defaultRMax = parseFloat(document.getElementById('rMax').value) || 2.0;
    const epsilonMeters = parseFloat(document.getElementById('epsilonMeters').value) || 500;
    
    let pathId = 1;
    let pathStartTime = null;
    let pathStartSite = null;
    
    const segmented = [];
    
    for (let idx = 0; idx < trips.length; idx++) {
        const trip = trips[idx];
        const obsTimeMin = trip.obs_time_seconds / 60;
        const expectedTime = getExpectedTime(trip.camera_prev, trip.camera_next);
        
        // Get dynamic r_max for this specific route, day, and vehicle type
        const vehicleType = trip.vehicle_type || trip.Vehicle_type;
        const rMax = getRmax(trip.camera_prev, trip.camera_next, trip.t_prev, vehicleType);
        
        // Calculate ratio R
        let R = null;
        let R_method = null; // Track how R was calculated
        let temporalOk = true;
        let spatialOk = true;
        let spatialDistance = null;
        let spatialCorridor = [];
        let spatialReason = '';
        let status = 'normal';
        let breakReason = null;
        let usedRmax = rMax; // Track which r_max was used
        
        // Handle self-routes (same site) specially
        const isSelfRoute = trip.camera_prev === trip.camera_next;
        
        if (idx === 0) {
            // First trip starts a new path
            pathStartTime = new Date(trip.t_prev);
            pathStartSite = trip.camera_prev;
            
            // Calculate R for first trip
            if (isSelfRoute) {
                // Self-route: expected time is 0
                // If observed time is also 0 (or very small), R = 1
                // Otherwise, R = infinity (treat as very large)
                if (obsTimeMin <= 1) { // Less than 1 minute
                    R = 1;
                    R_method = 'self';
                    temporalOk = true;
                } else {
                    R = obsTimeMin; // Use observed time as R (since expected is 0)
                    R_method = 'self';
                    temporalOk = (obsTimeMin <= 5); // Only OK if under 5 minutes
                }
            } else if (expectedTime && expectedTime > 0) {
                R = obsTimeMin / expectedTime;
                R_method = 'hop';
                temporalOk = (R >= rMin && R <= rMax);
            }
        } else {
            // TEMPORAL CHECK
            // R = (t_current - t_path_start) / expected_time(path_start  current_site)
            const currentTime = new Date(trip.t_next);
            const elapsedMin = (currentTime - pathStartTime) / 60000;
            const expectedFromStart = getExpectedTime(pathStartSite, trip.camera_next);
            
            if (isSelfRoute) {
                // Self-route (same site): expected time is 0
                if (obsTimeMin <= 1) { // Less than 1 minute
                    R = 1;
                    R_method = 'self';
                    temporalOk = true;
                } else {
                    R = obsTimeMin; // Use observed time as pseudo-R
                    R_method = 'self';
                    temporalOk = (obsTimeMin <= 5); // Only OK if under 5 minutes
                }
            } else if (expectedFromStart !== undefined && expectedFromStart !== null && expectedFromStart > 0) {
                // Use path-based R (from path start to current site)
                R = elapsedMin / expectedFromStart;
                R_method = 'path';
                temporalOk = (R >= rMin && R <= rMax);
            } else if (expectedTime !== undefined && expectedTime !== null && expectedTime > 0) {
                // Fallback to hop-by-hop if no matrix entry for full path
                R = obsTimeMin / expectedTime;
                R_method = 'hop';
                temporalOk = (R >= rMin && R <= rMax);
            } else {
                // No expected time available - cannot calculate R
                // Use distance-based fallback estimate
                const prevSite = SITES[trip.camera_prev];
                const nextSite = SITES[trip.camera_next];
                if (prevSite && nextSite) {
                    const dist = haversineDistance(prevSite.lat, prevSite.lon, nextSite.lat, nextSite.lon);
                    const estimatedMin = (dist / 40) * 60; // 40 km/h average
                    if (estimatedMin > 0) {
                        R = obsTimeMin / estimatedMin;
                        R_method = 'dist-est';
                        temporalOk = (R >= rMin && R <= rMax);
                    }
                }
            }
            
            // SPATIAL CHECK using Google Matrix waypoints
            // Check if CURRENT site (camera_next) is reachable from pathStartSite via plausible road corridor
            // NOTE: We do NOT check camera_prev - intermediate sites are irrelevant to spatial continuity
            const spatialResult = checkSpatialContinuity(pathStartSite, trip.camera_next, epsilonMeters);
            spatialOk = spatialResult.spatialOk;
            spatialDistance = spatialResult.distanceToRoute;
            spatialCorridor = spatialResult.corridorSites || [];
            spatialReason = spatialResult.reason || '';
            
            // Build break reason
            if (!spatialOk && !temporalOk) {
                breakReason = 'BOTH FAILED - Temporal: R=' + (R ? R.toFixed(2) : 'N/A') + 
                              ' (' + (R_method || 'no-calc') + ') outside [' + rMin + ',' + rMax + '] | Spatial: ' + spatialReason;
            } else if (!spatialOk) {
                breakReason = 'SPATIAL FAIL - Site ' + trip.camera_next + ' not reachable from path start ' + pathStartSite + 
                              ' | ' + spatialReason;
            } else if (!temporalOk) {
                breakReason = 'TEMPORAL FAIL - R=' + (R ? R.toFixed(2) : 'N/A') + 
                              ' (' + (R_method || 'no-calc') + ') outside [' + rMin + ',' + rMax + ']';
            }
        }
        
        // Determine status - BOTH must be true to continue path
        if (!temporalOk || !spatialOk) {
            status = 'break';
            pathId++;
            // New path starts at camera_next (where vehicle is after this trip)
            pathStartTime = new Date(trip.t_next);
            pathStartSite = trip.camera_next;
        } else if (R !== null && R > rMax * 0.8) {
            status = 'slow';
        }
        
        // Store the pathStartSite that was used for this trip's spatial check
        const tripPathStart = idx === 0 ? trip.camera_prev : (segmented.length > 0 ? segmented[segmented.length - 1].pathStartSite : trip.camera_prev);
        
        segmented.push({
            ...trip,
            pathId,
            pathStartSite: status === 'break' ? trip.camera_next : (idx === 0 ? trip.camera_prev : tripPathStart),
            corridorStart: idx === 0 ? trip.camera_prev : tripPathStart,  // The start site used for spatial check
            R,
            R_method,  // 'path', 'hop', 'dist-est', or 'self'
            usedRmax: rMax,  // The r_max used for this trip (dynamic or default)
            temporalOk,
            spatialOk,
            spatialDistance,
            spatialCorridor,
            expectedTimeMin: expectedTime,
            obsTimeMin,
            status,
            breakReason
        });
    }
    
    return segmented;
}

// ============ VISUALIZATION ============
function clearMap() {
    markers.forEach(m => m.setMap(null));
    polylines.forEach(p => p.setMap(null));
    markers = [];
    polylines = [];
    clearCorridor();
}

// Get road-snapped route between two points
async function getSnappedRoute(origin, destination) {
    return new Promise((resolve) => {
        if (!directionsService) {
            resolve(null);
            return;
        }
        
        directionsService.route({
            origin: origin,
            destination: destination,
            travelMode: google.maps.TravelMode.DRIVING
        }, (result, status) => {
            if (status === 'OK' && result.routes[0]) {
                resolve(result.routes[0].overview_path);
            } else {
                resolve(null);
            }
        });
    });
}

// Add origin and destination markers for each path
function addPathMarkers(trips) {
    if (trips.length === 0) return;
    
    // Group trips by pathId
    const pathGroups = {};
    trips.forEach(trip => {
        if (!pathGroups[trip.pathId]) {
            pathGroups[trip.pathId] = [];
        }
        pathGroups[trip.pathId].push(trip);
    });
    
    // Color palette for different paths
    const pathColors = [
        '#1565C0', '#2E7D32', '#6A1B9A', '#C62828', '#EF6C00', 
        '#00838F', '#AD1457', '#4527A0', '#283593', '#00695C'
    ];
    
    Object.keys(pathGroups).forEach((pathId, pathIndex) => {
        const pathTrips = pathGroups[pathId];
        if (pathTrips.length === 0) return;
        
        const color = pathColors[pathIndex % pathColors.length];
        
        // Origin: first trip's camera_prev
        const firstTrip = pathTrips[0];
        const originSite = SITES[firstTrip.camera_prev];
        
        // Destination: last trip's camera_next
        const lastTrip = pathTrips[pathTrips.length - 1];
        const destSite = SITES[lastTrip.camera_next];
        
        // Add ORIGIN marker (flag pointing right)
        if (originSite) {
            const originMarker = new google.maps.Marker({
                position: { lat: originSite.lat, lng: originSite.lon },
                map: map,
                icon: {
                    path: 'M 0,0 L 0,-20 L 15,-15 L 0,-10 Z',  // Flag shape
                    fillColor: color,
                    fillOpacity: 1,
                    strokeColor: '#FFFFFF',
                    strokeWeight: 2,
                    scale: 1.2,
                    anchor: new google.maps.Point(0, 0)
                },
                title: `Path ${pathId} ORIGIN: ${firstTrip.camera_prev}\nStart time: ${new Date(firstTrip.t_prev).toLocaleString()}`,
                zIndex: 200,
                label: {
                    text: 'O' + pathId,
                    color: '#FFFFFF',
                    fontWeight: 'bold',
                    fontSize: '10px'
                }
            });
            markers.push(originMarker);
        }
        
        // Add DESTINATION marker (square/diamond)
        if (destSite) {
            const destMarker = new google.maps.Marker({
                position: { lat: destSite.lat, lng: destSite.lon },
                map: map,
                icon: {
                    path: 'M -8,-8 L 8,-8 L 8,8 L -8,8 Z',  // Square shape
                    fillColor: color,
                    fillOpacity: 1,
                    strokeColor: '#FFFFFF',
                    strokeWeight: 2,
                    scale: 1,
                    anchor: new google.maps.Point(0, 0)
                },
                title: `Path ${pathId} DESTINATION: ${lastTrip.camera_next}\nEnd time: ${new Date(lastTrip.t_next).toLocaleString()}`,
                zIndex: 200,
                label: {
                    text: 'D' + pathId,
                    color: '#FFFFFF',
                    fontWeight: 'bold',
                    fontSize: '10px'
                }
            });
            markers.push(destMarker);
        }
    });
}

async function visualizeRoute(trips) {
    clearMap();
    
    if (trips.length === 0) return;
    
    const bounds = new google.maps.LatLngBounds();
    const colorMap = { normal: '#34a853', slow: '#fbbc05', break: '#ea4335' };
    
    // Build site status map - track which sites have issues
    const siteStatus = {}; // siteId -> { temporal: bool, spatial: bool, breakReason: string }
    
    trips.forEach(trip => {
        // Initialize sites
        if (!siteStatus[trip.camera_prev]) {
            siteStatus[trip.camera_prev] = { temporal: true, spatial: true, reasons: [] };
        }
        if (!siteStatus[trip.camera_next]) {
            siteStatus[trip.camera_next] = { temporal: true, spatial: true, reasons: [] };
        }
        
        // Flag the destination site if there was a break
        if (trip.status === 'break') {
            if (!trip.temporalOk) {
                siteStatus[trip.camera_next].temporal = false;
                siteStatus[trip.camera_next].reasons.push('[TEMPORAL] R=' + (trip.R ? trip.R.toFixed(2) : 'N/A'));
            }
            if (!trip.spatialOk) {
                siteStatus[trip.camera_next].spatial = false;
                siteStatus[trip.camera_next].reasons.push('[SPATIAL] too far');
            }
        }
        // Flag slow sites too
        if (trip.status === 'slow') {
            siteStatus[trip.camera_next].reasons.push('[SLOW] R=' + (trip.R ? trip.R.toFixed(2) : 'N/A'));
        }
    });
    
    // Add site markers with status colors
    const visitedSites = new Set();
    trips.forEach(trip => {
        visitedSites.add(trip.camera_prev);
        visitedSites.add(trip.camera_next);
    });
    
    visitedSites.forEach(siteId => {
        const site = SITES[siteId];
        if (!site) return;
        
        const status = siteStatus[siteId] || { temporal: true, spatial: true, reasons: [] };
        
        // Determine marker color based on status
        let fillColor = '#4285f4'; // Blue = normal
        let strokeColor = '#fff';
        let scale = 8;
        let zIndex = 1;
        
        if (!status.temporal && !status.spatial) {
            fillColor = '#ea4335'; // Red = both failed
            strokeColor = '#b71c1c';
            scale = 12;
            zIndex = 100;
        } else if (!status.temporal) {
            fillColor = '#ff9800'; // Orange = temporal failed
            strokeColor = '#e65100';
            scale = 11;
            zIndex = 90;
        } else if (!status.spatial) {
            fillColor = '#9c27b0'; // Purple = spatial failed
            strokeColor = '#6a1b9a';
            scale = 11;
            zIndex = 90;
        } else if (status.reasons.length > 0 && status.reasons.some(r => r.includes('Slow'))) {
            fillColor = '#fbbc05'; // Yellow = slow
            strokeColor = '#f57f17';
            scale = 9;
            zIndex = 50;
        }
        
        // Build tooltip
        let title = siteId + ' (' + site.dir + ')';
        if (status.reasons.length > 0) {
            title += '\n' + status.reasons.join('\n');
        }
        
        const marker = new google.maps.Marker({
            position: { lat: site.lat, lng: site.lon },
            map: map,
            title: title,
            zIndex: zIndex,
            icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: scale,
                fillColor: fillColor,
                fillOpacity: 1,
                strokeColor: strokeColor,
                strokeWeight: 2
            }
        });
        
        // Add click listener to show site info
        marker.addListener('click', () => showSiteInfo(siteId, status));
        
        markers.push(marker);
        bounds.extend(marker.getPosition());
    });
    
    // Add path origin/destination markers
    addPathMarkers(trips);
    
    // Show loading message
    document.getElementById('tripList').innerHTML = '<div class="loading">Loading road-snapped routes...</div>';
    
    // Add trip lines with road snapping
    const uniqueTrips = trips.filter((trip, idx) => {
        if (trip.camera_prev === trip.camera_next) return false;
        const prevSite = SITES[trip.camera_prev];
        const nextSite = SITES[trip.camera_next];
        return prevSite && nextSite;
    });
    
    // Process trips - snap to roads
    for (let i = 0; i < uniqueTrips.length; i++) {
        const trip = uniqueTrips[i];
        const tripIdx = trips.indexOf(trip);
        const prevSite = SITES[trip.camera_prev];
        const nextSite = SITES[trip.camera_next];
        
        const origin = { lat: prevSite.lat, lng: prevSite.lon };
        const destination = { lat: nextSite.lat, lng: nextSite.lon };
        
        // Try to get snapped route
        const snappedPath = await getSnappedRoute(origin, destination);
        
        let path;
        if (snappedPath && snappedPath.length > 0) {
            // Use snapped road path
            path = snappedPath;
        } else {
            // Fallback to straight line
            path = [origin, destination];
        }
        
        const line = new google.maps.Polyline({
            path: path,
            geodesic: true,
            strokeColor: colorMap[trip.status] || colorMap.normal,
            strokeOpacity: 0.85,
            strokeWeight: trip.status === 'break' ? 5 : 4,
            map: map
        });
        
        // Add click listener
        line.addListener('click', () => selectTrip(tripIdx));
        polylines.push(line);
        
        // Small delay to avoid rate limiting
        if (i < uniqueTrips.length - 1) {
            await new Promise(r => setTimeout(r, 100));
        }
    }
    
    map.fitBounds(bounds, 50);
    
    // Update trip list after routes are loaded
    renderTripList(trips);
}

// ============ UI UPDATES ============
function updateStats(trips) {
    document.getElementById('statTrips').textContent = trips.length;
    
    const paths = new Set(trips.map(t => t.pathId));
    document.getElementById('statPaths').textContent = paths.size;
    
    const slow = trips.filter(t => t.status === 'slow').length;
    document.getElementById('statSlow').textContent = slow;
    
    const breaks = trips.filter(t => t.status === 'break').length;
    document.getElementById('statBreaks').textContent = breaks;
    
    // Breakdown of breaks
    const temporalBreaks = trips.filter(t => t.status === 'break' && !t.temporalOk).length;
    const spatialBreaks = trips.filter(t => t.status === 'break' && !t.spatialOk).length;
    const bothBreaks = trips.filter(t => t.status === 'break' && !t.temporalOk && !t.spatialOk).length;
    
    document.getElementById('statBreakdown').innerHTML = 
        `<span style="color:#ff9800;" title="Temporal failures">[T]${temporalBreaks}</span> ` +
        `<span style="color:#9c27b0;" title="Spatial failures">[S]${spatialBreaks}</span> ` +
        `<span style="color:#c62828;" title="Both failed">[Both]${bothBreaks}</span>`;
    
    // Populate path filter dropdown
    updatePathFilter(trips);
}

// Update the path filter dropdown with available paths
function updatePathFilter(trips) {
    const pathFilter = document.getElementById('pathFilter');
    const currentValue = pathFilter.value;
    
    // Get unique paths with their info
    const pathInfo = {};
    trips.forEach(trip => {
        if (!pathInfo[trip.pathId]) {
            pathInfo[trip.pathId] = {
                id: trip.pathId,
                tripCount: 0,
                startSite: trip.camera_prev,
                endSite: trip.camera_next,
                startTime: trip.t_prev
            };
        }
        pathInfo[trip.pathId].tripCount++;
        pathInfo[trip.pathId].endSite = trip.camera_next;
    });
    
    // Build options
    let html = '<option value="all">All Paths (' + Object.keys(pathInfo).length + ')</option>';
    
    Object.keys(pathInfo).sort((a, b) => parseInt(a) - parseInt(b)).forEach(pathId => {
        const info = pathInfo[pathId];
        const time = new Date(info.startTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        html += `<option value="${pathId}">Path ${pathId}: ${info.startSite}  ${info.endSite} (${info.tripCount} trips, ${time})</option>`;
    });
    
    pathFilter.innerHTML = html;
    
    // Restore selection if still valid
    if (currentValue && pathInfo[currentValue]) {
        pathFilter.value = currentValue;
    }
}

// Filter visualization by selected path
async function filterByPath() {
    const pathFilter = document.getElementById('pathFilter');
    const selectedPath = pathFilter.value;
    
    if (!currentRoute || currentRoute.length === 0) {
        alert('Please load a route first');
        return;
    }
    
    if (selectedPath === 'all') {
        // Show all trips
        await visualizeRoute(currentRoute);
    } else {
        // Filter to selected path only
        const pathTrips = currentRoute.filter(t => t.pathId === parseInt(selectedPath));
        
        if (pathTrips.length === 0) {
            alert('No trips found for Path ' + selectedPath);
            return;
        }
        
        // Visualize only this path
        await visualizeSinglePath(pathTrips, parseInt(selectedPath));
    }
}

// Visualize a single path with enhanced detail
async function visualizeSinglePath(trips, pathId) {
    clearMap();
    
    if (trips.length === 0) return;
    
    const bounds = new google.maps.LatLngBounds();
    const colorMap = { normal: '#34a853', slow: '#fbbc05', break: '#ea4335' };
    
    // Get path color
    const pathColors = [
        '#1565C0', '#2E7D32', '#6A1B9A', '#C62828', '#EF6C00', 
        '#00838F', '#AD1457', '#4527A0', '#283593', '#00695C'
    ];
    const pathColor = pathColors[(pathId - 1) % pathColors.length];
    
    // Collect all sites in this path
    const pathSites = new Set();
    trips.forEach(trip => {
        pathSites.add(trip.camera_prev);
        pathSites.add(trip.camera_next);
    });
    
    // Add site markers
    pathSites.forEach(siteId => {
        const site = SITES[siteId];
        if (!site) return;
        
        const marker = new google.maps.Marker({
            position: { lat: site.lat, lng: site.lon },
            map: map,
            title: siteId + ' (' + site.dir + ')',
            icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 10,
                fillColor: '#4285f4',
                fillOpacity: 1,
                strokeColor: '#fff',
                strokeWeight: 2
            },
            zIndex: 10
        });
        
        marker.addListener('click', () => showSiteInfo(siteId, { temporal: true, spatial: true, reasons: [] }));
        markers.push(marker);
        bounds.extend(marker.getPosition());
    });
    
    // Add ORIGIN marker
    const firstTrip = trips[0];
    const originSite = SITES[firstTrip.camera_prev];
    if (originSite) {
        const originMarker = new google.maps.Marker({
            position: { lat: originSite.lat, lng: originSite.lon },
            map: map,
            icon: {
                path: 'M 0,0 L 0,-25 L 20,-18 L 0,-11 Z',
                fillColor: pathColor,
                fillOpacity: 1,
                strokeColor: '#FFFFFF',
                strokeWeight: 2,
                scale: 1.5,
                anchor: new google.maps.Point(0, 0)
            },
            title: `PATH ${pathId} ORIGIN\nSite: ${firstTrip.camera_prev}\nStart: ${new Date(firstTrip.t_prev).toLocaleString()}`,
            zIndex: 300,
            label: {
                text: 'O' + pathId,
                color: '#FFFFFF',
                fontWeight: 'bold',
                fontSize: '11px'
            }
        });
        markers.push(originMarker);
    }
    
    // Add DESTINATION marker
    const lastTrip = trips[trips.length - 1];
    const destSite = SITES[lastTrip.camera_next];
    if (destSite) {
        const destMarker = new google.maps.Marker({
            position: { lat: destSite.lat, lng: destSite.lon },
            map: map,
            icon: {
                path: 'M -10,-10 L 10,-10 L 10,10 L -10,10 Z',
                fillColor: pathColor,
                fillOpacity: 1,
                strokeColor: '#FFFFFF',
                strokeWeight: 2,
                scale: 1.2,
                anchor: new google.maps.Point(0, 0)
            },
            title: `PATH ${pathId} DESTINATION\nSite: ${lastTrip.camera_next}\nEnd: ${new Date(lastTrip.t_next).toLocaleString()}`,
            zIndex: 300,
            label: {
                text: 'D' + pathId,
                color: '#FFFFFF',
                fontWeight: 'bold',
                fontSize: '11px'
            }
        });
        markers.push(destMarker);
    }
    
    // Show loading message
    document.getElementById('tripList').innerHTML = '<div class="loading">Loading Path ' + pathId + ' routes...</div>';
    
    // Add trip lines with road snapping
    for (let i = 0; i < trips.length; i++) {
        const trip = trips[i];
        const tripIdx = currentRoute.indexOf(trip);
        const prevSite = SITES[trip.camera_prev];
        const nextSite = SITES[trip.camera_next];
        
        if (!prevSite || !nextSite || trip.camera_prev === trip.camera_next) continue;
        
        const origin = { lat: prevSite.lat, lng: prevSite.lon };
        const destination = { lat: nextSite.lat, lng: nextSite.lon };
        
        // Try to get snapped route
        const snappedPath = await getSnappedRoute(origin, destination);
        
        let path;
        if (snappedPath && snappedPath.length > 0) {
            path = snappedPath;
        } else {
            path = [origin, destination];
        }
        
        const line = new google.maps.Polyline({
            path: path,
            geodesic: true,
            strokeColor: colorMap[trip.status] || colorMap.normal,
            strokeOpacity: 0.9,
            strokeWeight: 6,
            map: map,
            zIndex: 50
        });
        
        // Add click listener
        line.addListener('click', () => selectTrip(tripIdx));
        polylines.push(line);
        
        // Add trip number label at midpoint
        const midIdx = Math.floor(path.length / 2);
        const midPoint = path[midIdx];
        const tripLabel = new google.maps.Marker({
            position: midPoint,
            map: map,
            icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 12,
                fillColor: colorMap[trip.status] || colorMap.normal,
                fillOpacity: 1,
                strokeColor: '#fff',
                strokeWeight: 2
            },
            label: {
                text: String(i + 1),
                color: '#fff',
                fontWeight: 'bold',
                fontSize: '10px'
            },
            title: `Trip ${i + 1}: ${trip.camera_prev}  ${trip.camera_next}\nTime: ${formatTime(trip.obs_time_seconds)}`,
            zIndex: 100
        });
        tripLabel.addListener('click', () => selectTrip(tripIdx));
        markers.push(tripLabel);
        
        // Small delay to avoid rate limiting
        if (i < trips.length - 1) {
            await new Promise(r => setTimeout(r, 100));
        }
    }
    
    // Draw the corridor for the entire path (from origin to final destination)
    drawPathCorridor(trips, pathId, pathColor);
    
    map.fitBounds(bounds, 50);
    
    // Update trip list to show only this path's trips
    renderTripList(trips);
}

// Draw corridor for entire path from matrix
function drawPathCorridor(trips, pathId, pathColor) {
    if (trips.length === 0) return;
    
    // Get origin and final destination
    const originSite = trips[0].camera_prev;
    const destSite = trips[trips.length - 1].camera_next;
    
    // Build corridor from matrix
    const corridor = buildCorridor(originSite, destSite);
    
    if (corridor.length < 2) return;
    
    // Build path
    const corridorPath = corridor.map(c => ({ lat: c.lat, lng: c.lon }));
    
    // Draw as dashed line
    corridorPolyline = new google.maps.Polyline({
        path: corridorPath,
        geodesic: true,
        strokeColor: pathColor,
        strokeOpacity: 0.5,
        strokeWeight: 8,
        icons: [{
            icon: {
                path: 'M 0,-1 0,1',
                strokeOpacity: 0.7,
                strokeWeight: 8,
                scale: 2
            },
            offset: '0',
            repeat: '20px'
        }],
        map: map,
        zIndex: 1
    });
    
    // Add corridor waypoint markers
    corridor.forEach((wp, idx) => {
        if (idx === 0 || idx === corridor.length - 1) return; // Skip origin/dest
        
        const wpMarker = new google.maps.Marker({
            position: { lat: wp.lat, lng: wp.lon },
            map: map,
            icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 7,
                fillColor: pathColor,
                fillOpacity: 0.6,
                strokeColor: '#fff',
                strokeWeight: 2
            },
            title: `Expected waypoint: ${wp.siteId}`,
            zIndex: 5
        });
        corridorMarkers.push(wpMarker);
    });
}

function renderTripList(trips) {
    const list = document.getElementById('tripList');
    
    if (trips.length === 0) {
        list.innerHTML = '<div class="no-data">No trips found for selection</div>';
        return;
    }
    
    let html = '';
    trips.forEach((trip, idx) => {
        const time = new Date(trip.t_prev).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        const statusClass = trip.status;
        
        // Check for expected waypoints
        const routeKey = trip.camera_prev + '_' + trip.camera_next;
        const expectedWaypoints = EXPECTED_WAYPOINTS[routeKey] || [];
        const expectedDist = EXPECTED_DISTANCES[routeKey];
        
        // Determine flag icons
        let flags = '';
        if (trip.status === 'break') {
            if (!trip.temporalOk) flags += '<span style="color:#ff9800;margin-left:5px;font-weight:bold;" title="Temporal failed">[T]</span>';
            if (!trip.spatialOk) flags += '<span style="color:#9c27b0;margin-left:5px;font-weight:bold;" title="Spatial failed">[S]</span>';
        } else if (trip.status === 'slow') {
            flags += '<span style="color:#fbbc05;margin-left:5px;font-weight:bold;" title="Slow">[SLOW]</span>';
        }
        
        // Waypoint indicator
        const wpIndicator = expectedWaypoints.length > 0 
            ? `<span style="color:#1565c0;font-size:0.7rem;margin-left:5px;" title="Has ${expectedWaypoints.length} waypoint(s)">[${expectedWaypoints.length}WP]</span>` 
            : '';
        
        // Vehicle type indicator
        const vType = trip.vehicle_type_label || trip.Vehicle_type_label || (trip.vehicle_type !== undefined ? VEHICLE_TYPES[trip.vehicle_type] || trip.vehicle_type : '');
        const vTypeIndicator = vType ? `<span style="color:#00897b;font-size:0.65rem;margin-left:3px;">[${vType}]</span>` : '';
        
        html += `
            <div class="trip-item ${statusClass}" data-idx="${idx}" onclick="selectTrip(${idx})">
                <div class="trip-header">
                    <span class="trip-route">${trip.camera_prev}  ${trip.camera_next}${flags}${wpIndicator}${vTypeIndicator}</span>
                    <span class="path-badge">Path ${trip.pathId}</span>
                </div>
                <div class="trip-time">${time}</div>
                <div class="trip-meta">
                    <span>Obs: ${formatTime(trip.obs_time_seconds)}</span>
                    <span>Exp: ${trip.expectedTimeMin !== undefined && trip.expectedTimeMin !== null ? formatTime(trip.expectedTimeMin * 60) : '<span style="color:#f44336;">N/A</span>'}</span>
                    ${trip.R !== null ? `<span>R: ${trip.R.toFixed(2)}${trip.usedRmax ? '/<span style="font-size:0.65rem;color:#9c27b0;">' + trip.usedRmax.toFixed(1) + '</span>' : ''} <span style="font-size:0.6rem;color:#999;">${trip.R_method || ''}</span></span>` : '<span style="color:#f44336;">R: N/A</span>'}
                    ${expectedDist ? `<span>${expectedDist.toFixed(1)}km</span>` : ''}
                </div>
                ${trip.breakReason ? `<div class="break-reason">${trip.breakReason}</div>` : ''}
            </div>
        `;
    });
    
    list.innerHTML = html;
    
    // Also render the timeline
    renderTimeline(trips);
}

// Render the path timeline showing journey with timestamps and break reasons
function renderTimeline(trips) {
    const container = document.getElementById('pathTimeline');
    
    if (!trips || trips.length === 0) {
        container.innerHTML = '<div class="no-data">No trips to display</div>';
        return;
    }
    
    let html = '<div class="timeline">';
    
    let currentPathId = null;
    
    trips.forEach((trip, idx) => {
        const isNewPath = trip.pathId !== currentPathId;
        const isLastTrip = idx === trips.length - 1;
        const prevTrip = idx > 0 ? trips[idx - 1] : null;
        
        // Start of new path
        if (isNewPath) {
            currentPathId = trip.pathId;
            const pathStartTime = new Date(trip.t_prev).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            html += `
                <div class="timeline-item path-start">
                    <div>
                        <span class="timeline-site">${trip.camera_prev}</span>
                        <span class="timeline-path-label">PATH ${trip.pathId} START</span>
                    </div>
                    <div class="timeline-time">${pathStartTime}</div>
                </div>
            `;
        }
        
        // The trip itself (arrival at camera_next)
        const arrivalTime = new Date(trip.t_next).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        const duration = formatTime(trip.obs_time_seconds);
        const itemClass = trip.status === 'break' ? 'break' : trip.status === 'slow' ? 'slow' : '';
        
        // Check for waypoints
        const routeKey = trip.camera_prev + '_' + trip.camera_next;
        const waypoints = EXPECTED_WAYPOINTS[routeKey] || [];
        const waypointInfo = waypoints.length > 0 ? ` via ${waypoints.length} waypoint(s)` : '';
        
        html += `
            <div class="timeline-item ${itemClass}">
                <div>
                    <span class="timeline-site">${trip.camera_next}</span>
                    ${trip.status === 'break' ? '<span style="color:#ea4335;font-size:0.65rem;margin-left:5px;">[BREAK]</span>' : ''}
                    ${trip.status === 'slow' ? '<span style="color:#fbbc05;font-size:0.65rem;margin-left:5px;">[SLOW]</span>' : ''}
                </div>
                <div class="timeline-time">${arrivalTime}</div>
                <div class="timeline-info">
                    from ${trip.camera_prev} | ${duration}${waypointInfo}
                    ${trip.R !== null ? ' | R=' + trip.R.toFixed(2) + (trip.R_method ? ' <span style="color:#999;">(' + trip.R_method + ')</span>' : '') : ' | <span style="color:#f44336;">R: N/A</span>'}
                </div>
                ${trip.breakReason ? `<div class="timeline-break">${trip.breakReason}</div>` : ''}
            </div>
        `;
        
        // If this is the last trip OR next trip starts a new path, mark path end
        const nextTrip = idx < trips.length - 1 ? trips[idx + 1] : null;
        if (isLastTrip || (nextTrip && nextTrip.pathId !== trip.pathId)) {
            // Path ends here (but only add if not already showing break)
            if (trip.status !== 'break') {
                html += `
                    <div class="timeline-item path-end" style="padding-bottom:15px;">
                        <div class="timeline-info" style="color:#1565C0;">
                            Path ${trip.pathId} ends at ${trip.camera_next}
                        </div>
                    </div>
                `;
            }
        }
    });
    
    html += '</div>';
    
    // Add summary at top
    const pathCount = new Set(trips.map(t => t.pathId)).size;
    const breakCount = trips.filter(t => t.status === 'break').length;
    const totalDuration = trips.reduce((sum, t) => sum + t.obs_time_seconds, 0);
    const startTime = new Date(trips[0].t_prev).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    const endTime = new Date(trips[trips.length - 1].t_next).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    
    // Count R calculation methods
    const rPathCount = trips.filter(t => t.R_method === 'path').length;
    const rHopCount = trips.filter(t => t.R_method === 'hop').length;
    const rDistCount = trips.filter(t => t.R_method === 'dist-est').length;
    const rNullCount = trips.filter(t => t.R === null).length;
    
    const summary = `
        <div style="background:#f5f5f5;padding:8px;border-radius:4px;margin-bottom:10px;font-size:0.75rem;">
            <div><strong>${pathCount} path(s)</strong> | ${trips.length} trips | ${breakCount} break(s) | ${startTime}  ${endTime} | Total: ${formatTime(totalDuration)}</div>
            <div style="margin-top:4px;color:#666;font-size:0.7rem;">
                R calc: <span style="color:#4caf50;">${rPathCount} path</span> | 
                <span style="color:#2196f3;">${rHopCount} hop</span> | 
                <span style="color:#ff9800;">${rDistCount} dist-est</span>
                ${rNullCount > 0 ? ' | <span style="color:#f44336;">' + rNullCount + ' N/A</span>' : ''}
            </div>
        </div>
    `;
    
    container.innerHTML = summary + html;
}

function formatTime(seconds) {
    if (seconds < 60) return Math.round(seconds) + 's';
    if (seconds < 3600) return Math.round(seconds / 60) + 'm';
    const h = Math.floor(seconds / 3600);
    const m = Math.round((seconds % 3600) / 60);
    return h + 'h ' + m + 'm';
}

// Show site info when marker is clicked
function showSiteInfo(siteId, status) {
    const site = SITES[siteId];
    if (!site) return;
    
    const panel = document.getElementById('detailPanel');
    panel.classList.add('visible');
    
    const details = document.getElementById('tripDetails');
    
    // Determine status
    let statusText = 'NORMAL';
    let statusClass = 'green';
    if (!status.temporal && !status.spatial) {
        statusText = 'BOTH TEMPORAL & SPATIAL FAILED';
        statusClass = 'red';
    } else if (!status.temporal) {
        statusText = 'TEMPORAL CHECK FAILED';
        statusClass = 'yellow';
    } else if (!status.spatial) {
        statusText = 'SPATIAL CHECK FAILED';
        statusClass = 'red';
    } else if (status.reasons.length > 0) {
        statusText = 'SLOW (Warning)';
        statusClass = 'yellow';
    }
    
    details.innerHTML = `
        <div class="detail-row" style="background:#e3f2fd;margin:-15px -15px 10px -15px;padding:15px;border-radius:8px 8px 0 0;">
            <span class="detail-label" style="font-size:1.1rem;font-weight:bold;">SITE INFO</span>
            <span class="detail-value" style="font-size:1.1rem;">${siteId}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Direction</span>
            <span class="detail-value">${site.dir}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Latitude</span>
            <span class="detail-value">${site.lat.toFixed(6)}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Longitude</span>
            <span class="detail-value">${site.lon.toFixed(6)}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Status</span>
            <span class="detail-value ${statusClass}">${statusText}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Temporal OK</span>
            <span class="detail-value ${status.temporal ? 'green' : 'red'}">${status.temporal ? 'YES' : 'NO'}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Spatial OK</span>
            <span class="detail-value ${status.spatial ? 'green' : 'red'}">${status.spatial ? 'YES' : 'NO'}</span>
        </div>
        ${status.reasons.length > 0 ? `
        <div class="detail-row" style="flex-direction:column;align-items:flex-start;">
            <span class="detail-label" style="margin-bottom:5px;">Issues/Notes:</span>
            <div style="background:#fff3e0;padding:8px;border-radius:4px;width:100%;">
                ${status.reasons.map(r => `<div style="margin:3px 0;color:#e65100;">${r}</div>`).join('')}
            </div>
        </div>
        ` : ''}
    `;
    
    // Zoom to site
    map.setCenter({ lat: site.lat, lng: site.lon });
    map.setZoom(15);
}

function selectTrip(idx) {
    const trip = currentRoute[idx];
    if (!trip) return;
    
    // Update selection UI
    document.querySelectorAll('.trip-item').forEach(el => el.classList.remove('selected'));
    const item = document.querySelector(`.trip-item[data-idx="${idx}"]`);
    if (item) item.classList.add('selected');
    
    // Show details panel
    const panel = document.getElementById('detailPanel');
    panel.classList.add('visible');
    
    const details = document.getElementById('tripDetails');
    const statusClass = trip.status === 'normal' ? 'green' : trip.status === 'slow' ? 'yellow' : 'red';
    
    // Get expected data from Google Matrix
    const routeKey = trip.camera_prev + '_' + trip.camera_next;
    const expectedWaypoints = EXPECTED_WAYPOINTS[routeKey] || [];
    const expectedDistance = EXPECTED_DISTANCES[routeKey];
    const expectedTime = EXPECTED_TIMES[routeKey];
    
    // Build waypoints HTML
    let waypointsHtml = '';
    if (expectedWaypoints.length > 0) {
        waypointsHtml = `
        <div class="detail-row" style="flex-direction:column;align-items:flex-start;">
            <span class="detail-label" style="margin-bottom:5px;">Expected Waypoints (from Google Matrix):</span>
            <div style="background:#e3f2fd;padding:8px;border-radius:4px;width:100%;font-family:monospace;font-size:0.8rem;">
                ${trip.camera_prev}  ${expectedWaypoints.join('  ')}  ${trip.camera_next}
            </div>
        </div>`;
    } else {
        waypointsHtml = `
        <div class="detail-row">
            <span class="detail-label">Expected Waypoints</span>
            <span class="detail-value" style="color:#999;">None (direct route)</span>
        </div>`;
    }
    
    details.innerHTML = `
        <div class="detail-row" style="background:#e3f2fd;margin:-15px -15px 10px -15px;padding:15px;border-radius:8px 8px 0 0;">
            <span class="detail-label" style="font-size:1.1rem;font-weight:bold;">TRIP DETAILS</span>
            <span class="detail-value" style="font-size:1.1rem;">${trip.camera_prev}  ${trip.camera_next}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Time Window</span>
            <span class="detail-value">${new Date(trip.t_prev).toLocaleString()}  ${new Date(trip.t_next).toLocaleString()}</span>
        </div>
        ${(trip.vehicle_type_label || trip.Vehicle_type_label || trip.vehicle_type !== undefined) ? `
        <div class="detail-row">
            <span class="detail-label">Vehicle Type</span>
            <span class="detail-value" style="color:#00897b;">${trip.vehicle_type_label || trip.Vehicle_type_label || VEHICLE_TYPES[trip.vehicle_type] || trip.vehicle_type || trip.Vehicle_type}</span>
        </div>
        ` : ''}
        ${trip.weekday ? `
        <div class="detail-row">
            <span class="detail-label">Weekday</span>
            <span class="detail-value">${trip.weekday}</span>
        </div>
        ` : ''}
        
        <div style="background:#f5f5f5;margin:10px -15px;padding:10px 15px;font-weight:bold;">OBSERVED vs EXPECTED</div>
        
        <div class="detail-row">
            <span class="detail-label">Observed Time</span>
            <span class="detail-value">${formatTime(trip.obs_time_seconds)} (${(trip.obs_time_seconds/60).toFixed(1)} min)</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Expected Time (Google)</span>
            <span class="detail-value">${expectedTime !== undefined && expectedTime !== null ? formatTime(expectedTime * 60) + ' (' + expectedTime.toFixed(1) + ' min)' : '<span style="color:#f44336;">Not in matrix</span>'}</span>
        </div>
        ${expectedTime === undefined || expectedTime === null ? `
        <div class="detail-row" style="background:#fff3e0;margin:0 -15px;padding:5px 15px;font-size:0.75rem;">
            <span style="color:#e65100;">Matrix key "${routeKey}" not found. Check if route exists in uploaded matrix.</span>
        </div>
        ` : ''}
        <div class="detail-row">
            <span class="detail-label">Expected Distance (Google)</span>
            <span class="detail-value">${expectedDistance !== undefined && expectedDistance !== null ? expectedDistance.toFixed(2) + ' km' : 'N/A'}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Ratio R (obs/exp)</span>
            <span class="detail-value ${statusClass}">
                ${trip.R !== null ? trip.R.toFixed(3) : 'N/A'}
                ${trip.R_method ? '<span style="font-size:0.7rem;color:#666;margin-left:5px;">(' + trip.R_method + ')</span>' : ''}
            </span>
        </div>
        <div class="detail-row">
            <span class="detail-label">r_max Used</span>
            <span class="detail-value">
                ${trip.usedRmax ? trip.usedRmax.toFixed(3) : 'N/A'}
                ${dynamicRmaxLoaded ? '<span style="font-size:0.7rem;color:#9c27b0;margin-left:5px;">(dynamic)</span>' : '<span style="font-size:0.7rem;color:#666;margin-left:5px;">(default)</span>'}
            </span>
        </div>
        
        ${waypointsHtml}
        
        <div style="background:#f5f5f5;margin:10px -15px;padding:10px 15px;font-weight:bold;">SEGMENTATION RESULT</div>
        
        <div class="detail-row">
            <span class="detail-label">Path ID</span>
            <span class="detail-value">${trip.pathId}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Path Start Site</span>
            <span class="detail-value" style="font-family:monospace;">${trip.corridorStart || trip.camera_prev}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Status</span>
            <span class="detail-value ${statusClass}">${trip.status.toUpperCase()}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Temporal OK</span>
            <span class="detail-value ${trip.temporalOk ? 'green' : 'red'}">${trip.temporalOk ? 'YES' : 'NO'}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Spatial OK</span>
            <span class="detail-value ${trip.spatialOk ? 'green' : 'red'}">${trip.spatialOk ? 'YES' : 'NO'}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Distance to Corridor</span>
            <span class="detail-value ${trip.spatialOk ? 'green' : 'red'}">${trip.spatialDistance !== null && trip.spatialDistance !== undefined ? Math.round(trip.spatialDistance) + ' m' : (trip.spatialOk ? 'On corridor' : 'N/A')}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Epsilon (threshold)</span>
            <span class="detail-value">${document.getElementById('epsilonMeters').value} m</span>
        </div>
        ${trip.spatialCorridor && trip.spatialCorridor.length > 0 ? `
        <div class="detail-row" style="flex-direction:column;align-items:flex-start;">
            <span class="detail-label" style="margin-bottom:5px;">Expected Corridor (${trip.corridorStart || trip.camera_prev} to ${trip.camera_next}):</span>
            <div style="background:#e3f2fd;padding:8px;border-radius:4px;width:100%;font-family:monospace;font-size:0.75rem;word-break:break-all;border-left:4px solid #2196F3;">
                ${trip.spatialCorridor.join(' -> ')}
            </div>
            <div style="font-size:0.7rem;color:#666;margin-top:5px;">
                Blue dashed line on map shows this corridor. ${trip.spatialCorridor.length > 2 ? `(${trip.spatialCorridor.length - 2} intermediate waypoints)` : '(Direct route)'}
            </div>
        </div>
        ` : `
        <div class="detail-row">
            <span class="detail-label">Expected Corridor</span>
            <span class="detail-value" style="color:#f44336;">No route in matrix</span>
        </div>
        `}
        ${trip.breakReason ? `
        <div class="detail-row" style="flex-direction:column;align-items:flex-start;background:#ffebee;margin:5px -15px;padding:10px 15px;">
            <span class="detail-label" style="margin-bottom:5px;color:#c62828;">Break Reason</span>
            <span class="detail-value red" style="font-size:0.85rem;">${trip.breakReason}</span>
        </div>
        ` : ''}
    `;
    
    // Draw the expected corridor on the map
    drawCorridor(trip);
    
    // Zoom to show corridor and trip
    const prevSite = SITES[trip.camera_prev];
    const nextSite = SITES[trip.camera_next];
    if (prevSite && nextSite) {
        const bounds = new google.maps.LatLngBounds();
        bounds.extend({ lat: prevSite.lat, lng: prevSite.lon });
        bounds.extend({ lat: nextSite.lat, lng: nextSite.lon });
        
        // Include corridor sites in bounds
        if (trip.spatialCorridor) {
            trip.spatialCorridor.forEach(siteId => {
                const site = SITES[siteId];
                if (site) bounds.extend({ lat: site.lat, lng: site.lon });
            });
        }
        
        // Also include waypoints in bounds
        expectedWaypoints.forEach(wpId => {
            const wp = SITES[wpId];
            if (wp) bounds.extend({ lat: wp.lat, lng: wp.lon });
        });
        
        map.fitBounds(bounds, 100);
    }
}

// Draw the expected corridor from Google Matrix on the map
function drawCorridor(trip) {
    // Clear previous corridor
    clearCorridor();
    
    if (!trip.spatialCorridor || trip.spatialCorridor.length < 2) {
        return;
    }
    
    // Build the corridor path
    const corridorPath = [];
    trip.spatialCorridor.forEach(siteId => {
        const site = SITES[siteId];
        if (site) {
            corridorPath.push({ lat: site.lat, lng: site.lon });
        }
    });
    
    if (corridorPath.length < 2) return;
    
    // Draw corridor as a dashed line (the expected route from Google Matrix)
    corridorPolyline = new google.maps.Polyline({
        path: corridorPath,
        geodesic: true,
        strokeColor: '#2196F3',  // Blue for expected corridor
        strokeOpacity: 0.8,
        strokeWeight: 4,
        icons: [{
            icon: {
                path: 'M 0,-1 0,1',
                strokeOpacity: 1,
                strokeWeight: 4,
                scale: 3
            },
            offset: '0',
            repeat: '15px'
        }],
        map: map,
        zIndex: 5
    });
    
    // Add markers for corridor waypoints (intermediate sites on expected route)
    trip.spatialCorridor.forEach((siteId, idx) => {
        const site = SITES[siteId];
        if (!site) return;
        
        const isStart = idx === 0;
        const isEnd = idx === trip.spatialCorridor.length - 1;
        
        // Only mark intermediate waypoints (not start/end which are already marked)
        if (!isStart && !isEnd) {
            const marker = new google.maps.Marker({
                position: { lat: site.lat, lng: site.lon },
                map: map,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 6,
                    fillColor: '#2196F3',
                    fillOpacity: 0.9,
                    strokeColor: '#0D47A1',
                    strokeWeight: 2
                },
                title: `Corridor waypoint: ${siteId}`,
                zIndex: 15
            });
            corridorMarkers.push(marker);
        }
    });
    
    // If spatial check failed, draw a line showing the distance from current site to corridor
    if (!trip.spatialOk && trip.spatialDistance !== null) {
        const currentSite = SITES[trip.camera_next];
        if (currentSite && corridorPath.length > 0) {
            // Find closest point on corridor to the current site
            const closestPoint = findClosestPointOnPath(currentSite.lat, currentSite.lon, corridorPath);
            
            // Draw a red line showing the distance
            const distanceLine = new google.maps.Polyline({
                path: [
                    { lat: currentSite.lat, lng: currentSite.lon },
                    closestPoint
                ],
                geodesic: true,
                strokeColor: '#F44336',  // Red for distance/error
                strokeOpacity: 1,
                strokeWeight: 3,
                map: map,
                zIndex: 20
            });
            corridorMarkers.push(distanceLine);
            
            // Add a label showing the distance
            const midLat = (currentSite.lat + closestPoint.lat) / 2;
            const midLng = (currentSite.lon + closestPoint.lng) / 2;
            
            const distLabel = new google.maps.Marker({
                position: { lat: midLat, lng: midLng },
                map: map,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 0
                },
                label: {
                    text: Math.round(trip.spatialDistance) + 'm',
                    color: '#C62828',
                    fontWeight: 'bold',
                    fontSize: '12px'
                },
                zIndex: 25
            });
            corridorMarkers.push(distLabel);
        }
    }
}

// Find closest point on a path to a given point
function findClosestPointOnPath(lat, lon, path) {
    let minDist = Infinity;
    let closestPoint = path[0];
    
    for (let i = 0; i < path.length - 1; i++) {
        const p1 = path[i];
        const p2 = path[i + 1];
        
        // Find closest point on this segment
        const closest = closestPointOnSegment(lat, lon, p1.lat, p1.lng, p2.lat, p2.lng);
        const dist = haversineDistance(lat, lon, closest.lat, closest.lng);
        
        if (dist < minDist) {
            minDist = dist;
            closestPoint = closest;
        }
    }
    
    return closestPoint;
}

// Find closest point on a line segment to a given point
function closestPointOnSegment(lat, lon, lat1, lng1, lat2, lng2) {
    const dx = lat2 - lat1;
    const dy = lng2 - lng1;
    
    if (dx === 0 && dy === 0) {
        return { lat: lat1, lng: lng1 };
    }
    
    const t = Math.max(0, Math.min(1, ((lat - lat1) * dx + (lon - lng1) * dy) / (dx * dx + dy * dy)));
    
    return {
        lat: lat1 + t * dx,
        lng: lng1 + t * dy
    };
}

// Clear corridor visualization
function clearCorridor() {
    if (corridorPolyline) {
        corridorPolyline.setMap(null);
        corridorPolyline = null;
    }
    corridorMarkers.forEach(m => m.setMap(null));
    corridorMarkers = [];
}

// ============ MAIN FUNCTIONS ============
async function showRoute() {
    const vehicle = document.getElementById('vehicleSel').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const startTime = document.getElementById('startTime').value;
    const endTime = document.getElementById('endTime').value;
    
    if (!vehicle) {
        alert('Please select a vehicle');
        return;
    }
    
    if (!startDate || !endDate) {
        alert('Please select start and end dates');
        return;
    }
    
    if (startDate > endDate) {
        alert('Start date must be before or equal to end date');
        return;
    }
    
    // Show active filter
    const filterDiv = document.getElementById('activeFilter');
    const filterInfo = document.getElementById('filterInfo');
    filterDiv.style.display = 'block';
    
    // Build clear filter description
    const filterStartDT = startDate + ' ' + startTime;
    const filterEndDT = endDate + ' ' + endTime;
    filterInfo.innerHTML = `
        <strong>${vehicle}</strong><br>
        <span style="font-size:0.8rem;">Trips that START and END between: <strong>${filterStartDT}</strong> and <strong>${filterEndDT}</strong></span>
    `;
    
    // Show loading state
    document.getElementById('tripList').innerHTML = '<div class="loading">Filtering trips...</div>';
    
    // Filter trips
    const filtered = filterTrips(vehicle, startDate, endDate, startTime, endTime);
    
    if (filtered.length === 0) {
        // Get some debug info
        const vehicleTrips = TRIPS.filter(t => t.plate === vehicle);
        const dates = vehicleTrips.map(t => t.t_prev.split('T')[0]);
        const uniqueDates = [...new Set(dates)].sort();
        
        let debugInfo = `<div class="no-data">
            <strong>No trips found for the selected filters.</strong><br><br>
            Vehicle <strong>${vehicle}</strong> has <strong>${vehicleTrips.length}</strong> total trips.<br>`;
        
        if (uniqueDates.length > 0) {
            debugInfo += `<br>Available dates: <strong>${uniqueDates[0]}</strong> to <strong>${uniqueDates[uniqueDates.length-1]}</strong><br>`;
        }
        
        debugInfo += `<br>Your filter: ${startDate} ${startTime} to ${endDate} ${endTime}<br>`;
        debugInfo += `<br><em>Adjust the date/time range to match available data.</em></div>`;
        
        document.getElementById('tripList').innerHTML = debugInfo;
        document.getElementById('pathTimeline').innerHTML = '<div class="no-data">No trips</div>';
        updateStats([]);
        clearMap();
        return;
    }
    
    // Segment route using precomputed Google Matrix data (instant - no API calls)
    currentRoute = segmentRoute(filtered);
    
    // Update UI
    updateStats(currentRoute);
    
    // Hide detail panel
    document.getElementById('detailPanel').classList.remove('visible');
    
    // Visualize (async - will snap to roads for display)
    await visualizeRoute(currentRoute);
    
    console.log('Showing route:', currentRoute.length, 'trips for', vehicle, 'from', startDate, 'to', endDate, 'time', startTime, '-', endTime);
}

async function showAllTrips() {
    const vehicle = document.getElementById('vehicleSel').value;
    
    // Show active filter
    const filterDiv = document.getElementById('activeFilter');
    const filterInfo = document.getElementById('filterInfo');
    filterDiv.style.display = 'block';
    if (vehicle) {
        filterInfo.innerHTML = `<strong>${vehicle}</strong> - All dates and times (no filter)`;
    } else {
        filterInfo.innerHTML = `<strong>All vehicles</strong> - All dates and times (no filter)`;
    }
    
    // Show loading state
    document.getElementById('tripList').innerHTML = '<div class="loading">Loading all trips...</div>';
    
    // Filter by vehicle only (no date/time filter)
    const filtered = filterTrips(vehicle, null, null, null, null);
    
    if (filtered.length === 0) {
        document.getElementById('tripList').innerHTML = '<div class="no-data">No trips found for this vehicle.</div>';
        updateStats([]);
        clearMap();
        return;
    }
    
    // Segment route using precomputed Google Matrix data (instant - no API calls)
    currentRoute = segmentRoute(filtered);
    
    // Update UI
    updateStats(currentRoute);
    
    // Hide detail panel
    document.getElementById('detailPanel').classList.remove('visible');
    
    // Visualize (async - will snap to roads for display)
    await visualizeRoute(currentRoute);
    
    console.log('Showing all trips:', currentRoute.length, 'trips');
}

// Initialize

// ============ PAGE SWITCHING ============
function showPage(pageNum) {
    console.log('showPage called:', pageNum);
    
    // Update tabs
    document.querySelectorAll('.page-tab').forEach((tab, idx) => {
        tab.classList.toggle('active', idx === pageNum - 1);
    });
    
    // Update content
    document.querySelectorAll('.page-content').forEach((content, idx) => {
        content.classList.toggle('active', idx === pageNum - 1);
    });
    
    // Initialize network map if switching to page 2
    if (pageNum === 2) {
        // Wait a bit for the div to be visible, then init map
        setTimeout(() => {
            if (!networkMap && typeof google !== 'undefined') {
                initNetworkMap();
            }
        }, 100);
    }
}

// ============ PAGE 2: NETWORK VIEW ============
let networkMap = null;
let networkMarkers = [];
let networkPolylines = [];
let NETWORK_PATHS = []; // [{vehicle_type, global_path_id, full_path, vehicles}]
let NETWORK_EDGES = {}; // {from_to: {weight, vehicleTypes}}

// Initialize network map
function initNetworkMap() {
    console.log('initNetworkMap called');
    const mapDiv = document.getElementById('networkMap');
    if (!mapDiv) {
        console.error('networkMap div not found');
        return;
    }
    if (networkMap) {
        console.log('networkMap already initialized');
        return;
    }
    
    // Remove loading message
    const loadingMsg = document.getElementById('networkMapLoading');
    if (loadingMsg) loadingMsg.remove();
    
    networkMap = new google.maps.Map(mapDiv, {
        center: { lat: 24.7136, lng: 46.6753 },
        zoom: 11,
        styles: [
            { featureType: "poi", stylers: [{ visibility: "off" }] },
            { featureType: "transit", stylers: [{ visibility: "off" }] }
        ]
    });
}

// Upload network paths (CSV or Parquet)
// Load CSV from pasted text
function loadPastedCSV() {
    const text = document.getElementById('csvTextInput').value;
    if (!text.trim()) {
        alert('Please paste CSV content first');
        return;
    }
    
    const statusDiv = document.getElementById('networkDataStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Parsing...</span>';
    
    try {
        const data = parseNetworkCSV(text);
        NETWORK_PATHS = data;
        
        if (NETWORK_PATHS.length === 0) {
            statusDiv.innerHTML = `<span style="color:#f44336;">Loaded 0 paths</span>
                <div style="font-size:0.6rem;color:#666;margin-top:4px;word-break:break-all;">${CSV_DEBUG_INFO}</div>
                <div style="font-size:0.65rem;color:#888;margin-top:2px;">Source: Pasted CSV</div>`;
        } else {
            processNetworkPaths();
            statusDiv.innerHTML = `<span style="color:#4caf50;">Loaded ${NETWORK_PATHS.length.toLocaleString()} paths</span>
                <div style="font-size:0.65rem;color:#666;margin-top:2px;">Source: Pasted CSV</div>`;
            // Hide paste area on success
            document.getElementById('csvPasteArea').style.display = 'none';
        }
    } catch (err) {
        statusDiv.innerHTML = `<span style="color:#f44336;">Error: ${err.message}</span>`;
    }
}

// Store pre-aggregated data if loaded
let PRECOMPUTED_NETWORK = null;

async function uploadNetworkPaths(input) {
    const file = input.files[0];
    if (!file) return;
    
    const statusDiv = document.getElementById('networkDataStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Reading file...</span>';
    
    try {
        const fileName = file.name.toLowerCase();
        
        // Read file content
        const text = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.onerror = (e) => reject(new Error('Failed to read file. Try re-selecting it.'));
            reader.readAsText(file);
        });
        
        if (fileName.endsWith('.json')) {
            const jsonData = JSON.parse(text);
            
            // Check if it's pre-aggregated format (from prepare_network_data.py)
            if (jsonData.edges && jsonData.meta) {
                PRECOMPUTED_NETWORK = jsonData;
                NETWORK_PATHS = jsonData.top_paths || [];
                loadPrecomputedNetwork();
                statusDiv.innerHTML = `<span style="color:#4caf50;">Loaded pre-aggregated network</span>
                    <div style="font-size:0.65rem;color:#666;margin-top:2px;">
                        ${jsonData.meta.unique_edges.toLocaleString()} edges, 
                        ${jsonData.meta.total_vehicles.toLocaleString()} vehicles
                    </div>
                    <div style="font-size:0.65rem;color:#888;">Source: ${file.name}</div>`;
                return;
            }
            
            // Regular array of paths
            NETWORK_PATHS = Array.isArray(jsonData) ? jsonData : (jsonData.data || jsonData.paths || []);
            
        } else if (fileName.endsWith('.csv')) {
            console.log('CSV file size:', text.length, 'chars');
            NETWORK_PATHS = parseNetworkCSV(text);
            
        } else if (fileName.endsWith('.parquet')) {
            throw new Error('Parquet not supported in browser. Use: python prepare_network_data.py yourfile.parquet');
        } else {
            throw new Error('Use .json (recommended) or .csv');
        }
        
        PRECOMPUTED_NETWORK = null;
        
        if (NETWORK_PATHS.length === 0) {
            statusDiv.innerHTML = `<span style="color:#f44336;">Loaded 0 paths</span>
                <div style="font-size:0.6rem;color:#666;margin-top:4px;word-break:break-all;">${CSV_DEBUG_INFO}</div>
                <div style="font-size:0.65rem;color:#888;margin-top:2px;">Source: ${file.name}</div>`;
        } else {
            processNetworkPaths();
            statusDiv.innerHTML = `<span style="color:#4caf50;">Loaded ${NETWORK_PATHS.length.toLocaleString()} paths</span>
                <div style="font-size:0.65rem;color:#666;margin-top:2px;">Source: ${file.name}</div>`;
        }
        
    } catch (err) {
        statusDiv.innerHTML = `<span style="color:#f44336;">Error: ${err.message}</span>`;
        console.error('Error loading network paths:', err);
    }
    
    // Reset input so same file can be re-selected
    input.value = '';
}

// Upload site coordinates
async function uploadSiteCoordinates(input) {
    const file = input.files[0];
    if (!file) return;
    
    const statusDiv = document.getElementById('siteCoordStatus');
    statusDiv.innerHTML = '<span style="color:#2196f3;">Loading...</span>';
    
    try {
        const text = await file.text();
        let sites = {};
        
        if (file.name.endsWith('.json')) {
            const data = JSON.parse(text);
            // Handle array or object format
            if (Array.isArray(data)) {
                data.forEach(s => {
                    const id = s.site_id || s.camera_id || s.id;
                    if (id) {
                        sites[id] = { lat: parseFloat(s.lat || s.latitude), lng: parseFloat(s.lng || s.lon || s.longitude) };
                    }
                });
            } else {
                sites = data;
            }
        } else if (file.name.endsWith('.csv')) {
            const lines = text.trim().split('\n');
            const headers = lines[0].toLowerCase().split(',').map(h => h.trim());
            const idIdx = headers.findIndex(h => h.includes('site') || h.includes('camera') || h === 'id');
            const latIdx = headers.findIndex(h => h.includes('lat'));
            const lngIdx = headers.findIndex(h => h.includes('lon') || h.includes('lng'));
            
            for (let i = 1; i < lines.length; i++) {
                const vals = lines[i].split(',');
                const id = vals[idIdx]?.trim();
                if (id) {
                    sites[id] = { lat: parseFloat(vals[latIdx]), lng: parseFloat(vals[lngIdx]) };
                }
            }
        }
        
        // Merge with existing SITES
        Object.assign(SITES, sites);
        
        statusDiv.innerHTML = `<span style="color:#4caf50;">Loaded ${Object.keys(sites).length} sites</span>
            <div style="font-size:0.6rem;color:#666;">Total: ${Object.keys(SITES).length}</div>`;
        
        // Redraw if network is loaded
        if (Object.keys(NETWORK_EDGES).length > 0) {
            filterNetworkByType();
        }
        
    } catch (err) {
        statusDiv.innerHTML = `<span style="color:#f44336;">Error: ${err.message}</span>`;
    }
    
    input.value = '';
}

// Load pre-computed network data (from prepare_network_data.py)
function loadPrecomputedNetwork() {
    if (!PRECOMPUTED_NETWORK) return;
    
    const data = PRECOMPUTED_NETWORK;
    
    // Load site coordinates if included
    if (data.sites && Object.keys(data.sites).length > 0) {
        Object.assign(SITES, data.sites);
        document.getElementById('siteCoordStatus').innerHTML = 
            `<span style="color:#4caf50;">Loaded ${Object.keys(data.sites).length} sites from JSON</span>`;
    }
    
    // Convert edges to NETWORK_EDGES format
    NETWORK_EDGES = {};
    data.edges.forEach(edge => {
        const key = edge.from + '_' + edge.to;
        NETWORK_EDGES[key] = {
            from: edge.from,
            to: edge.to,
            weight: edge.weight,
            vehicleTypes: edge.by_vtype || {}
        };
    });
    
    // Update stats
    document.getElementById('statNetworkPaths').textContent = data.meta.total_paths.toLocaleString();
    document.getElementById('statNetworkEdges').textContent = data.meta.unique_edges.toLocaleString();
    document.getElementById('statNetworkVehicles').textContent = data.meta.total_vehicles.toLocaleString();
    document.getElementById('statNetworkNodes').textContent = data.meta.unique_nodes.toLocaleString();
    
    // Update vehicle type dropdown
    const vtSelect = document.getElementById('networkVehicleType');
    vtSelect.innerHTML = '<option value="all">All Types</option>';
    if (data.meta.vehicle_types) {
        Object.keys(data.meta.vehicle_types).sort().forEach(vt => {
            const count = data.meta.vehicle_types[vt];
            vtSelect.innerHTML += `<option value="${vt}">Type ${vt} (${count.toLocaleString()})</option>`;
        });
    }
    
    // Update slider max
    const maxWeight = Math.max(...data.edges.map(e => e.weight));
    const slider = document.getElementById('networkMinVehicles');
    slider.max = Math.min(maxWeight, 10000);
    slider.value = 1;
    updateNetworkMinLabel();
    
    // Draw network
    filterNetworkByType();
    updateTopPathsList();
}

// Parse network CSV - with debug info
let CSV_DEBUG_INFO = '';

function parseNetworkCSV(text) {
    CSV_DEBUG_INFO = '';
    
    // Remove BOM if present
    if (text.charCodeAt(0) === 0xFEFF) {
        text = text.substring(1);
        CSV_DEBUG_INFO += 'BOM removed. ';
    }
    
    // Normalize line endings (Windows \r\n to \n)
    text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
    
    const lines = text.trim().split('\n');
    CSV_DEBUG_INFO += 'Lines: ' + lines.length + '. ';
    
    if (lines.length < 2) {
        CSV_DEBUG_INFO += 'ERROR: Less than 2 lines!';
        return [];
    }
    
    // Get headers from first line
    const headerLine = lines[0].trim();
    const headers = headerLine.split(',').map(h => h.trim().toLowerCase().replace(/"/g, ''));
    CSV_DEBUG_INFO += 'Headers: [' + headers.join(', ') + ']. ';
    
    // Check for full_path column
    const fullPathIdx = headers.indexOf('full_path');
    if (fullPathIdx === -1) {
        CSV_DEBUG_INFO += 'ERROR: No "full_path" column found!';
        return [];
    }
    
    const data = [];
    let skippedNoPath = 0;
    
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        // Split by comma
        const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
        
        const row = {};
        headers.forEach((h, idx) => {
            let val = values[idx] || '';
            if (h === 'vehicle_type' || h === 'vehicles') {
                val = parseInt(val) || 0;
            }
            row[h] = val;
        });
        
        // Add row if it has full_path with path separator
        if (row.full_path && row.full_path.includes('>')) {
            data.push(row);
        } else {
            skippedNoPath++;
        }
    }
    
    CSV_DEBUG_INFO += 'Parsed: ' + data.length + ' rows. ';
    if (skippedNoPath > 0) {
        CSV_DEBUG_INFO += 'Skipped (no ">"): ' + skippedNoPath + '. ';
    }
    
    if (data.length === 0 && lines.length > 1) {
        // Show what the first data row looks like
        const firstDataLine = lines[1].trim();
        const firstValues = firstDataLine.split(',');
        CSV_DEBUG_INFO += 'First row values: [' + firstValues.slice(0, 5).join(' | ') + ']. ';
        CSV_DEBUG_INFO += 'full_path value: "' + (firstValues[fullPathIdx] || 'MISSING') + '"';
    }
    
    return data;
}

// Read network parquet - browser parquet is unreliable, suggest conversion
async function readNetworkParquet(file) {
    throw new Error('Browser parquet reading is unreliable. Please convert to CSV first using: python3 convert_exact_paths.py ' + file.name);
}

// Process network paths into edges
function processNetworkPaths() {
    NETWORK_EDGES = {};
    const nodes = new Set();
    let totalVehicles = 0;
    
    NETWORK_PATHS.forEach(path => {
        const sites = (path.full_path || '').split('>').map(s => s.trim()).filter(s => s);
        const vehicles = parseInt(path.vehicles) || 0;
        const vType = path.vehicle_type;
        
        totalVehicles += vehicles;
        
        // Create edges
        for (let i = 0; i < sites.length - 1; i++) {
            const from = sites[i];
            const to = sites[i + 1];
            const key = from + '_' + to;
            
            nodes.add(from);
            nodes.add(to);
            
            if (!NETWORK_EDGES[key]) {
                NETWORK_EDGES[key] = { from, to, weight: 0, vehicleTypes: {} };
            }
            NETWORK_EDGES[key].weight += vehicles;
            NETWORK_EDGES[key].vehicleTypes[vType] = (NETWORK_EDGES[key].vehicleTypes[vType] || 0) + vehicles;
        }
        nodes.add(sites[sites.length - 1]);
    });
    
    // Update stats
    document.getElementById('statNetworkPaths').textContent = NETWORK_PATHS.length.toLocaleString();
    document.getElementById('statNetworkEdges').textContent = Object.keys(NETWORK_EDGES).length.toLocaleString();
    document.getElementById('statNetworkVehicles').textContent = totalVehicles.toLocaleString();
    document.getElementById('statNetworkNodes').textContent = nodes.size.toLocaleString();
    
    // Update slider max
    const maxWeight = Math.max(...Object.values(NETWORK_EDGES).map(e => e.weight));
    document.getElementById('networkMinVehicles').max = Math.min(maxWeight, 1000);
    
    // Draw network
    filterNetworkByType();
    updateTopPathsList();
}

// Filter network by vehicle type
function filterNetworkByType() {
    const vType = document.getElementById('networkVehicleType').value;
    const minVehicles = parseInt(document.getElementById('networkMinVehicles').value) || 1;
    
    // Filter edges directly (much faster than reprocessing paths)
    const filteredEdges = {};
    
    Object.entries(NETWORK_EDGES).forEach(([key, edge]) => {
        let weight = edge.weight;
        
        // If filtering by vehicle type, use that type's weight only
        if (vType !== 'all') {
            weight = edge.vehicleTypes[vType] || 0;
        }
        
        if (weight >= minVehicles) {
            filteredEdges[key] = { ...edge, weight: weight };
        }
    });
    
    drawNetworkEdges(filteredEdges);
    
    // Filter top paths for the list
    let filteredPaths = NETWORK_PATHS;
    if (vType !== 'all') {
        filteredPaths = NETWORK_PATHS.filter(p => String(p.vehicle_type) === vType);
    }
    filteredPaths = filteredPaths.filter(p => (parseInt(p.vehicles) || 0) >= minVehicles);
    updateTopPathsList(filteredPaths);
}

// Draw network edges on map
function drawNetworkEdges(edges) {
    if (!networkMap) initNetworkMap();
    
    // Clear existing
    networkMarkers.forEach(m => m.setMap(null));
    networkPolylines.forEach(p => p.setMap(null));
    networkMarkers = [];
    networkPolylines = [];
    
    const bounds = new google.maps.LatLngBounds();
    const edgeList = Object.values(edges);
    if (edgeList.length === 0) return;
    
    // Calculate weight range for scaling
    const weights = edgeList.map(e => e.weight);
    const maxWeight = Math.max(...weights);
    const minWeight = Math.min(...weights);
    
    // Vehicle type colors
    const vTypeColors = {
        '0': '#4285f4',
        '1': '#34a853',
        '2': '#fbbc05',
        '3': '#ea4335',
        '4': '#9c27b0'
    };
    
    // Draw edges
    edgeList.forEach(edge => {
        const fromSite = SITES[edge.from];
        const toSite = SITES[edge.to];
        
        if (!fromSite || !toSite) return;
        
        // Scale line weight (2-12 pixels)
        const normalizedWeight = maxWeight > minWeight ? (edge.weight - minWeight) / (maxWeight - minWeight) : 0.5;
        const strokeWeight = 2 + normalizedWeight * 10;
        
        // Determine dominant vehicle type for color
        const dominantType = Object.entries(edge.vehicleTypes)
            .sort((a, b) => b[1] - a[1])[0];
        const color = vTypeColors[dominantType ? dominantType[0] : '0'] || '#666';
        
        const path = [
            { lat: fromSite.lat, lng: fromSite.lon },
            { lat: toSite.lat, lng: toSite.lon }
        ];
        
        bounds.extend(path[0]);
        bounds.extend(path[1]);
        
        const polyline = new google.maps.Polyline({
            path: path,
            geodesic: true,
            strokeColor: color,
            strokeOpacity: 0.7,
            strokeWeight: strokeWeight,
            map: networkMap
        });
        
        // Tooltip on hover
        const infoWindow = new google.maps.InfoWindow({
            content: `<div style="font-size:12px;"><strong>${edge.from}  ${edge.to}</strong><br>Vehicles: ${edge.weight.toLocaleString()}</div>`
        });
        
        polyline.addListener('mouseover', (e) => {
            infoWindow.setPosition(e.latLng);
            infoWindow.open(networkMap);
        });
        polyline.addListener('mouseout', () => infoWindow.close());
        
        networkPolylines.push(polyline);
    });
    
    // Fit bounds
    if (networkPolylines.length > 0) {
        networkMap.fitBounds(bounds, 50);
    }
}

// Update top paths list
function updateTopPathsList(paths) {
    const list = document.getElementById('topPathsList');
    const displayPaths = (paths || NETWORK_PATHS)
        .sort((a, b) => (parseInt(b.vehicles) || 0) - (parseInt(a.vehicles) || 0))
        .slice(0, 50);
    
    if (displayPaths.length === 0) {
        list.innerHTML = '<div class="no-data">No paths match current filters</div>';
        return;
    }
    
    let html = '';
    displayPaths.forEach((path, idx) => {
        const vType = path.vehicle_type;
        const vehicles = parseInt(path.vehicles) || 0;
        const sites = (path.full_path || '').split('>');
        
        html += `
            <div class="trip-item" onclick="selectNetworkPath(${idx})" style="padding:8px;margin:4px 0;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <span class="vtype-badge vtype-${vType}">VT${vType}</span>
                    <span class="edge-weight">${vehicles.toLocaleString()}</span>
                </div>
                <div class="path-cell" style="margin-top:4px;" title="${path.full_path}">
                    ${sites[0]}  ...  ${sites[sites.length - 1]}
                </div>
                <div style="font-size:0.65rem;color:#666;">${sites.length} nodes</div>
            </div>
        `;
    });
    
    list.innerHTML = html;
}

// Select and highlight a network path
function selectNetworkPath(idx) {
    const vType = document.getElementById('networkVehicleType').value;
    const minVehicles = parseInt(document.getElementById('networkMinVehicles').value) || 1;
    
    let paths = NETWORK_PATHS;
    if (vType !== 'all') {
        paths = paths.filter(p => String(p.vehicle_type) === vType);
    }
    paths = paths.filter(p => (parseInt(p.vehicles) || 0) >= minVehicles)
        .sort((a, b) => (parseInt(b.vehicles) || 0) - (parseInt(a.vehicles) || 0));
    
    const path = paths[idx];
    if (!path) return;
    
    // Show path details
    const detailsPanel = document.getElementById('pathDetailsPanel');
    const noSelection = document.getElementById('noPathSelected');
    const details = document.getElementById('pathDetails');
    
    detailsPanel.style.display = 'block';
    noSelection.style.display = 'none';
    
    const sites = (path.full_path || '').split('>');
    
    details.innerHTML = `
        <div style="margin-bottom:10px;">
            <span class="vtype-badge vtype-${path.vehicle_type}">Vehicle Type ${path.vehicle_type}</span>
            <span style="font-weight:bold;margin-left:10px;">${parseInt(path.vehicles).toLocaleString()} vehicles</span>
        </div>
        <div style="font-family:monospace;background:#f5f5f5;padding:10px;border-radius:4px;word-break:break-all;">
            ${sites.join('  ')}
        </div>
        <div style="margin-top:10px;font-size:0.8rem;color:#666;">
            Path ID: ${path.global_path_id || 'N/A'}<br>
            Nodes: ${sites.length}
        </div>
    `;
    
    // Highlight path on map
    highlightNetworkPath(path);
}

// Highlight specific path on network map
function highlightNetworkPath(path) {
    const sites = (path.full_path || '').split('>').map(s => s.trim()).filter(s => s);
    
    // Build path coordinates
    const pathCoords = [];
    sites.forEach(siteId => {
        const site = SITES[siteId];
        if (site) {
            pathCoords.push({ lat: site.lat, lng: site.lon });
        }
    });
    
    if (pathCoords.length < 2) return;
    
    // Add highlight polyline
    const highlightLine = new google.maps.Polyline({
        path: pathCoords,
        geodesic: true,
        strokeColor: '#000',
        strokeOpacity: 1,
        strokeWeight: 4,
        zIndex: 1000,
        map: networkMap
    });
    
    // Remove after 3 seconds
    setTimeout(() => highlightLine.setMap(null), 3000);
    
    // Fit bounds to path
    const bounds = new google.maps.LatLngBounds();
    pathCoords.forEach(c => bounds.extend(c));
    networkMap.fitBounds(bounds, 50);
}

// Update min vehicles label
function updateNetworkMinLabel() {
    const val = document.getElementById('networkMinVehicles').value;
    document.getElementById('networkMinLabel').textContent = val;
}

// Quick filter presets
function setNetworkFilter(preset) {
    const slider = document.getElementById('networkMinVehicles');
    
    if (preset === 'all') {
        slider.value = 1;
    } else if (preset === 'top10') {
        const vehicles = NETWORK_PATHS.map(p => parseInt(p.vehicles) || 0).sort((a, b) => b - a);
        const top10Threshold = vehicles[Math.floor(vehicles.length * 0.1)] || 1;
        slider.value = top10Threshold;
    } else if (preset === 'top50') {
        const vehicles = NETWORK_PATHS.map(p => parseInt(p.vehicles) || 0).sort((a, b) => b - a);
        const top50Threshold = vehicles[49] || 1;
        slider.value = top50Threshold;
    }
    
    updateNetworkMinLabel();
    filterNetworkByType();
}

document.getElementById('statVehicles').textContent = VEHICLES.length;
document.getElementById('embeddedTripCount').textContent = TRIPS.length;
document.getElementById('embeddedVehicleCount').textContent = VEHICLES.length;
    </script>
    <script src="https://cdn.jsdelivr.net/gh/somanchiu/Keyless-Google-Maps-API@v7.1/mapsJavaScriptAPI.js" async defer></script>
    <!-- Apache Arrow for Parquet support -->
    <script src="https://cdn.jsdelivr.net/npm/apache-arrow@14.0.2/Arrow.dom.min.js"></script>
    <!-- Parquet WASM -->
    <script src="https://cdn.jsdelivr.net/npm/parquet-wasm@0.6.0/esm/parquet_wasm.js" type="module"></script>
</body>
</html>
