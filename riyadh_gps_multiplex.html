<!DOCTYPE html>
<html>
<head>
<title>Path Split Test</title>
<style>
* { box-sizing: border-box; }
body { font-family: Arial; margin: 0; padding: 20px; background: #111; color: #eee; }
.row { display: flex; gap: 20px; margin: 10px 0; align-items: center; }
select, input { padding: 8px; font-size: 14px; }
button { padding: 10px 20px; background: #e94560; color: white; border: none; cursor: pointer; font-size: 16px; font-weight: bold; }
button:hover { background: #ff6b6b; }
#log { background: #222; padding: 15px; font-family: monospace; white-space: pre-wrap; height: 400px; overflow-y: auto; border: 2px solid #333; }
.path-box { display: inline-block; margin: 5px; padding: 10px 15px; border-radius: 5px; }
h3 { color: #e94560; }
</style>
</head>
<body>

<h2>Path Splitting Debug</h2>

<div class="row">
    <label>Route:</label>
    <select id="routeSel">
        <option value="">-- Select --</option>
    </select>
</div>

<div class="row">
    <label>Rule:</label>
    <select id="ruleSel">
        <option value="none">No splitting</option>
        <option value="count">Split every N trips</option>
    </select>
    <label>N:</label>
    <input type="number" id="nVal" value="3" style="width:60px">
</div>

<div class="row">
    <button onclick="runSplit()">RUN SPLIT</button>
</div>

<h3>Debug Log:</h3>
<div id="log">Ready. Select a route and click RUN SPLIT.</div>

<h3>Visual Result:</h3>
<div id="visual"></div>

<script>
console.log('Script starting...');

var TRIPS = [{"id": "7044166", "segments": [{"idx": 0, "start": [46.69877253279598, 24.747029574310872], "end": [46.69749177912585, 24.746280813815133], "speed_kmh": 55.4, "time": 10.0, "period": 10.0, "distance_m": 153.8}, {"idx": 1, "start": [46.69749177912585, 24.746280813815133], "end": [46.69605289936646, 24.745811858329628], "speed_kmh": 55.6, "time": 20.0, "period": 10.0, "distance_m": 154.4}, {"idx": 2, "start": [46.69605289936646, 24.745811858329628], "end": [46.694701057882256, 24.744869742715615], "speed_kmh": 61.9, "time": 30.0, "period": 10.0, "distance_m": 172.1}, {"idx": 3, "start": [46.694701057882256, 24.744869742715615], "end": [46.692718657630635, 24.744169213435814], "speed_kmh": 77.3, "time": 40.0, "period": 10.0, "distance_m": 214.8}, {"idx": 4, "start": [46.692718657630635, 24.744169213435814], "end": [46.69111791753348, 24.743631580346943], "speed_kmh": 62.0, "time": 50.0, "period": 10.0, "distance_m": 172.4}, {"idx": 5, "start": [46.69111791753348, 24.743631580346943], "end": [46.689649246532575, 24.742936239908552], "speed_kmh": 60.2, "time": 60.0, "period": 10.0, "distance_m": 167.3}, {"idx": 6, "start": [46.689649246532575, 24.742936239908552], "end": [46.68821334726735, 24.74246121913553], "speed_kmh": 55.6, "time": 70.0, "period": 10.0, "distance_m": 154.3}, {"idx": 7, "start": [46.68821334726735, 24.74246121913553], "end": [46.686925023137626, 24.74178110951169], "speed_kmh": 54.2, "time": 80.0, "period": 10.0, "distance_m": 150.5}, {"idx": 8, "start": [46.686925023137626, 24.74178110951169], "end": [46.686070767562704, 24.74221083036759], "speed_kmh": 35.5, "time": 90.0, "period": 10.0, "distance_m": 98.6}, {"idx": 9, "start": [46.686070767562704, 24.74221083036759], "end": [46.68540777587091, 24.743034391307056], "speed_kmh": 40.8, "time": 100.0, "period": 10.0, "distance_m": 113.4}, {"idx": 10, "start": [46.68540777587091, 24.743034391307056], "end": [46.68499332309639, 24.744039687199663], "speed_kmh": 43.0, "time": 110.0, "period": 10.0, "distance_m": 119.4}, {"idx": 11, "start": [46.68499332309639, 24.744039687199663], "end": [46.684429951185166, 24.745333188595136], "speed_kmh": 55.7, "time": 120.0, "period": 10.0, "distance_m": 154.7}, {"idx": 12, "start": [46.684429951185166, 24.745333188595136], "end": [46.68367275424472, 24.746661496506423], "speed_kmh": 59.9, "time": 130.0, "period": 10.0, "distance_m": 166.3}, {"idx": 13, "start": [46.68367275424472, 24.746661496506423], "end": [46.68304203464718, 24.74797991357463], "speed_kmh": 57.5, "time": 140.0, "period": 10.0, "distance_m": 159.8}, {"idx": 14, "start": [46.68304203464718, 24.74797991357463], "end": [46.682444118749274, 24.74929832206763], "speed_kmh": 57.1, "time": 150.0, "period": 10.0, "distance_m": 158.5}, {"idx": 15, "start": [46.682444118749274, 24.74929832206763], "end": [46.681816077573956, 24.750487848322575], "speed_kmh": 52.8, "time": 160.0, "period": 10.0, "distance_m": 146.7}, {"idx": 16, "start": [46.681816077573956, 24.750487848322575], "end": [46.68162423566709, 24.749892820666012], "speed_kmh": 24.8, "time": 170.0, "period": 10.0, "distance_m": 68.9}, {"idx": 17, "start": [46.68162423566709, 24.749892820666012], "end": [46.68237396898328, 24.748839986908994], "speed_kmh": 50.2, "time": 180.0, "period": 10.0, "distance_m": 139.4}, {"idx": 18, "start": [46.68237396898328, 24.748839986908994], "end": [46.682950468857065, 24.747783651446902], "speed_kmh": 47.2, "time": 190.0, "period": 10.0, "distance_m": 131.1}, {"idx": 19, "start": [46.682950468857065, 24.747783651446902], "end": [46.68333583548611, 24.74658092113886], "speed_kmh": 50.1, "time": 200.0, "period": 10.0, "distance_m": 139.3}, {"idx": 20, "start": [46.68333583548611, 24.74658092113886], "end": [46.68359882645219, 24.746065073150067], "speed_kmh": 22.8, "time": 200.0, "period": 10.0, "distance_m": 63.2}], "pickup": "2016-1-7T11:0:48+00:00"}, {"id": "7027987", "segments": [{"idx": 0, "start": [46.71332026995709, 24.732350786316697], "end": [46.715432622725146, 24.732671376459397], "speed_kmh": 77.9, "time": 10.0, "period": 10.0, "distance_m": 216.3}, {"idx": 1, "start": [46.715432622725146, 24.732671376459397], "end": [46.71747991682141, 24.733335167175603], "speed_kmh": 79.0, "time": 20.0, "period": 10.0, "distance_m": 219.5}, {"idx": 2, "start": [46.71747991682141, 24.733335167175603], "end": [46.719675452920306, 24.73381457761924], "speed_kmh": 82.1, "time": 30.0, "period": 10.0, "distance_m": 228.1}, {"idx": 3, "start": [46.719675452920306, 24.73381457761924], "end": [46.72140456827602, 24.734077237842925], "speed_kmh": 63.7, "time": 40.0, "period": 10.0, "distance_m": 177.1}, {"idx": 4, "start": [46.72140456827602, 24.734077237842925], "end": [46.723394387065, 24.734382572065066], "speed_kmh": 73.4, "time": 50.0, "period": 10.0, "distance_m": 203.8}, {"idx": 5, "start": [46.723394387065, 24.734382572065066], "end": [46.72577502608065, 24.73509991512096], "speed_kmh": 91.2, "time": 60.0, "period": 10.0, "distance_m": 253.3}, {"idx": 6, "start": [46.72577502608065, 24.73509991512096], "end": [46.727856737677484, 24.735464836219762], "speed_kmh": 77.1, "time": 70.0, "period": 10.0, "distance_m": 214.1}, {"idx": 7, "start": [46.727856737677484, 24.735464836219762], "end": [46.73020874356067, 24.73599235694427], "speed_kmh": 88.1, "time": 80.0, "period": 10.0, "distance_m": 244.7}, {"idx": 8, "start": [46.73020874356067, 24.73599235694427], "end": [46.731935651035, 24.73635854794188], "speed_kmh": 64.5, "time": 90.0, "period": 10.0, "distance_m": 179.1}, {"idx": 9, "start": [46.731935651035, 24.73635854794188], "end": [46.73421771566957, 24.736804539235074], "speed_kmh": 84.9, "time": 100.0, "period": 10.0, "distance_m": 235.7}, {"idx": 10, "start": [46.73421771566957, 24.736804539235074], "end": [46.73620497605559, 24.737534722162252], "speed_kmh": 77.9, "time": 110.0, "period": 10.0, "distance_m": 216.5}, {"idx": 11, "start": [46.73620497605559, 24.737534722162252], "end": [46.73793525873431, 24.738210925053654], "speed_kmh": 68.5, "time": 120.0, "period": 10.0, "distance_m": 190.2}, {"idx": 12, "start": [46.73793525873431, 24.738210925053654], "end": [46.74006248446087, 24.739195916713616], "speed_kmh": 86.8, "time": 130.0, "period": 10.0, "distance_m": 241.1}, {"idx": 13, "start": [46.74006248446087, 24.739195916713616], "end": [46.74224060769233, 24.740140427633573], "speed_kmh": 87.8, "time": 140.0, "period": 10.0, "distance_m": 243.8}, {"idx": 14, "start": [46.74224060769233, 24.740140427633573], "end": [46.74387979471262, 24.740921342947498], "speed_kmh": 67.3, "time": 150.0, "period": 10.0, "distance_m": 186.9}, {"idx": 15, "start": [46.74387979471262, 24.740921342947498], "end": [46.74591005356175, 24.74196948759736], "speed_kmh": 84.9, "time": 160.0, "period": 10.0, "distance_m": 235.8}, {"idx": 16, "start": [46.74591005356175, 24.74196948759736], "end": [46.74770770901145, 24.743224960153537], "speed_kmh": 82.4, "time": 170.0, "period": 10.0, "distance_m": 229.0}, {"idx": 17, "start": [46.74770770901145, 24.743224960153537], "end": [46.74904277082178, 24.74388156875662], "speed_kmh": 55.2, "time": 180.0, "period": 10.0, "distance_m": 153.3}, {"idx": 18, "start": [46.74904277082178, 24.74388156875662], "end": [46.749259773320254, 24.744290826544695], "speed_kmh": 18.2, "time": 190.0, "period": 10.0, "distance_m": 50.5}, {"idx": 19, "start": [46.749259773320254, 24.744290826544695], "end": [46.747461961492604, 24.74328198647857], "speed_kmh": 76.8, "time": 200.0, "period": 10.0, "distance_m": 213.4}, {"idx": 20, "start": [46.747461961492604, 24.74328198647857], "end": [46.745825209465416, 24.74239966721031], "speed_kmh": 69.2, "time": 210.0, "period": 10.0, "distance_m": 192.2}, {"idx": 21, "start": [46.745825209465416, 24.74239966721031], "end": [46.74442045004761, 24.741321769330014], "speed_kmh": 66.9, "time": 220.0, "period": 10.0, "distance_m": 185.7}, {"idx": 22, "start": [46.74442045004761, 24.741321769330014], "end": [46.74234177857255, 24.74033149442441], "speed_kmh": 85.3, "time": 230.0, "period": 10.0, "distance_m": 237.0}, {"idx": 23, "start": [46.74234177857255, 24.74033149442441], "end": [46.74055636553566, 24.739382548103404], "speed_kmh": 75.2, "time": 240.0, "period": 10.0, "distance_m": 208.9}, {"idx": 24, "start": [46.74055636553566, 24.739382548103404], "end": [46.73863208853815, 24.73870130910731], "speed_kmh": 75.1, "time": 250.0, "period": 10.0, "distance_m": 208.6}, {"idx": 25, "start": [46.73863208853815, 24.73870130910731], "end": [46.73677588425915, 24.738010543375925], "speed_kmh": 72.9, "time": 260.0, "period": 10.0, "distance_m": 202.6}, {"idx": 26, "start": [46.73677588425915, 24.738010543375925], "end": [46.73513112429531, 24.737231411370505], "speed_kmh": 67.4, "time": 270.0, "period": 10.0, "distance_m": 187.3}, {"idx": 27, "start": [46.73513112429531, 24.737231411370505], "end": [46.73309374347297, 24.73654048158494], "speed_kmh": 79.1, "time": 280.0, "period": 10.0, "distance_m": 219.6}, {"idx": 28, "start": [46.73309374347297, 24.73654048158494], "end": [46.73111595985064, 24.736231413827557], "speed_kmh": 73.0, "time": 290.0, "period": 10.0, "distance_m": 202.7}, {"idx": 29, "start": [46.73111595985064, 24.736231413827557], "end": [46.729214330614376, 24.735899874733438], "speed_kmh": 70.4, "time": 300.0, "period": 10.0, "distance_m": 195.6}, {"idx": 30, "start": [46.729214330614376, 24.735899874733438], "end": [46.72705264542668, 24.735469130780295], "speed_kmh": 80.5, "time": 310.0, "period": 10.0, "distance_m": 223.5}, {"idx": 31, "start": [46.72705264542668, 24.735469130780295], "end": [46.72544207920537, 24.73508603642604], "speed_kmh": 60.5, "time": 320.0, "period": 10.0, "distance_m": 168.1}, {"idx": 32, "start": [46.72544207920537, 24.73508603642604], "end": [46.722940982545396, 24.734625771115237], "speed_kmh": 92.8, "time": 330.0, "period": 10.0, "distance_m": 257.7}, {"idx": 33, "start": [46.722940982545396, 24.734625771115237], "end": [46.720881499043436, 24.734201188836106], "speed_kmh": 76.8, "time": 340.0, "period": 10.0, "distance_m": 213.3}, {"idx": 34, "start": [46.720881499043436, 24.734201188836106], "end": [46.71892214965563, 24.733710805955003], "speed_kmh": 73.9, "time": 350.0, "period": 10.0, "distance_m": 205.3}, {"idx": 35, "start": [46.71892214965563, 24.733710805955003], "end": [46.71668898408278, 24.733493613350763], "speed_kmh": 81.7, "time": 360.0, "period": 10.0, "distance_m": 226.8}, {"idx": 36, "start": [46.71668898408278, 24.733493613350763], "end": [46.7146789927901, 24.73283316192159], "speed_kmh": 77.7, "time": 370.0, "period": 10.0, "distance_m": 215.9}, {"idx": 37, "start": [46.7146789927901, 24.73283316192159], "end": [46.71296078005463, 24.73266765974641], "speed_kmh": 62.8, "time": 380.0, "period": 10.0, "distance_m": 174.5}, {"idx": 38, "start": [46.71296078005463, 24.73266765974641], "end": [46.71156267939981, 24.73359300207016], "speed_kmh": 62.9, "time": 390.0, "period": 10.0, "distance_m": 174.7}, {"idx": 39, "start": [46.71156267939981, 24.73359300207016], "end": [46.71030886790801, 24.73463963741952], "speed_kmh": 61.9, "time": 400.0, "period": 10.0, "distance_m": 172.0}, {"idx": 40, "start": [46.71030886790801, 24.73463963741952], "end": [46.71003856839505, 24.73645895928451], "speed_kmh": 73.5, "time": 410.0, "period": 10.0, "distance_m": 204.1}, {"idx": 41, "start": [46.71003856839505, 24.73645895928451], "end": [46.709610565400695, 24.738582814955134], "speed_kmh": 86.4, "time": 420.0, "period": 10.0, "distance_m": 240.1}, {"idx": 42, "start": [46.709610565400695, 24.738582814955134], "end": [46.708666446147966, 24.74023750352571], "speed_kmh": 74.6, "time": 430.0, "period": 10.0, "distance_m": 207.2}, {"idx": 43, "start": [46.708666446147966, 24.74023750352571], "end": [46.707752120900054, 24.741713263591432], "speed_kmh": 67.8, "time": 440.0, "period": 10.0, "distance_m": 188.3}, {"idx": 44, "start": [46.707752120900054, 24.741713263591432], "end": [46.706922876991385, 24.743730559734402], "speed_kmh": 86.2, "time": 450.0, "period": 10.0, "distance_m": 239.4}, {"idx": 45, "start": [46.706922876991385, 24.743730559734402], "end": [46.705960681018595, 24.745243575088775], "speed_kmh": 69.9, "time": 460.0, "period": 10.0, "distance_m": 194.3}, {"idx": 46, "start": [46.705960681018595, 24.745243575088775], "end": [46.70545557361485, 24.746802406357638], "speed_kmh": 65.0, "time": 470.0, "period": 10.0, "distance_m": 180.7}, {"idx": 47, "start": [46.70545557361485, 24.746802406357638], "end": [46.70419670580401, 24.748638307093145], "speed_kmh": 86.6, "time": 480.0, "period": 10.0, "distance_m": 240.5}, {"idx": 48, "start": [46.70419670580401, 24.748638307093145], "end": [46.70360471943771, 24.750132339916973], "speed_kmh": 63.6, "time": 490.0, "period": 10.0, "distance_m": 176.6}, {"idx": 49, "start": [46.70360471943771, 24.750132339916973], "end": [46.70265614835379, 24.75171955413474], "speed_kmh": 72.3, "time": 500.0, "period": 10.0, "distance_m": 200.8}, {"idx": 50, "start": [46.70265614835379, 24.75171955413474], "end": [46.70231513534484, 24.753231063779296], "speed_kmh": 61.8, "time": 510.0, "period": 10.0, "distance_m": 171.6}, {"idx": 51, "start": [46.70231513534484, 24.753231063779296], "end": [46.70304931893723, 24.75362886559588], "speed_kmh": 31.1, "time": 520.0, "period": 10.0, "distance_m": 86.3}, {"idx": 52, "start": [46.70304931893723, 24.75362886559588], "end": [46.704081421931114, 24.75394383832781], "speed_kmh": 39.6, "time": 530.0, "period": 10.0, "distance_m": 109.9}, {"idx": 53, "start": [46.704081421931114, 24.75394383832781], "end": [46.70460375006096, 24.754188053283084], "speed_kmh": 21.4, "time": 540.0, "period": 10.0, "distance_m": 59.3}, {"idx": 54, "start": [46.70460375006096, 24.754188053283084], "end": [46.70538123646147, 24.754542315188193], "speed_kmh": 31.6, "time": 550.0, "period": 10.0, "distance_m": 87.8}, {"idx": 55, "start": [46.70538123646147, 24.754542315188193], "end": [46.70641610531387, 24.75490310603679], "speed_kmh": 40.3, "time": 560.0, "period": 10.0, "distance_m": 111.9}, {"idx": 56, "start": [46.70641610531387, 24.75490310603679], "end": [46.706884928513475, 24.7543988385798], "speed_kmh": 26.4, "time": 570.0, "period": 10.0, "distance_m": 73.4}, {"idx": 57, "start": [46.706884928513475, 24.7543988385798], "end": [46.70717559252635, 24.753576150418542], "speed_kmh": 34.6, "time": 580.0, "period": 10.0, "distance_m": 96.1}, {"idx": 58, "start": [46.70717559252635, 24.753576150418542], "end": [46.70766040417854, 24.753077836701575], "speed_kmh": 26.6, "time": 590.0, "period": 10.0, "distance_m": 73.9}, {"idx": 59, "start": [46.70766040417854, 24.753077836701575], "end": [46.707899746921655, 24.75339617108327], "speed_kmh": 15.4, "time": 600.0, "period": 10.0, "distance_m": 42.9}, {"idx": 60, "start": [46.707899746921655, 24.75339617108327], "end": [46.7083941382164, 24.753685552011497], "speed_kmh": 21.4, "time": 610.0, "period": 10.0, "distance_m": 59.4}, {"idx": 61, "start": [46.7083941382164, 24.753685552011497], "end": [46.70884094701407, 24.754215165066526], "speed_kmh": 26.7, "time": 620.0, "period": 10.0, "distance_m": 74.2}, {"idx": 62, "start": [46.70884094701407, 24.754215165066526], "end": [46.70937764165098, 24.754503501260746], "speed_kmh": 22.7, "time": 630.0, "period": 10.0, "distance_m": 63.0}, {"idx": 63, "start": [46.70937764165098, 24.754503501260746], "end": [46.70982257110892, 24.75479946608741], "speed_kmh": 20.0, "time": 640.0, "period": 10.0, "distance_m": 55.7}, {"idx": 64, "start": [46.70982257110892, 24.75479946608741], "end": [46.71032173905926, 24.75547952148635], "speed_kmh": 32.7, "time": 650.0, "period": 10.0, "distance_m": 90.9}, {"idx": 65, "start": [46.71032173905926, 24.75547952148635], "end": [46.71081070730831, 24.755691695928252], "speed_kmh": 19.7, "time": 660.0, "period": 10.0, "distance_m": 54.7}, {"idx": 66, "start": [46.71081070730831, 24.755691695928252], "end": [46.71133697718751, 24.756231654003717], "speed_kmh": 28.9, "time": 670.0, "period": 10.0, "distance_m": 80.2}, {"idx": 67, "start": [46.71133697718751, 24.756231654003717], "end": [46.71142123010069, 24.756484671393224], "speed_kmh": 10.6, "time": 670.0, "period": 10.0, "distance_m": 29.4}], "pickup": "2016-4-12T21:45:6+00:00"}, {"id": "6224292", "segments": [{"idx": 0, "start": [46.75159018247987, 24.740527347524154], "end": [46.752043373855216, 24.73965580083052], "speed_kmh": 38.6, "time": 10.0, "period": 10.0, "distance_m": 107.2}, {"idx": 1, "start": [46.752043373855216, 24.73965580083052], "end": [46.75265614752695, 24.738604994134228], "speed_kmh": 47.6, "time": 20.0, "period": 10.0, "distance_m": 132.2}, {"idx": 2, "start": [46.75265614752695, 24.738604994134228], "end": [46.75333936530534, 24.7375908553126], "speed_kmh": 47.6, "time": 30.0, "period": 10.0, "distance_m": 132.2}, {"idx": 3, "start": [46.75333936530534, 24.7375908553126], "end": [46.75404008886001, 24.7357026536409], "speed_kmh": 79.8, "time": 40.0, "period": 10.0, "distance_m": 221.6}, {"idx": 4, "start": [46.75404008886001, 24.7357026536409], "end": [46.75513151683612, 24.733915000450743], "speed_kmh": 81.8, "time": 50.0, "period": 10.0, "distance_m": 227.3}, {"idx": 5, "start": [46.75513151683612, 24.733915000450743], "end": [46.75594498311502, 24.732438891963923], "speed_kmh": 66.1, "time": 60.0, "period": 10.0, "distance_m": 183.5}, {"idx": 6, "start": [46.75594498311502, 24.732438891963923], "end": [46.75693394865058, 24.730529255741114], "speed_kmh": 84.5, "time": 70.0, "period": 10.0, "distance_m": 234.7}, {"idx": 7, "start": [46.75693394865058, 24.730529255741114], "end": [46.7575674354943, 24.72854551903084], "speed_kmh": 82.7, "time": 80.0, "period": 10.0, "distance_m": 229.7}, {"idx": 8, "start": [46.7575674354943, 24.72854551903084], "end": [46.75882253191495, 24.72676070700745], "speed_kmh": 84.8, "time": 90.0, "period": 10.0, "distance_m": 235.5}, {"idx": 9, "start": [46.75882253191495, 24.72676070700745], "end": [46.75953735643414, 24.725197626668976], "speed_kmh": 67.8, "time": 100.0, "period": 10.0, "distance_m": 188.2}, {"idx": 10, "start": [46.75953735643414, 24.725197626668976], "end": [46.760444761538885, 24.723390701864457], "speed_kmh": 79.5, "time": 110.0, "period": 10.0, "distance_m": 220.8}, {"idx": 11, "start": [46.760444761538885, 24.723390701864457], "end": [46.76126833537101, 24.72184783272416], "speed_kmh": 68.6, "time": 120.0, "period": 10.0, "distance_m": 190.7}, {"idx": 12, "start": [46.76126833537101, 24.72184783272416], "end": [46.7619810171047, 24.720375623214746], "speed_kmh": 64.4, "time": 130.0, "period": 10.0, "distance_m": 178.8}, {"idx": 13, "start": [46.7619810171047, 24.720375623214746], "end": [46.76296639651287, 24.718815565961574], "speed_kmh": 72.0, "time": 140.0, "period": 10.0, "distance_m": 200.0}, {"idx": 14, "start": [46.76296639651287, 24.718815565961574], "end": [46.76388322988058, 24.717488636703063], "speed_kmh": 62.7, "time": 150.0, "period": 10.0, "distance_m": 174.2}, {"idx": 15, "start": [46.76388322988058, 24.717488636703063], "end": [46.765098565445406, 24.715652794050726], "speed_kmh": 85.8, "time": 160.0, "period": 10.0, "distance_m": 238.2}, {"idx": 16, "start": [46.765098565445406, 24.715652794050726], "end": [46.76631486413556, 24.71421856011333], "speed_kmh": 72.5, "time": 170.0, "period": 10.0, "distance_m": 201.3}, {"idx": 17, "start": [46.76631486413556, 24.71421856011333], "end": [46.76721693280857, 24.712314895051527], "speed_kmh": 83.0, "time": 180.0, "period": 10.0, "distance_m": 230.5}, {"idx": 18, "start": [46.76721693280857, 24.712314895051527], "end": [46.76855670334818, 24.71085840527524], "speed_kmh": 76.0, "time": 190.0, "period": 10.0, "distance_m": 211.1}, {"idx": 19, "start": [46.76855670334818, 24.71085840527524], "end": [46.76959066332904, 24.709211166194837], "speed_kmh": 75.9, "time": 200.0, "period": 10.0, "distance_m": 210.9}, {"idx": 20, "start": [46.76959066332904, 24.709211166194837], "end": [46.770494971850844, 24.707692704843605], "speed_kmh": 69.1, "time": 210.0, "period": 10.0, "distance_m": 192.0}, {"idx": 21, "start": [46.770494971850844, 24.707692704843605], "end": [46.771718636097056, 24.706026370966335], "speed_kmh": 80.2, "time": 220.0, "period": 10.0, "distance_m": 222.7}, {"idx": 22, "start": [46.771718636097056, 24.706026370966335], "end": [46.77250747576392, 24.70404185832496], "speed_kmh": 84.5, "time": 230.0, "period": 10.0, "distance_m": 234.6}, {"idx": 23, "start": [46.77250747576392, 24.70404185832496], "end": [46.77339516992076, 24.702289620237135], "speed_kmh": 77.2, "time": 240.0, "period": 10.0, "distance_m": 214.5}, {"idx": 24, "start": [46.77339516992076, 24.702289620237135], "end": [46.77400733545285, 24.700564299168608], "speed_kmh": 72.6, "time": 250.0, "period": 10.0, "distance_m": 201.6}, {"idx": 25, "start": [46.77400733545285, 24.700564299168608], "end": [46.77470429738455, 24.69844629840219], "speed_kmh": 88.5, "time": 260.0, "period": 10.0, "distance_m": 245.8}, {"idx": 26, "start": [46.77470429738455, 24.69844629840219], "end": [46.7753089106323, 24.696905650697282], "speed_kmh": 65.5, "time": 270.0, "period": 10.0, "distance_m": 181.9}, {"idx": 27, "start": [46.7753089106323, 24.696905650697282], "end": [46.77606738784023, 24.695062109507713], "speed_kmh": 78.8, "time": 280.0, "period": 10.0, "distance_m": 218.8}, {"idx": 28, "start": [46.77606738784023, 24.695062109507713], "end": [46.77652050305063, 24.693098666323465], "speed_kmh": 80.3, "time": 290.0, "period": 10.0, "distance_m": 223.1}, {"idx": 29, "start": [46.77652050305063, 24.693098666323465], "end": [46.77728914958978, 24.69111361883933], "speed_kmh": 84.2, "time": 300.0, "period": 10.0, "distance_m": 234.0}, {"idx": 30, "start": [46.77728914958978, 24.69111361883933], "end": [46.777640204415256, 24.68920189344976], "speed_kmh": 77.6, "time": 310.0, "period": 10.0, "distance_m": 215.5}, {"idx": 31, "start": [46.777640204415256, 24.68920189344976], "end": [46.77784555448849, 24.6880448750642], "speed_kmh": 46.9, "time": 320.0, "period": 10.0, "distance_m": 130.3}, {"idx": 32, "start": [46.77784555448849, 24.6880448750642], "end": [46.77789623475295, 24.686935711087667], "speed_kmh": 44.4, "time": 330.0, "period": 10.0, "distance_m": 123.4}, {"idx": 33, "start": [46.77789623475295, 24.686935711087667], "end": [46.77790206957626, 24.68577064668948], "speed_kmh": 46.6, "time": 340.0, "period": 10.0, "distance_m": 129.6}, {"idx": 34, "start": [46.77790206957626, 24.68577064668948], "end": [46.778042887303194, 24.684415167366513], "speed_kmh": 54.5, "time": 350.0, "period": 10.0, "distance_m": 151.4}, {"idx": 35, "start": [46.778042887303194, 24.684415167366513], "end": [46.77682146803026, 24.68380133286337], "speed_kmh": 50.8, "time": 360.0, "period": 10.0, "distance_m": 141.0}, {"idx": 36, "start": [46.77682146803026, 24.68380133286337], "end": [46.77553726057821, 24.68326285302393], "speed_kmh": 51.4, "time": 370.0, "period": 10.0, "distance_m": 142.9}, {"idx": 37, "start": [46.77553726057821, 24.68326285302393], "end": [46.774148667209836, 24.682878899135684], "speed_kmh": 52.8, "time": 380.0, "period": 10.0, "distance_m": 146.6}, {"idx": 38, "start": [46.774148667209836, 24.682878899135684], "end": [46.77546474598864, 24.682811231355995], "speed_kmh": 47.9, "time": 390.0, "period": 10.0, "distance_m": 133.2}, {"idx": 39, "start": [46.77546474598864, 24.682811231355995], "end": [46.77657525743696, 24.683342770486334], "speed_kmh": 45.7, "time": 400.0, "period": 10.0, "distance_m": 126.8}, {"idx": 40, "start": [46.77657525743696, 24.683342770486334], "end": [46.777829476005074, 24.683713078929355], "speed_kmh": 48.0, "time": 410.0, "period": 10.0, "distance_m": 133.2}, {"idx": 41, "start": [46.777829476005074, 24.683713078929355], "end": [46.77869779487139, 24.68276192575579], "speed_kmh": 49.5, "time": 420.0, "period": 10.0, "distance_m": 137.4}, {"idx": 42, "start": [46.77869779487139, 24.68276192575579], "end": [46.778410021526106, 24.68189731396006], "speed_kmh": 36.2, "time": 430.0, "period": 10.0, "distance_m": 100.4}, {"idx": 43, "start": [46.778410021526106, 24.68189731396006], "end": [46.77751727619353, 24.68144066763935], "speed_kmh": 37.3, "time": 440.0, "period": 10.0, "distance_m": 103.5}, {"idx": 44, "start": [46.77751727619353, 24.68144066763935], "end": [46.77719409426463, 24.681204111673917], "speed_kmh": 15.1, "time": 450.0, "period": 10.0, "distance_m": 41.9}, {"idx": 45, "start": [46.77719409426463, 24.681204111673917], "end": [46.776048545067034, 24.68100640628567], "speed_kmh": 42.4, "time": 460.0, "period": 10.0, "distance_m": 117.8}, {"idx": 46, "start": [46.776048545067034, 24.68100640628567], "end": [46.77550862580501, 24.68078776153999], "speed_kmh": 21.5, "time": 470.0, "period": 10.0, "distance_m": 59.7}, {"idx": 47, "start": [46.77550862580501, 24.68078776153999], "end": [46.77526820212374, 24.680507869629704], "speed_kmh": 14.2, "time": 480.0, "period": 10.0, "distance_m": 39.5}, {"idx": 48, "start": [46.77526820212374, 24.680507869629704], "end": [46.77523918168102, 24.67979096021355], "speed_kmh": 28.7, "time": 490.0, "period": 10.0, "distance_m": 79.8}, {"idx": 49, "start": [46.77523918168102, 24.67979096021355], "end": [46.77491222976169, 24.679307852343598], "speed_kmh": 22.7, "time": 500.0, "period": 10.0, "distance_m": 63.1}, {"idx": 50, "start": [46.77491222976169, 24.679307852343598], "end": [46.7751751646486, 24.678883545084503], "speed_kmh": 19.5, "time": 510.0, "period": 10.0, "distance_m": 54.1}, {"idx": 51, "start": [46.7751751646486, 24.678883545084503], "end": [46.77533857370969, 24.678261711980028], "speed_kmh": 25.6, "time": 520.0, "period": 10.0, "distance_m": 71.1}, {"idx": 52, "start": [46.77533857370969, 24.678261711980028], "end": [46.77497943447871, 24.677646553113043], "speed_kmh": 27.9, "time": 530.0, "period": 10.0, "distance_m": 77.4}, {"idx": 53, "start": [46.77497943447871, 24.677646553113043], "end": [46.775227178314935, 24.677222034016182], "speed_kmh": 19.2, "time": 530.0, "period": 10.0, "distance_m": 53.4}], "pickup": "2016-1-19T5:1:50+00:00"}];

console.log('TRIPS loaded:', TRIPS.length);

// Populate dropdown
window.onload = function() {
    console.log('Window loaded');
    var sel = document.getElementById('routeSel');
    for (var i = 0; i < TRIPS.length; i++) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.text = 'Route ' + TRIPS[i].id + ' (' + TRIPS[i].segments.length + ' segs)';
        sel.add(opt);
    }
    console.log('Dropdown populated');
};

function log(msg) {
    var el = document.getElementById('log');
    el.textContent += msg + '\n';
    el.scrollTop = el.scrollHeight;
    console.log(msg);
}

function runSplit() {
    console.log('runSplit called');
    document.getElementById('log').textContent = '';
    document.getElementById('visual').innerHTML = '';
    
    var routeIdx = document.getElementById('routeSel').value;
    log('Route index: "' + routeIdx + '"');
    
    if (routeIdx === '') {
        log('ERROR: No route selected!');
        return;
    }
    
    var route = TRIPS[parseInt(routeIdx)];
    log('Route ID: ' + route.id);
    log('Segments: ' + route.segments.length);
    
    var rule = document.getElementById('ruleSel').value;
    log('Rule: ' + rule);
    
    var n = parseInt(document.getElementById('nVal').value);
    log('N value: ' + n);
    
    var segs = route.segments;
    var paths = [];
    var cur = [];
    
    log('\n--- Starting split loop ---');
    
    for (var i = 0; i < segs.length; i++) {
        log('i=' + i + ', cur.length=' + cur.length);
        
        var doSplit = false;
        
        if (rule === 'count') {
            log('  Checking: cur.length(' + cur.length + ') >= n(' + n + ') ? ' + (cur.length >= n));
            if (cur.length >= n) {
                doSplit = true;
                log('  >>> SPLIT TRIGGERED <<<');
            }
        }
        
        if (doSplit && cur.length > 0) {
            log('  Pushing path with ' + cur.length + ' items');
            paths.push(cur.slice());
            cur = [];
        }
        
        cur.push(i);
        log('  Added ' + i + ' to cur, now cur=' + JSON.stringify(cur));
    }
    
    if (cur.length > 0) {
        log('\nPushing final path with ' + cur.length + ' items');
        paths.push(cur);
    }
    
    log('\n=== FINAL RESULT ===');
    log('Total paths: ' + paths.length);
    
    var colors = ['#e94560','#3498db','#2ecc71','#f39c12','#9b59b6'];
    var vis = '';
    
    for (var p = 0; p < paths.length; p++) {
        log('Path ' + (p+1) + ': ' + JSON.stringify(paths[p]));
        vis += '<div class="path-box" style="background:' + colors[p % colors.length] + '">Path ' + (p+1) + ': ' + paths[p].length + ' trips</div>';
    }
    
    document.getElementById('visual').innerHTML = vis;
}

console.log('Script loaded');
</script>
</body>
</html>